(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","Slick","nf.Common","nf.Dialog","nf.ErrorHandler","nf.HistoryModel"],function(e,h,f,d,g,c){return(nf.HistoryTable=b(e,h,f,d,g,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.HistoryTable=b(require("jquery"),require("Slick"),require("nf.Common"),require("nf.Dialog"),require("nf.ErrorHandler"),require("nf.HistoryModel")))}else{nf.HistoryTable=b(a.$,a.Slick,a.nf.Common,a.nf.Dialog,a.nf.ErrorHandler,a.nf.HistoryModel)}}}(this,function(f,c,d,e,i,g){var b={defaultStartTime:"00:00:00",defaultEndTime:"23:59:59",styles:{hidden:"hidden"},urls:{history:"../nifi-api/controller/history"}};var k=function(){f("#action-details-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Action Details",buttons:[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){f("#action-details-dialog").modal("hide")}}}],handler:{close:function(){f("#action-details").empty()}}})};var a=function(){f("#history-filter").val("");f("#history-filter-type").combo({options:[{text:"by id",value:"by id",description:"Filters based on the id of the component that was modified"},{text:"by user",value:"by user",description:"Filters based on the user that performed the action"}]});f("#history-filter-start-date, #history-filter-end-date").datepicker({showAnim:"",showOtherMonths:true,selectOtherMonths:true});f("#history-filter-start-date").datepicker("setDate","-14d");f("#history-filter-end-date").datepicker("setDate","+0d");f("#history-filter-start-time").val(b.defaultStartTime);f("#history-filter-end-time").val(b.defaultEndTime);f("#history-filter-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Filter History",buttons:[{buttonText:"Filter",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){f("#history-filter-dialog").modal("hide");var p={};var s=f("#history-filter").val();if(s!==""){var o=f("#history-filter-type").combo("getSelectedOption").text;if(o==="by id"){p.sourceId=s}else{if(o==="by user"){p.userIdentity=s}}}var r=f.trim(f("#history-filter-start-date").val());var q=f.trim(f("#history-filter-start-time").val());if(r!==""){if(q===""){q=b.defaultStartTime;f("#history-filter-start-time").val(q)}p.startDate=r+" "+q}var u=f.trim(f("#history-filter-end-date").val());var v=f.trim(f("#history-filter-end-time").val());if(u!==""){if(v===""){v=b.defaultEndTime;f("#history-filter-end-time").val(v)}p.endDate=u+" "+v}var w=f("#history-table").data("gridInstance");var t=w.getData();t.setFilterArgs(p);n.loadHistoryTable()}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){f("#history-filter-dialog").modal("hide")}}}]})};var h=function(){f("#history-purge-end-date").datepicker({showAnim:"",showOtherMonths:true,selectOtherMonths:true});f("#history-purge-end-date").datepicker("setDate","-1m");f("#history-purge-end-time").val(b.defaultStartTime);f("#history-purge-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Purge History",buttons:[{buttonText:"Purge",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){f("#history-purge-dialog").modal("hide");var r=f.trim(f("#history-purge-end-date").val());var o=f.trim(f("#history-purge-end-time").val());if(r!==""){if(o===""){o=b.defaultStartTime;f("#history-purge-end-time").val(o)}var p=r+" "+o;var q=f(".timezone:first").text();e.showYesNoDialog({headerText:"History",dialogContent:"Are you sure you want to delete all history before '"+d.escapeHtml(p)+" "+d.escapeHtml(q)+"'?",yesHandler:function(){l(p)}})}else{e.showOkDialog({headerText:"History",dialogContent:"The end date must be specified."})}}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){f("#history-purge-dialog").modal("hide")}}}]})};var m=function(){f("#clear-history-filter").click(function(){f("#history-filter").val("");f("#history-filter-overview").css("visibility","hidden");var v=f("#history-table").data("gridInstance");var u=v.getData();u.setFilterArgs({});n.loadHistoryTable()});f("#history-filter-button").click(function(){f("#history-filter-dialog").modal("show")});var p=function(y,v,x,w,u){if(u.canRead===true){return'<div title="View Details" class="pointer show-action-details fa fa-info-circle"></div>'}return""};var r=function(y,v,x,w,u){if(u.canRead!==true){return'<span class="unset" style="font-size: 13px; padding-top: 2px;">Not authorized</span>'}return d.formatValue(u.action[w.field])};var q=[{id:"moreDetails",name:"&nbsp;",sortable:false,resizable:false,formatter:p,width:50,maxWidth:50},{id:"timestamp",name:"Date/Time",field:"timestamp",sortable:true,resizable:true,formatter:r},{id:"sourceName",name:"Name",field:"sourceName",sortable:true,resizable:true,formatter:r},{id:"sourceType",name:"Type",field:"sourceType",sortable:true,resizable:true,formatter:r},{id:"operation",name:"Operation",field:"operation",sortable:true,resizable:true,formatter:r},{id:"userIdentity",name:"User",field:"userIdentity",sortable:true,resizable:true,formatter:r}];var o={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:false,enableColumnReorder:false,autoEdit:false,rowHeight:24};var t=new g();var s=new c.Grid("#history-table",t,q,o);s.setSelectionModel(new c.RowSelectionModel());s.registerPlugin(new c.AutoTooltips());s.onSort.subscribe(function(w,v){t.setSort(v.sortCol.field,v.sortAsc?1:-1);var u=s.getViewport();t.ensureData(u.top,u.bottom)});s.setSortColumn("timestamp",false);s.onClick.subscribe(function(x,u){var w=f(x.target);var v=t.getItem(u.row);if(s.getColumns()[u.cell].id==="moreDetails"){if(w.hasClass("show-action-details")){j(v.action)}}});s.onViewportChanged.subscribe(function(w,v){var u=s.getViewport();t.ensureData(u.top,u.bottom)});t.onDataLoaded.subscribe(function(w,u){for(var v=u.from;v<=u.to;v++){s.invalidateRow(v)}s.updateRowCount();s.render()});f("#history-table").data("gridInstance",s);if(d.canModifyController()){f("#history-purge-button").on("click",function(){f("#history-purge-dialog").modal("show")}).show()}};var l=function(o){f.ajax({type:"DELETE",url:b.urls.history+"?"+f.param({endDate:o}),dataType:"json"}).done(function(){n.loadHistoryTable()}).fail(i.handleAjaxError)};var j=function(p){var o=f("<div></div>").append(f('<div class="action-detail"><div class="history-details-name">Id</div>'+d.escapeHtml(p.sourceId)+"</div>"));var r=p.componentDetails;if(d.isDefinedAndNotNull(r)){if(p.sourceType==="Processor"||p.sourceType==="ControllerService"||p.sourceType==="ReportingTask"){o.append(f('<div class="action-detail"><div class="history-details-name">Type</div>'+d.escapeHtml(r.type)+"</div>"))}else{if(p.sourceType==="RemoteProcessGroup"){o.append(f('<div class="action-detail"><div class="history-details-name">Uri</div>'+d.formatValue(r.uri)+"</div>"))}}}var q=p.actionDetails;if(d.isDefinedAndNotNull(q)){if(p.operation==="Configure"){o.append(f('<div class="action-detail"><div class="history-details-name">Name</div>'+d.formatValue(q.name)+"</div>")).append(f('<div class="action-detail"><div class="history-details-name">Value</div>'+d.formatValue(q.value)+"</div>")).append(f('<div class="action-detail"><div class="history-details-name">Previous Value</div>'+d.formatValue(q.previousValue)+"</div>"))}else{if(p.operation==="Connect"||p.operation==="Disconnect"){o.append(f('<div class="action-detail"><div class="history-details-name">Source Id</div>'+d.escapeHtml(q.sourceId)+"</div>")).append(f('<div class="action-detail"><div class="history-details-name">Source Name</div>'+d.formatValue(q.sourceName)+"</div>")).append(f('<div class="action-detail"><div class="history-details-name">Source Type</div>'+d.escapeHtml(q.sourceType)+"</div>")).append(f('<div class="action-detail"><div class="history-details-name">Relationship(s)</div>'+d.formatValue(q.relationship)+"</div>")).append(f('<div class="action-detail"><div class="history-details-name">Destination Id</div>'+d.escapeHtml(q.destinationId)+"</div>")).append(f('<div class="action-detail"><div class="history-details-name">Destination Name</div>'+d.formatValue(q.destinationName)+"</div>")).append(f('<div class="action-detail"><div class="history-details-name">Destination Type</div>'+d.escapeHtml(q.destinationType)+"</div>"))}else{if(p.operation==="Move"){o.append(f('<div class="action-detail"><div class="history-details-name">Group</div>'+d.formatValue(q.group)+"</div>")).append(f('<div class="action-detail"><div class="history-details-name">Group Id</div>'+d.escapeHtml(q.groupId)+"</div>")).append(f('<div class="action-detail"><div class="history-details-name">Previous Group</div>'+d.formatValue(q.previousGroup)+"</div>")).append(f('<div class="action-detail"><div class="history-details-name">Previous Group Id</div>'+d.escapeHtml(q.previousGroupId)+"</div>"))}else{if(p.operation==="Purge"){o.append(f('<div class="action-detail"><div class="history-details-name">End Date</div>'+d.escapeHtml(q.endDate)+"</div>"))}}}}}f("#action-details").append(o);f("#action-details-dialog").modal("show")};var n={init:function(){k();a();h();m()},resetTableSize:function(){var o=f("#history-table").data("gridInstance");if(d.isDefinedAndNotNull(o)){o.resizeCanvas()}},loadHistoryTable:function(){var p=f("#history-table").data("gridInstance");var o=p.getData();o.clear();p.onViewportChanged.notify()}};return n}));