(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","angular","nf.Common","nf.ng.AppConfig","nf.ng.AppCtrl","nf.ng.ServiceProvider","nf.ng.Bridge","nf.ErrorHandler","nf.Storage"],function(e,j,d,k,i,c,g,h,f){return(nf.ng.BulletinBoardCtrl=b(e,j,d,k,i,c,g,h,f))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.BulletinBoardCtrl=b(require("jquery"),require("angular"),require("nf.Common"),require("nf.ng.AppConfig"),require("nf.ng.AppCtrl"),require("nf.ng.ServiceProvider"),require("nf.ng.Bridge"),require("nf.ErrorHandler"),require("nf.Storage")))}else{nf.ng.BulletinBoardCtrl=b(a.$,a.angular,a.nf.Common,a.nf.ng.AppConfig,a.nf.ng.AppCtrl,a.nf.ng.ServiceProvider,a.nf.ng.Bridge,a.nf.ErrorHandler,a.nf.Storage)}}}(this,function(c,i,b,j,h,a,e,g,d){c(document).ready(function(){var k=i.module("ngBulletinBoardApp",["ngResource","ngRoute","ngMaterial","ngMessages"]);j.$inject=["$mdThemingProvider","$compileProvider"];h.$inject=["$scope","serviceProvider","bulletinBoardCtrl"];f.$inject=["serviceProvider"];a.$inject=[];k.config(j);k.controller("ngBulletinBoardAppCtrl",h);k.service("serviceProvider",a);k.service("bulletinBoardCtrl",f);e.injector=i.bootstrap(c("body"),["ngBulletinBoardApp"],{strictDi:true});e.injector.get("bulletinBoardCtrl").init()});var f=function(r){var n={pollInterval:3,maxBulletins:1000,urls:{banners:"../nifi-api/flow/banners",about:"../nifi-api/flow/about",bulletinBoard:"../nifi-api/flow/bulletin-board"}};var t=null;var p=null;var k=null;var m=function(){c("#clear-bulletins-button").click(function(){c("#bulletin-board-container").empty()});c("#bulletin-board-filter-type").combo({options:[{text:"by message",value:"message"},{text:"by name",value:"sourceName"},{text:"by id",value:"sourceId"},{text:"by group id",value:"groupId"}]});var y=c.ajax({type:"GET",url:n.urls.about,dataType:"json"}).done(function(A){var z=A.about;var B=z.title+" Bulletin Board";document.title=B;c("#bulletin-board-header-text").text(B)}).fail(g.handleAjaxError);var x=c.Deferred(function(z){if(top===window){c.ajax({type:"GET",url:n.urls.banners,dataType:"json"}).done(function(E){if(b.isDefinedAndNotNull(E.banners)){if(b.isDefinedAndNotNull(E.banners.headerText)&&E.banners.headerText!==""){var B=c("#banner-header").text(E.banners.headerText).show();var D=function(F){var G=c("#"+F);G.css("top",(parseInt(B.css("height"),10)+parseInt(G.css("top"),10))+"px")};D("bulletin-board")}if(b.isDefinedAndNotNull(E.banners.footerText)&&E.banners.footerText!==""){var A=c("#banner-footer").text(E.banners.footerText).show();var C=function(F){var G=c("#"+F);G.css("bottom",parseInt(A.css("height"),10)+"px")};C("bulletin-board")}}z.resolve()}).fail(function(C,A,B){g.handleAjaxError(C,A,B);z.reject()})}else{z.resolve()}});return c.Deferred(function(z){c.when(y,x).done(function(){z.resolve()}).fail(function(){z.reject()})}).promise()};var l=function(){var y=c("#refresh-button");var x=c("#bulletin-board-container");q(x,'<div class="bulletin-action">Auto refresh started</div>');c("#bulletin-error-message").text("").hide();u()};var w=function(){var y=c("#refresh-button");var x=c("#bulletin-board-container");q(x,'<div class="bulletin-action">Auto refresh stopped</div>');t=null;p=null;k=null};var u=function(){var x=c("#bulletin-board").is(":visible");if(!x){o.polling=false}if(o.polling){o.loadBulletins().done(function(){if(o.polling){setTimeout(u,n.pollInterval*1000)}})}};var q=function(x,y){x.append(y).animate({scrollTop:x[0].scrollHeight},"slow")};var v=function(x,y){if(top!==window){if(b.isDefinedAndNotNull(parent.nf)&&b.isDefinedAndNotNull(parent.nf.CanvasUtils)&&b.isDefinedAndNotNull(parent.nf.Shell)){parent.nf.CanvasUtils.showComponent(x,y);parent.$("#shell-close-button").click()}}};function s(){this.polling=true}s.prototype={constructor:s,register:function(){if(r.bulletinBoardCtrl===undefined){r.register("bulletinBoardCtrl",o)}},init:function(){if(top===window){c("#bulletin-board").css({position:"absolute",bottom:"40px",left:"40px",right:"40px",top:"40px"});c("#bulletin-board-refresh-container").css({position:"absolute",bottom:"40px",left:"40px",right:"40px"})}d.init();m().done(function(){l()})},loadBulletins:function(){var A={};if(b.isDefinedAndNotNull(t)){A.after=t}else{A.limit=10}var y=c("#bulletin-board-container");var z=c("#bulletin-board-filter").val();if(z!==""){var B=c("#bulletin-board-filter-type").combo("getSelectedOption");A[B.value]=z;if(p!==z||k!==B.text){var x=c('<div class="bulletin-action"></div>').text("Filter "+B.text+" matching '"+z+"'");q(y,x.get(0));p=z;k=B.text}}else{if(p!==null){q(y,'<div class="bulletin-action">Filter removed</div>');p=null;k=null}}return c.ajax({type:"GET",url:n.urls.bulletinBoard,data:A,dataType:"json"}).done(function(C){if(b.isDefinedAndNotNull(C.bulletinBoard)){var D=C.bulletinBoard;c("#bulletin-board-last-refreshed").text(D.generated);var H=C.bulletinBoard.bulletins;var G=[];c.each(H,function(M,L){if(L.canRead===true){var J=L.bulletin;var P="bulletin-normal";if(J.level==="ERROR"){P="bulletin-error"}else{if(J.level==="WARN"||J.level==="WARNING"){P="bulletin-warn"}}var O;if(b.isDefinedAndNotNull(J.sourceId)&&b.isDefinedAndNotNull(J.groupId)&&top!==window){O=c('<div class="bulletin-source bulletin-link"></div>').text(J.sourceId).on("click",function(){v(J.groupId,J.sourceId)})}else{var N=J.sourceId;if(b.isUndefined(N)||b.isNull(N)){N=""}O=c('<div class="bulletin-source"></div>').text(N)}var K=c('<div class="bulletin"></div>');var I=c('<div class="bulletin-info"></div>').appendTo(K);c('<div class="bulletin-timestamp"></div>').text(J.timestamp).appendTo(I);c('<div class="bulletin-severity"></div>').addClass(P).text(J.level).appendTo(I);O.appendTo(I);c('<div class="clear"></div>').appendTo(I);if(b.isDefinedAndNotNull(J.nodeAddress)){c('<div class="bulletin-node"></div>').text(J.nodeAddress).appendTo(K)}c('<pre class="bulletin-message"></pre>').text(J.message).appendTo(K);c('<div class="clear"></div>').appendTo(K);G.push(K.get(0))}if(M+1===H.length){t=L.id}});q(y,G);var F=y.contents();var E=F.length;if(E>n.maxBulletins){F.slice(0,E-n.maxBulletins).remove();y.prepend('<div class="bulletin-action">&#8230;</div>')}}}).fail(function(E,C,D){if(E.status===404){c("#bulletin-error-message").text(E.responseText).show();o.togglePolling()}else{g.handleAjaxError(E,C,D)}})},togglePolling:function(){if(o.polling===true){l()}else{w()}}};var o=new s();o.register();return o};return f}));