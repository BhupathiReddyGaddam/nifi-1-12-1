(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","Slick","nf.Canvas","nf.CanvasUtils","nf.ErrorHandler","nf.Dialog","nf.Storage","nf.Client","nf.Common","nf.ng.Bridge","nf.Processor","nf.ProcessGroup","nf.ProcessGroupConfiguration","nf.Shell"],function(j,q,g,o,h,n,i,k,p,f,l,m,c,e,d){return(nf.ComponentState=b(j,q,g,o,h,n,i,k,p,f,l,m,c,e,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ComponentState=b(require("jquery"),require("d3"),require("Slick"),require("nf.Canvas"),require("nf.CanvasUtils"),require("nf.ErrorHandler"),require("nf.Dialog"),require("nf.Storage"),require("nf.Client"),require("nf.Common"),require("nf.ng.Bridge"),require("nf.Processor"),require("nf.ProcessGroup"),require("nf.ProcessGroupConfiguration"),require("nf.Shell")))}else{nf.VariableRegistry=b(a.$,a.d3,a.Slick,a.nf.Canvas,a.nf.CanvasUtils,a.nf.ErrorHandler,a.nf.Dialog,a.nf.Storage,a.nf.Client,a.nf.Common,a.nf.ng.Bridge,a.nf.Processor,a.nf.ProcessGroup,a.nf.ProcessGroupConfiguration,a.nf.Shell)}}}(this,function(A,J,b,v,M,e,h,t,g,I,o,s,y,B,H){var D=null;var i=function(S){var T=this;var P="";var Q;var V;var U;var R;this.init=function(){var X=A("body");Q=S.item[S.column.field];V=A("<div></div>").addClass("slickgrid-editor").css({"z-index":100000,position:"absolute","border-radius":"2px","box-shadow":"rgba(0, 0, 0, 0.247059) 0px 2px 5px","background-color":"rgb(255, 255, 255)",overflow:"hidden",padding:"10px 20px",cursor:"move",transform:"translate3d(0px, 0px, 0px)"}).appendTo(X);R=A('<textarea hidefocus rows="5"/>').css({height:"80px",width:S.position.width+"px","min-width":"212px","margin-bottom":"5px","margin-top":"10px","white-space":"pre"}).tab().on("keydown",T.handleKeyDown).appendTo(V);V.draggable({cancel:".button, textarea, .nf-checkbox",containment:"parent"});var W=A('<div class="string-check-container" />');W.appendTo(V);U=A('<div class="nf-checkbox string-check" />').on("change",function(ab,aa){if(aa.isChecked){R.prop("disabled",true).val("")}else{R.prop("disabled",false).val(Q)}}).appendTo(W);A('<span class="string-check-label nf-checkbox-label">&nbsp;Set empty string</span>').appendTo(W);var Y=A('<div class="button">Ok</div>').css({color:"#fff",background:"#728E9B"}).hover(function(){A(this).css("background","#004849")},function(){A(this).css("background","#728E9B")}).on("click",T.save);var Z=A('<div class="secondary-button">Cancel</div>').css({color:"#004849",background:"#E3E8EB"}).hover(function(){A(this).css("background","#C7D2D7")},function(){A(this).css("background","#E3E8EB")}).on("click",T.cancel);A("<div></div>").css({position:"relative",top:"10px",left:"20px",width:"212px",clear:"both","float":"right"}).append(Y).append(Z).append('<div class="clear"></div>').appendTo(V);T.position(S.position);R.focus().select()};this.handleKeyDown=function(W){if(W.which===A.ui.keyCode.ENTER&&!W.shiftKey){T.save()}else{if(W.which===A.ui.keyCode.ESCAPE){T.cancel();W.stopImmediatePropagation();W.preventDefault()}}};this.save=function(){S.commitChanges()};this.cancel=function(){R.val(P);S.cancelChanges()};this.hide=function(){V.hide()};this.show=function(){V.show()};this.position=function(W){V.css({top:W.top-27,left:W.left-20})};this.destroy=function(){V.remove()};this.focus=function(){R.focus()};this.loadValue=function(X){var Y=false;if(I.isDefinedAndNotNull(X[S.column.field])){P=X[S.column.field];Y=P===""}var W=Y?"checkbox-checked":"checkbox-unchecked";U.addClass(W);R.val(P);R.select()};this.serializeValue=function(){if(R.val()===""){if(U.hasClass("checkbox-checked")){return""}else{return null}}else{return R.val()}};this.applyValue=function(W,X){W[S.column.field]=X};this.isValueChanged=function(){return T.serializeValue()!==Q};this.validate=function(){return{valid:true,msg:null}};this.init()};var k=function(R,V,X,W){var S=A(V.getCellNode(X,W));var T=S.offset();var P=A('<div class="property-detail"></div>').css({"z-index":1999,position:"absolute",padding:"10px 20px",overflow:"hidden","border-radius":"2px","box-shadow":"rgba(0, 0, 0, 0.247059) 0px 2px 5px","background-color":"rgb(255, 255, 255)",cursor:"move",transform:"translate3d(0px, 0px, 0px)",top:T.top-26,left:T.left-20}).draggable({containment:"parent"}).appendTo("body");A('<textarea hidefocus rows="5" readonly="readonly"/>').css({height:"80px",resize:"both",width:S.width()+"px",margin:"10px 0px","white-space":"pre"}).text(R.value).on("keydown",function(Y){if(Y.which===A.ui.keyCode.ESCAPE){Q();Y.stopImmediatePropagation();Y.preventDefault()}}).appendTo(P);var Q=function(){P.hide().remove()};var U=A('<div class="button">Ok</div>').css({position:"relative",top:"10px",left:"20px"}).hover(function(){A(this).css("background","#004849")},function(){A(this).css("background","#728E9B")}).on("click",function(){Q()});A("<div></div>").append(U).append('<div class="clear"></div>').appendTo(P)};var z={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,editable:true,enableAddRow:false,autoEdit:false,multiSelect:false,rowHeight:24};var m=function(P){var S=M.getSelection();if(S.empty()===false){var T=S.datum();if(T.id===P){if(T.permissions.canRead){return I.escapeHtml(T.component.name)}else{return I.escapeHtml(T.id)}}}var Q=o.injector.get("breadcrumbsCtrl").getBreadcrumbs();var R=P;A.each(Q,function(U,V){if(V.id===P){R=V.label;return false}});return R};var a=function(){var R=A("#variable-registry-table");var T=function(ab,Y,aa,Z,X){return I.escapeHtml(aa)};var Q=function(ab,Y,aa,Z,X){if(X.isOverridden){return'<div class="overridden" title="This value has been overridden by another variable in a descendant Process Group">'+I.escapeHtml(aa)+"</div>"}else{if(aa===""){return'<span class="table-cell blank">Empty string set</span>'}else{if(aa===null){return'<span class="unset">No value set</span>'}else{return I.escapeHtml(aa)}}}};var W=function(ab,Y,aa,Z,X){if(I.isDefinedAndNotNull(aa)){return I.escapeHtml(m(aa))}else{return"Controller"}};var S=function(ad,Y,ac,ab,X){var aa="";if(X.isEditable===true){aa+='<div title="Delete" class="delete-variable pointer fa fa-trash"></div>'}else{var Z=A("#variable-registry-process-group-id").text();if(X.processGroupId!==Z){aa+='<div title="Go To" class="go-to-variable pointer fa fa-long-arrow-right"></div>'}}return aa};var U=[{id:"scope",name:"Scope",field:"processGroupId",formatter:W,sortable:true,resizable:true},{id:"name",name:"Name",field:"name",formatter:T,sortable:true,resizable:true},{id:"value",name:"Value",field:"value",formatter:Q,sortable:true,resizable:true,cssClass:"pointer"},{id:"actions",name:"&nbsp;",resizable:false,formatter:S,sortable:false,width:45,maxWidth:45}];var P=new b.Data.DataView({inlineFilters:false});P.setFilterArgs({searchString:"",property:"hidden"});P.setFilter(function(Y,X){return Y.hidden===false});P.getItemMetadata=function(X){return{columns:{value:{editor:i}}}};O({columnId:"name",sortAsc:true},P);var V=new b.Grid(R,P,U,z);V.setSelectionModel(new b.RowSelectionModel());V.registerPlugin(new b.AutoTooltips());V.setSortColumn("name",true);V.onSort.subscribe(function(Y,X){O({columnId:X.sortCol.id,sortAsc:X.sortAsc},P)});V.onClick.subscribe(function(ab,Y){var X=P.getItem(Y.row);if(V.getColumns()[Y.cell].id==="value"){if(X.isEditable===true){V.gotoCell(Y.row,Y.cell,true)}else{V.setSelectedRows([Y.row]);k(X,V,Y.row,Y.cell)}ab.stopImmediatePropagation()}else{if(V.getColumns()[Y.cell].id==="actions"){var aa=A(ab.target);if(aa.hasClass("delete-variable")){P.updateItem(X.id,A.extend(X,{hidden:true}));var ac=P.getItems();A.each(ac,function(ad,ae){if(ae.isOverridden===true&&!f(ac,ae)){P.updateItem(ae.id,A.extend(ae,{isOverridden:false}))}});var Z=V.getSelectedRows();if(Z.length===0){V.setSelectedRows([0])}ab.stopImmediatePropagation()}else{if(aa.hasClass("go-to-variable")){w().done(function(){var ad=o.injector.get("breadcrumbsCtrl").getBreadcrumbs();A.each(ad,function(ae,af){if(af.id===X.processGroupId){if(I.isDefinedAndNotNull(af.parentBreadcrumb)){M.showComponent(af.parentBreadcrumb.id,af.id).done(function(){setTimeout(function(){x(X.processGroupId,X.name)},500)})}else{M.getComponentByType("ProcessGroup").enterGroup(af.id).done(function(){setTimeout(function(){x(X.processGroupId,X.name)},500)})}return false}})})}}}}});V.onSelectedRowsChanged.subscribe(function(Z,Y){if(A.isArray(Y.rows)&&Y.rows.length===1){if(V.getDataLength()>0){var aa=Y.rows[0];var X=V.getDataItem(aa);if(D===null||D!==X.id){A("#variable-affected-components-context").removeClass("unset").text(X.name);E(X.affectedComponents);D=X.id}}}});V.onBeforeCellEditorDestroy.subscribe(function(Y,X){setTimeout(function(){V.resizeCanvas()},50)});P.onRowCountChanged.subscribe(function(Y,X){V.updateRowCount();V.render()});P.onRowsChanged.subscribe(function(Y,X){V.invalidateRows(X.rows);V.render()});P.syncGridSelection(V,true);R.data("gridInstance",V)};var w=function(){var Q=A("#variable-registry-table").data("gridInstance");if(I.isDefinedAndNotNull(Q)){var P=Q.getEditController();P.commitCurrentEdit()}return A.Deferred(function(R){if(A("#variable-update-status").is(":visible")){F();R.resolve()}else{var S=n();if(A.isEmptyObject(S)){F();R.resolve()}else{h.showYesNoDialog({headerText:"Variables",dialogContent:"Save changes before leaving variable configuration?",noHandler:function(){F();R.resolve()},yesHandler:function(){N().done(function(){R.resolve()}).fail(function(){R.reject()})}})}}}).promise()};var O=function(P,R){var Q=function(U,S){if(P.columnId==="scope"){var X=I.isDefinedAndNotNull(U.processGroupId)?m(U.processGroupId):"";var W=I.isDefinedAndNotNull(S.processGroupId)?m(S.processGroupId):"";return X===W?0:X>W?1:-1}else{var T=I.isDefinedAndNotNull(U[P.columnId])?U[P.columnId]:"";var V=I.isDefinedAndNotNull(S[P.columnId])?S[P.columnId]:"";return T===V?0:T>V?1:-1}};R.sort(Q,P.sortAsc)};var L=function(Q,P){return Q.component.name.localeCompare(P.component.name)};var p=function(Q,P){var S=A('<li class="affected-component-container"></li>').appendTo(P);var R=Q.component;A('<div class="referencing-component-state"></div>').addClass(function(){if(I.isDefinedAndNotNull(R.state)){var T=A(this);var V=R.state.toLowerCase();if(V==="stopped"&&!I.isEmpty(R.validationErrors)){V="invalid";var U=I.formatUnorderedList(R.validationErrors);T.qtip(A.extend({},M.config.systemTooltipConfig,{content:U}))}return V}else{return""}}).appendTo(S);A('<span class="referencing-component-name link ellipsis affected-component-setting-width"></span>').text(R.name).prop("title",R.name).on("click",function(){w().done(function(){M.showComponent(R.processGroupId,R.id)})}).appendTo(S);A('<div class="referencing-component-bulletins"></div>').addClass(R.id+"-affected-bulletins").appendTo(S);A('<span class="referencing-component-active-thread-count"></span>').text(function(){if(I.isDefinedAndNotNull(R.activeThreadCount)&&R.activeThreadCount>0){return"("+R.activeThreadCount+")"}else{return""}}).appendTo(S)};var d=function(R,Q){var S=A('<li class="affected-component-container"></li>').appendTo(Q);var P=R.component;A('<div class="referencing-component-state"></div>').addClass(function(){if(I.isDefinedAndNotNull(P.state)){var T=A(this);var V=P.state==="ENABLED"?"enabled":"disabled";if(V==="disabled"&&!I.isEmpty(P.validationErrors)){V="invalid";var U=I.formatUnorderedList(P.validationErrors);T.qtip(A.extend({},M.config.systemTooltipConfig,{content:U}))}return V}else{return""}}).appendTo(S);A('<div class="referencing-component-bulletins"></div>').addClass(P.id+"-affected-bulletins").appendTo(S);A('<span class="referencing-component-name link ellipsis affected-component-setting-width"></span>').prop("title",P.name).text(P.name).on("click",function(){w().done(function(){B.showConfiguration(P.processGroupId).done(function(){B.selectControllerService(P.id)})})}).appendTo(S)};var E=function(T){var Q=[];var R=[];var P=[];var W=A("#variable-registry-affected-processors");I.cleanUpTooltips(W,"div.referencing-component-state");I.cleanUpTooltips(W,"div.referencing-component-bulletins");W.empty();var V=A("#variable-registry-affected-controller-services");I.cleanUpTooltips(V,"div.referencing-component-state");I.cleanUpTooltips(V,"div.referencing-component-bulletins");V.empty();var S=A("#variable-registry-affected-unauthorized-components").empty();if(I.isUndefined(T)){A('<li class="affected-component-container"><span class="unset">Pending Apply</span></li>').appendTo(W);A('<li class="affected-component-container"><span class="unset">Pending Apply</span></li>').appendTo(V);A('<li class="affected-component-container"><span class="unset">Pending Apply</span></li>').appendTo(S)}else{var U=[];A.each(T,function(X,Y){if(Y.permissions.canRead===true&&Y.permissions.canWrite===true){U.push(Y.id);if(Y.component.referenceType==="PROCESSOR"){Q.push(Y)}else{R.push(Y)}}else{if(Y.permissions.canRead===true){U.push(Y.id)}P.push(Y)}});if(Q.length===0){A('<li class="affected-component-container"><span class="unset">None</span></li>').appendTo(W)}else{Q.sort(L);A.each(Q,function(X,Y){p(Y,W)})}if(R.length===0){A('<li class="affected-component-container"><span class="unset">None</span></li>').appendTo(V)}else{R.sort(L);A.each(R,function(X,Y){d(Y,V)})}if(P.length===0){A('<li class="affected-component-container"><span class="unset">None</span></li>').appendTo(S)}else{P.sort(function(Y,X){if(Y.permissions.canRead===true&&X.permissions.canRead===true){var Z=Y.component.referenceType===X.component.referenceType?0:Y.component.referenceType>X.component.referenceType?-1:1;if(Z===0){Z=Y.component.name===X.component.name?0:Y.component.name>X.component.name?1:-1}return Z}else{if(Y.permissions.canRead===false&&X.permissions.canRead===false){return Y.id>X.id?1:-1}else{if(Y.permissions.canRead===true){return -1}else{return 1}}}});A.each(P,function(Z,X){if(X.permissions.canRead===true){if(X.component.referenceType==="PROCESSOR"){p(X,S)}else{d(X,S)}}else{var Y=A('<li class="affected-component-container"></li>').appendTo(S);A('<span class="referencing-component-name link ellipsis affected-component-setting-width"></span>').prop("title",X.id).text(X.id).on("click",function(){w().done(function(){A("#shell-dialog").modal("hide");if(X.referenceType==="PROCESSOR"){M.showComponent(X.processGroup.id,X.id)}else{if(X.referenceType==="CONTROLLER_SERVICE"){B.showConfiguration(X.processGroup.id).done(function(){y.enterGroup(X.processGroup.id);B.selectControllerService(X.id)})}}})}).appendTo(Y)}})}if(U.length>0){M.queryBulletins(U).done(function(Y){var Z=Y.bulletinBoard.bulletins;var X=J.nest().key(function(aa){return aa.sourceId}).map(Z,J.map);X.each(function(aa,ab){A("div."+ab+"-affected-bulletins").each(function(){var ad=A(this);if(aa.length>0){var ac=I.getFormattedBulletins(aa);var ae=I.formatUnorderedList(ac);ad.addClass("has-bulletins").show().qtip(A.extend({},M.config.systemTooltipConfig,{content:ae}))}})})})}}};var x=function(P,Q){return A.ajax({type:"GET",url:"../nifi-api/process-groups/"+encodeURIComponent(P)+"/variable-registry",dataType:"json"}).done(function(R){A("#process-group-variable-registry").text(m(P));A("#variable-registry-process-group-id").text(P).data("revision",R.processGroupRevision);l(R.variableRegistry,Q);A("#variable-registry-dialog").modal("show")}).fail(e.handleAjaxError)};var f=function(V,U){var T=[];A.each(V,function(X,W){if(U.name===W.name&&W.hidden===false){T.push(W)}});var S=false;if(T.length>1){var R=[];var Q=o.injector.get("breadcrumbsCtrl").getBreadcrumbs();A.each(Q,function(W,X){R.push(X.id)});var P=A("#variable-registry-process-group-id").text();if(R.indexOf(P)===-1){R.push(P)}A.each(R,function(X,W){for(var Y=0;Y<T.length;Y++){if(W===T[Y].processGroupId){if(U===T[Y]){S=true}T.splice(Y,1);if(T.length===1){return false}}}})}return S};var c=function(R){if(R.canWrite===true){var Q=A("#variable-registry-process-group-id").text();if(R.processGroupId===Q){var S=M.getSelection();if(S.empty()===false&&nf.CanvasUtils.isProcessGroup(S)){var U=S.datum();if(U.id===Q){return U.permissions.canWrite===true}}var T=false;var P=o.injector.get("breadcrumbsCtrl").getBreadcrumbs();A.each(P,function(V,W){if(W.id===Q){T=W.permissions.canWrite===true;return false}});return T}}return false};var K=0;var l=function(S,U){if(I.isDefinedAndNotNull(S)){var T=0;var V=A("#variable-registry-table").data("gridInstance");var Q=V.getData();Q.beginUpdate();var W=[];A.each(S.variables,function(aa,Y){var Z=Y.variable;W.push({id:K++,hidden:false,canWrite:Y.canWrite,name:Z.name,value:Z.value,previousValue:Z.value,processGroupId:Z.processGroupId,affectedComponents:Z.affectedComponents})});A.each(W,function(Z,Y){Q.addItem(A.extend({isOverridden:f(W,Y),isEditable:c(Y)},Y))});Q.endUpdate();Q.reSort();if(I.isDefinedAndNotNull(U)){A.each(W,function(Z,Y){if(S.processGroupId===Y.processGroupId&&Y.name===U){T=Q.getRowById(Y.id)}})}if(W.length===0){var P=A("#variable-registry-affected-processors");I.cleanUpTooltips(P,"div.referencing-component-state");I.cleanUpTooltips(P,"div.referencing-component-bulletins");P.empty();var X=A("#variable-registry-affected-controller-services");I.cleanUpTooltips(X,"div.referencing-component-state");I.cleanUpTooltips(X,"div.referencing-component-bulletins");X.empty();var R=A("#variable-registry-affected-unauthorized-components").empty();A('<li class="affected-component-container"><span class="unset">None</span></li>').appendTo(P);A('<li class="affected-component-container"><span class="unset">None</span></li>').appendTo(X);A('<li class="affected-component-container"><span class="unset">None</span></li>').appendTo(R);A("#variable-affected-components-context").addClass("unset").text("None")}else{V.setSelectedRows([T])}}};var q=function(S,R,Q){var P=A("#variable-update-steps").empty();A.each(S,function(V,U){var T=A("<li></li>").text(U.description).appendTo(P);A('<div class="variable-step"></div>').addClass(function(){if(I.isDefinedAndNotNull(U.failureReason)){return"ajax-error"}else{if(U.complete===true){return"ajax-complete"}else{return R===true||Q===true?"ajax-error":"ajax-loading"}}}).appendTo(T);A('<div class="clear"></div>').appendTo(T)})};var N=function(){var R=n();if(R.length===0){F();return}var Q=R.map(function(S){return S.variable.name});A("#variable-affected-components-context").removeClass("unset").text(Q.join(", "));var P=A("#variable-registry-process-group-id").text();return A.Deferred(function(S){var V=function(){A("#variable-registry-dialog").modal("setButtonModel",[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){S.resolve();F()}}}])};var T=false;A("#variable-registry-dialog").modal("setButtonModel",[{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){T=true;V()}}}]);var W;var U=function(Z,X,Y){if(I.isDefinedAndNotNull(W)){G(P,W)}A("#variable-update-steps").find("div.variable-step.ajax-loading").removeClass("ajax-loading").addClass("ajax-error");V()};u(P,R).done(function(X){var Y=function(ab){var aa=ab.request;var Z=I.isDefinedAndNotNull(aa.failureReason);W=aa.requestId;E(aa.affectedComponents);q(aa.updateSteps,T,Z);if(T){G(aa.processGroupId,W)}else{if(aa.complete===true){if(Z){h.showOkDialog({headerText:"Variable Update Error",dialogContent:"Unable to complete variable update request: "+I.escapeHtml(aa.failureReason)})}A.each(aa.affectedComponents,function(ac,ae){if(ae.permissions.canRead===true){var ad=ae.component;if(ad.referenceType==="PROCESSOR"&&M.getGroupId()===ad.processGroupId){s.reload(ad.id)}}});if(M.getGroupId()!==aa.processGroupId){y.reload(aa.processGroupId)}G(aa.processGroupId,W);V()}else{setTimeout(function(){r(aa.processGroupId,W).done(function(ac){Y(ac)}).fail(U)},2000)}}};A("#variable-registry-table, #add-variable").hide();A("#variable-update-status").show();Y(X)}).fail(U)}).promise()};var u=function(P,S){var R=A("#variable-registry-process-group-id").data("revision");var Q={processGroupRevision:g.getRevision({revision:{version:R.version}}),disconnectedNodeAcknowledged:t.isDisconnectionAcknowledged(),variableRegistry:{processGroupId:P,variables:S}};return A.ajax({type:"POST",data:JSON.stringify(Q),url:"../nifi-api/process-groups/"+encodeURIComponent(P)+"/variable-registry/update-requests",dataType:"json",contentType:"application/json"}).fail(e.handleAjaxError)};var r=function(P,Q){return A.ajax({type:"GET",url:"../nifi-api/process-groups/"+encodeURIComponent(P)+"/variable-registry/update-requests/"+encodeURIComponent(Q),dataType:"json"}).fail(e.handleAjaxError)};var G=function(P,Q){return A.ajax({type:"DELETE",url:"../nifi-api/process-groups/"+encodeURIComponent(P)+"/variable-registry/update-requests/"+encodeURIComponent(Q)+"?"+A.param({disconnectedNodeAcknowledged:t.isDisconnectionAcknowledged()}),dataType:"json"}).fail(e.handleAjaxError)};var n=function(){var R=[];var Q=A("#variable-registry-table").data("gridInstance");var P=Q.getData();A.each(P.getItems(),function(){var T={name:this.name};var S=false;if(this.hidden===true&&this.previousValue!==null){T.value=null;S=true}else{if(this.value!==this.previousValue){T.value=this.value;S=true}}if(S){R.push({variable:T})}});return R};var C=function(){var W=A("#variable-registry-process-group-id").text();var U=A.trim(A("#new-variable-name").val());if(U!==""){var T=A("#variable-registry-table").data("gridInstance");var Q=T.getData();var R=[];var X=null;A.each(Q.getItems(),function(Y,Z){if(U===Z.name){if(W===Z.processGroupId){X=Z}else{R.push(Z)}}});if(X===null){Q.addItem({id:K,hidden:false,canWrite:true,name:U,value:null,previousValue:null,processGroupId:W,isEditable:true,isOverridden:false});A.each(R,function(Y,Z){Q.updateItem(Z.id,A.extend(Z,{isOverridden:true}))});Q.reSort();var V=Q.getRowById(K);T.setActiveCell(V,T.getColumnIndex("value"));T.editActiveCell();K++}else{if(X.hidden===true){Q.updateItem(X.id,A.extend(X,{hidden:false,value:null}));var S=Q.getRowById(X.id);T.setActiveCell(S,T.getColumnIndex("value"));T.editActiveCell()}else{h.showOkDialog({headerText:"Variable Exists",dialogContent:"A variable with this name already exists."});var P=Q.getRowById(X.id);T.setSelectedRows([P]);T.scrollRowIntoView(P)}}A("#new-variable-dialog").modal("hide")}else{h.showOkDialog({headerText:"Configuration Error",dialogContent:"The name of the variable must be specified."})}};var F=function(){A("#variable-registry-dialog").modal("hide")};var j=function(){A("#variable-registry-table, #add-variable").show();A("#variable-update-status").hide();A("#process-group-variable-registry").text("");A("#variable-registry-process-group-id").text("").removeData("revision");A("#variable-affected-components-context").removeClass("unset").text("");var S=A("#variable-registry-table").data("gridInstance");var P=S.getData();P.setItems([]);var R=A("#variable-registry-affected-processors");I.cleanUpTooltips(R,"div.referencing-component-state");I.cleanUpTooltips(R,"div.referencing-component-bulletins");R.empty();var Q=A("#variable-registry-affected-controller-services");I.cleanUpTooltips(Q,"div.referencing-component-state");I.cleanUpTooltips(Q,"div.referencing-component-bulletins");Q.empty();A("#variable-registry-affected-unauthorized-components").empty();D=null};return{init:function(){A("#variable-registry-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Variables",handler:{close:function(){j()},open:function(){var P=A("#variable-registry-table").data("gridInstance");if(I.isDefinedAndNotNull(P)){P.resizeCanvas()}}}});A("#new-variable-dialog").modal({headerText:"New Variable",buttons:[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){C()}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){A("#new-variable-dialog").modal("hide")}}}],handler:{close:function(){A("#new-variable-name").val("")},open:function(){A("#new-variable-name").focus()}}});A("#new-variable-name").on("keydown",function(Q){var P=Q.keyCode?Q.keyCode:Q.which;if(P===A.ui.keyCode.ENTER){C();Q.stopImmediatePropagation();Q.preventDefault()}});A("#add-variable").on("click",function(){A("#new-variable-dialog").modal("show")});A("#parameters-documentation-link").on("click",function(){H.showPage("../nifi-docs/html/user-guide.html#Parameters")});a()},showVariables:function(P){A("#variable-registry-dialog").modal("setButtonModel",[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){N()}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){F()}}}]);return x(P)}}}));