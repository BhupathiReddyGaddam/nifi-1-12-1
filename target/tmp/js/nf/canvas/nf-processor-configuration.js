(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.ErrorHandler","nf.Common","nf.Dialog","nf.Storage","nf.Client","nf.CanvasUtils","nf.ng.Bridge","nf.Processor","nf.ClusterSummary","nf.CustomUi","nf.UniversalCapture","nf.Connection"],function(f,n,c,e,g,o,d,h,m,l,k,i,j){return(nf.ProcessorConfiguration=b(f,n,c,e,g,o,d,h,m,l,k,i,j))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ProcessorConfiguration=b(require("jquery"),require("nf.ErrorHandler"),require("nf.Common"),require("nf.Dialog"),require("nf.Storage"),require("nf.Client"),require("nf.CanvasUtils"),require("nf.ng.Bridge"),require("nf.Processor"),require("nf.ClusterSummary"),require("nf.CustomUi"),require("nf.UniversalCapture"),require("nf.Connection")))}else{nf.ProcessorConfiguration=b(a.$,a.nf.ErrorHandler,a.nf.Common,a.nf.Dialog,a.nf.Storage,a.nf.Client,a.nf.CanvasUtils,a.nf.ng.Bridge,a.nf.Processor,a.nf.ClusterSummary,a.nf.CustomUi,a.nf.UniversalCapture,a.nf.Connection)}}}(this,function(e,h,j,o,f,A,v,B,n,i,a,u,k){var y;var l=[0,25,50,100,250,500,1000,2000];var x="status.aggregateSnapshot.activeThreadCount",g="status.aggregateSnapshot.runStatus",c="bulletins";var q=function(C){var D=[{text:"Timer driven",value:"TIMER_DRIVEN",description:"Processor will be scheduled to run on an interval defined by the run schedule."}];if(C.supportsEventDriven===true){D.push({text:"Event driven",value:"EVENT_DRIVEN",description:"Processor will be scheduled to run when triggered by an event (e.g. a FlowFile enters an incoming queue). This scheduling strategy is experimental."})}else{if(C.config.schedulingStrategy==="EVENT_DRIVEN"){D.push({text:"Event driven",value:"EVENT_DRIVEN",description:"Processor will be scheduled to run when triggered by an event (e.g. a FlowFile enters an incoming queue). This scheduling strategy is experimental.",disabled:true})}}if(C.config.schedulingStrategy==="PRIMARY_NODE_ONLY"){D.push({text:"On primary node",value:"PRIMARY_NODE_ONLY",description:"Processor will be scheduled on the primary node on an interval defined by the run schedule. This option has been deprecated, please use the Execution setting below.",disabled:true})}D.push({text:"CRON driven",value:"CRON_DRIVEN",description:"Processor will be scheduled to run on at specific times based on the specified CRON string."});return D};var d=function(C){return[{text:"All nodes",value:"ALL",description:"Processor will be scheduled to run on all nodes",disabled:C.executionNodeRestricted===true},{text:"Primary node",value:"PRIMARY",description:"Processor will be scheduled to run only on the primary node"}]};var p=function(H){var C=e('<div class="relationship-name nf-checkbox-label ellipsis"></div>').text(H.name);var E=e('<span class="relationship-name-value hidden"></span>').text(H.name);var F=e('<div class="processor-relationship nf-checkbox"></div>');if(H.autoTerminate===true){F.addClass("checkbox-checked")}else{F.addClass("checkbox-unchecked")}var G=e('<div class="processor-relationship-container"></div>').append(F).append(C).append(E).appendTo("#auto-terminate-relationship-names");if(!j.isBlank(H.description)){var D=e('<div class="relationship-description"></div>').text(H.description);G.append(D)}return G};var z=function(){var E=e("#processor-configuration").data("processorDetails");var F=false;var G=s();e.each(E.relationships,function(I,J){if(J.autoTerminate===true){if(e.inArray(J.name,G)===-1){F=true;return false}}else{if(J.autoTerminate===false){if(e.inArray(J.name,G)>=0){F=true;return false}}}});if(F){return true}var H=e("#scheduling-strategy-combo").combo("getSelectedOption").value;if(H!==(E.config.schedulingStrategy+"")){return true}if(E.supportsParallelProcessing===true){var C;if(H==="EVENT_DRIVEN"){C=e("#event-driven-concurrently-schedulable-tasks")}else{if(H==="CRON_DRIVEN"){C=e("#cron-driven-concurrently-schedulable-tasks")}else{C=e("#timer-driven-concurrently-schedulable-tasks")}}if(C.val()!==(E.config.concurrentlySchedulableTaskCount+"")){return true}}var D;if(H==="CRON_DRIVEN"){D=e("#cron-driven-scheduling-period")}else{if(H!=="EVENT_DRIVEN"){D=e("#timer-driven-scheduling-period")}}if(j.isDefinedAndNotNull(D)&&D.val()!==(E.config.schedulingPeriod+"")){return true}if(e("#execution-node-combo").combo("getSelectedOption").value!==(E.config.executionNode+"")){return true}if(e("#processor-name").val()!==E.name){return true}if(e("#processor-enabled").hasClass("checkbox-checked")&&E.state==="DISABLED"){return true}else{if(e("#processor-enabled").hasClass("checkbox-unchecked")&&(E.state==="RUNNING"||E.state==="STOPPED")){return true}}if(e("#penalty-duration").val()!==(E.config.penaltyDuration+"")){return true}if(e("#yield-duration").val()!==(E.config.yieldDuration+"")){return true}if(e("#bulletin-level-combo").combo("getSelectedOption").value!==(E.config.bulletinLevel+"")){return true}if(e("#processor-comments").val()!==E.config.comments){return true}return e("#processor-properties").propertytable("isSaveRequired")};var m=function(E){var G={};var C=e("#scheduling-strategy-combo").combo("getSelectedOption").value;var J;if(C==="EVENT_DRIVEN"){J=e("#event-driven-concurrently-schedulable-tasks")}else{if(C==="CRON_DRIVEN"){J=e("#cron-driven-concurrently-schedulable-tasks")}else{J=e("#timer-driven-concurrently-schedulable-tasks")}}if(!J.is(":disabled")){G.concurrentlySchedulableTaskCount=J.val()}var H;if(C==="CRON_DRIVEN"){H=e("#cron-driven-scheduling-period")}else{if(C!=="EVENT_DRIVEN"){H=e("#timer-driven-scheduling-period")}}if(j.isDefinedAndNotNull(H)){G.schedulingPeriod=H.val()}G.executionNode=e("#execution-node-combo").combo("getSelectedOption").value;G.penaltyDuration=e("#penalty-duration").val();G.yieldDuration=e("#yield-duration").val();G.bulletinLevel=e("#bulletin-level-combo").combo("getSelectedOption").value;G.schedulingStrategy=C;G.comments=e("#processor-comments").val();if(E.supportsBatching===true){var D=e("#run-duration-slider").slider("value");G.runDurationMillis=l[D]}G.autoTerminatedRelationships=s();var I=e("#processor-properties").propertytable("marshalProperties");if(e.isEmptyObject(I)===false){G.properties=I}var F={};F.id=e("#processor-id").text();F.name=e("#processor-name").val();F.config=G;if(e("#processor-enabled").hasClass("checkbox-unchecked")){F.state="DISABLED"}else{if(e("#processor-enabled").hasClass("checkbox-checked")){F.state="STOPPED"}}var K={};K.component=F;return K};var s=function(){var D=e("#auto-terminate-relationship-names");var C=[];e.each(D.children(),function(E,H){var G=e(H);var F=G.children("div.processor-relationship");if(F.hasClass("checkbox-checked")){C.push(G.children("span.relationship-name-value").text())}});return C};var w=function(D){var F=[];var E=D.component;var C=E.config;if(j.isDefinedAndNotNull(C.concurrentlySchedulableTaskCount)&&!e.isNumeric(C.concurrentlySchedulableTaskCount)){F.push("Concurrent tasks must be an integer value")}if(j.isDefinedAndNotNull(C.schedulingPeriod)&&j.isBlank(C.schedulingPeriod)){F.push("Run schedule must be specified")}if(j.isBlank(C.penaltyDuration)){F.push("Penalty duration must be specified")}if(j.isBlank(C.yieldDuration)){F.push("Yield duration must be specified")}if(F.length>0){o.showOkDialog({dialogContent:j.formatUnorderedList(F),headerText:"Configuration Error"});return false}else{return true}};var b=function(D){var C=k.getComponentConnections(D.id);e.each(C,function(F,E){if(E.permissions.canRead){if(E.sourceId===D.id){k.reload(E.id)}}})};var r=function(){return e.Deferred(function(C){e("#processor-properties").propertytable("saveRow");if(z()){o.showYesNoDialog({headerText:"Processor Configuration",dialogContent:"Save changes before going to this Controller Service?",noHandler:function(){C.resolve()},yesHandler:function(){var D=e("#processor-configuration").data("processorDetails");t(D).done(function(){C.resolve()}).fail(function(){C.reject()})}})}else{C.resolve()}}).promise()};var t=function(C){var D=m(C);if(w(D)){var E=n.get(C.id);D.revision=A.getRevision(E);D.disconnectedNodeAcknowledged=f.isDisconnectionAcknowledged();return e.ajax({type:"PUT",data:JSON.stringify(D),url:E.uri,dataType:"json",contentType:"application/json"}).done(function(F){n.set(F)}).fail(h.handleConfigurationUpdateAjaxError)}else{return e.Deferred(function(F){F.reject()}).promise()}};return{init:function(C){y=C;e("#processor-configuration-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Settings",tabContentId:"processor-standard-settings-tab-content"},{name:"Scheduling",tabContentId:"processor-scheduling-tab-content"},{name:"Properties",tabContentId:"processor-properties-tab-content"},{name:"Comments",tabContentId:"processor-comments-tab-content"}],select:function(){u.removeAllPropertyDetailDialogs();if(e(this).text()==="Properties"){e("#processor-properties").propertytable("resetTableSize")}e("#processor-properties").propertytable("saveRow");var D=e("#auto-terminate-relationship-names");if(D.is(":visible")&&D.get(0).scrollHeight>Math.round(D.innerHeight())){D.css("border-width","1px")}}});e("#processor-configuration").modal({scrollableContentStyle:"scrollable",headerText:"Configure Processor",handler:{close:function(){e("#auto-terminate-relationship-names").css("border-width","0").empty();e("#processor-properties").propertytable("cancelEdit").propertytable("clear");e("#processor-configuration").removeData("processorDetails");if(y.supportsStatusBar){e("#processor-configuration-status-bar").statusbar("disconnect")}},open:function(){j.toggleScrollable(e("#"+this.find(".tab-container").attr("id")+"-content").get(0))}}});if(y.supportsStatusBar){e("#processor-configuration-status-bar").statusbar()}e("#bulletin-level-combo").combo({options:[{text:"DEBUG",value:"DEBUG"},{text:"INFO",value:"INFO"},{text:"WARN",value:"WARN"},{text:"ERROR",value:"ERROR"},{text:"NONE",value:"NONE"}]});e("#run-duration-slider").slider({min:0,max:l.length-1,change:function(E,F){var D=e("#processor-configuration").data("processorDetails");if(F.value>0&&(D.inputRequirement==="INPUT_FORBIDDEN"||D.inputRequirement==="INPUT_ALLOWED")){e("#run-duration-data-loss").show()}else{e("#run-duration-data-loss").hide()}}});e("#processor-properties").propertytable({readOnly:false,supportsGoTo:true,dialogContainer:"#new-processor-property-container",descriptorDeferred:function(D){var E=e("#processor-configuration").data("processorDetails");var F=n.get(E.id);return e.ajax({type:"GET",url:F.uri+"/descriptors",data:{propertyName:D},dataType:"json"}).fail(h.handleAjaxError)},parameterDeferred:function(D,E){return e.Deferred(function(F){if(j.isDefinedAndNotNull(E)){var G=v.getParameterContext();if(j.isDefinedAndNotNull(G)){e.ajax({type:"GET",url:"../nifi-api/parameter-contexts/"+encodeURIComponent(G.id),dataType:"json"}).done(function(I){var H=j.isSensitiveProperty(D);F.resolve(I.component.parameters.map(function(J){return J.parameter}).filter(function(J){return J.sensitive===H}))}).fail(function(){F.resolve([])})}else{F.resolve([])}}else{F.resolve([])}}).promise()},goToServiceDeferred:r,getParameterContext:function(D){return v.getParameterContext()}})},showConfiguration:function(E,C){if(v.isProcessor(E)){var F=E.datum();var D=F.component;var G=[];G.push(n.reload(D.id));G.push(e.ajax({type:"GET",url:"../nifi-api/flow/history/components/"+encodeURIComponent(D.id),dataType:"json"}));e.when.apply(window,G).done(function(P,S){var Q=P[0];D=Q.component;var M=S[0].componentHistory;e("#processor-configuration").data("processorDetails",D);var L="checkbox-checked";if(D.state==="DISABLED"){L="checkbox-unchecked"}e("#processor-id").text(D.id);e("#processor-type").text(j.formatType(D));e("#processor-bundle").text(j.formatBundle(D.bundle));e("#processor-name").val(D.name);e("#processor-enabled").removeClass("checkbox-unchecked checkbox-checked").addClass(L);e("#penalty-duration").val(D.config.penaltyDuration);e("#yield-duration").val(D.config.yieldDuration);e("#processor-comments").val(D.config.comments);if(D.supportsBatching===true){e("#run-duration-setting-container").show();var R=l.indexOf(D.config.runDurationMillis);e("#run-duration-slider").slider("value",R)}else{e("#run-duration-setting-container").hide()}e("#bulletin-level-combo").combo("setSelectedOption",{value:D.config.bulletinLevel});var J=D.config.schedulingStrategy;e("#scheduling-strategy-combo").combo({options:q(D),selectedOption:{value:J},select:function(U){if(U.value==="EVENT_DRIVEN"){e("#event-driven-warning").show();e("#timer-driven-options").hide();e("#event-driven-options").show();e("#cron-driven-options").hide()}else{e("#event-driven-warning").hide();if(U.value==="CRON_DRIVEN"){e("#timer-driven-options").hide();e("#event-driven-options").hide();e("#cron-driven-options").show()}else{e("#timer-driven-options").show();e("#event-driven-options").hide();e("#cron-driven-options").hide()}}}});var I=D.config.executionNode;e("#execution-node-combo").combo({options:d(D),selectedOption:{value:I}});e("#execution-node-options").show();var T=D.config.defaultConcurrentTasks;e("#timer-driven-concurrently-schedulable-tasks").val(T.TIMER_DRIVEN);e("#event-driven-concurrently-schedulable-tasks").val(T.EVENT_DRIVEN);e("#cron-driven-concurrently-schedulable-tasks").val(T.CRON_DRIVEN);var O;if(J==="EVENT_DRIVEN"){O=e("#event-driven-concurrently-schedulable-tasks").val(D.config.concurrentlySchedulableTaskCount)}else{if(J==="CRON_DRIVEN"){O=e("#cron-driven-concurrently-schedulable-tasks").val(D.config.concurrentlySchedulableTaskCount)}else{O=e("#timer-driven-concurrently-schedulable-tasks").val(D.config.concurrentlySchedulableTaskCount)}}if(j.isDefinedAndNotNull(O)){if(D.supportsParallelProcessing===true){O.prop("disabled",false)}else{O.prop("disabled",true)}}var K=D.config.defaultSchedulingPeriod;e("#cron-driven-scheduling-period").val(K.CRON_DRIVEN);e("#timer-driven-scheduling-period").val(K.TIMER_DRIVEN);if(D.config.schedulingStrategy==="CRON_DRIVEN"){e("#cron-driven-scheduling-period").val(D.config.schedulingPeriod)}else{if(D.config.schedulingStrategy!=="EVENT_DRIVEN"){e("#timer-driven-scheduling-period").val(D.config.schedulingPeriod)}}if(!j.isEmpty(D.relationships)){e.each(D.relationships,function(U,V){p(V)})}else{e("#auto-terminate-relationship-names").append('<div class="unset">This processor has no relationships.</div>')}var N=[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){return !v.supportsModification(E)},handler:{click:function(){e("#processor-properties").propertytable("saveRow");t(D).done(function(U){b(D);e("#processor-configuration").modal("hide");B.digest()})}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){e("#processor-configuration").modal("hide")}}}];if(j.isDefinedAndNotNull(D.config.customUiUrl)&&D.config.customUiUrl!==""){N.push({buttonText:"Advanced",clazz:"fa fa-cog button-icon",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){var U=function(){e("#processor-configuration").modal("hide");a.showCustomUi(Q,D.config.customUiUrl,true).done(function(){n.reload(D.id);b(D)})};e("#processor-properties").propertytable("saveRow");if(z()){o.showYesNoDialog({headerText:"Save",dialogContent:"Save changes before opening the advanced configuration?",noHandler:U,yesHandler:function(){t(D).done(function(V){U()})}})}else{U()}}}})}if(y.supportsStatusBar){e("#processor-configuration-status-bar").statusbar("observe",D.id,function(){e("#processor-configuration").modal("refreshButtons")});if(j.isDefinedAndNotNull(y.nfActions)&&j.getKeyValue(Q,x)!=0){e("#processor-configuration-status-bar").statusbar("buttons",[{buttonText:"Terminate",clazz:"fa fa-hourglass-end button-icon",color:{hover:"#C7D2D7",base:"transparent",text:"#004849"},disabled:function(){return v.supportsModification(E)},handler:{click:function(){var U=function(){var V=n.get(D.id);if(j.getKeyValue(V,x)!=0){o.showOkDialog({dialogContent:"Terminate threads request was processed, but active threads still persist. Please try again later.",headerText:"Unable to Terminate"})}else{e("#processor-configuration-status-bar").statusbar("refreshButtons");e("#processor-configuration").modal("refreshButtons")}e("#processor-configuration-status-bar").statusbar("showButtons")};e("#processor-configuration-status-bar").statusbar("hideButtons");y.nfActions.terminate(E,U)}}}])}}e("#processor-configuration").modal("setButtonModel",N);e("#processor-properties").propertytable("setGroupId",D.parentGroupId).propertytable("loadProperties",D.config.properties,D.config.descriptors,M.propertyHistory);e("#processor-configuration").modal("show");e("#processor-configuration div.relationship-name").ellipsis();var H=e("#auto-terminate-relationship-names");if(H.is(":visible")&&H.get(0).scrollHeight>Math.round(H.innerHeight())){H.css("border-width","1px")}if(e("#processor-configuration-tabs").find(".selected-tab").text()==="Properties"&&e("#processor-properties").find(".slick-viewport").height()==0){e("#processor-properties").propertytable("resetTableSize")}if(typeof C=="function"){C()}}).fail(h.handleAjaxError)}}}}));