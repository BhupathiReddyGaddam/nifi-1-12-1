(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","Slick","d3","nf.Client","nf.Dialog","nf.Storage","nf.Common","nf.CanvasUtils","nf.ControllerServices","nf.ErrorHandler","nf.FilteredDialogCommon","nf.ReportingTask","nf.Shell","nf.ComponentState","nf.ComponentVersion","nf.PolicyManagement"],function(j,f,q,r,i,k,g,h,d,m,l,n,e,p,c,o){return(nf.Settings=b(j,f,q,r,i,k,g,h,d,m,l,n,e,p,c,o))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Settings=b(require("jquery"),require("Slick"),require("d3"),require("nf.Client"),require("nf.Dialog"),require("nf.Storage"),require("nf.Common"),require("nf.CanvasUtils"),require("nf.ControllerServices"),require("nf.ErrorHandler"),require("nf.FilteredDialogCommon"),require("nf.ReportingTask"),require("nf.Shell"),require("nf.ComponentState"),require("nf.ComponentVersion"),require("nf.PolicyManagement")))}else{nf.Settings=b(a.$,a.Slick,a.d3,a.nf.Client,a.nf.Dialog,a.nf.Storage,a.nf.Common,a.nf.CanvasUtils,a.nf.ControllerServices,a.nf.ErrorHandler,a.nf.FilteredDialogCommon,a.nf.ReportingTask,a.nf.Shell,a.nf.ComponentState,a.nf.ComponentVersion,a.nf.PolicyManagement)}}}(this,function(A,a,O,i,k,s,M,T,H,d,R,B,K,e,t,w){var F={urls:{api:"../nifi-api",controllerConfig:"../nifi-api/controller/config",reportingTaskTypes:"../nifi-api/flow/reporting-task-types",createReportingTask:"../nifi-api/controller/reporting-tasks",reportingTasks:"../nifi-api/flow/reporting-tasks",registries:"../nifi-api/controller/registry-clients"}};var z={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,autoEdit:false,multiSelect:false,rowHeight:24};var r=function(){return A("#controller-services-table")};var Q=function(Y){var X=[];if(M.isDefinedAndNotNull(Y.maxTimerDrivenThreadCount)&&!A.isNumeric(Y.maxTimerDrivenThreadCount)){X.push("Maximum Timer Driven Thread Count must be an integer value")}if(M.isDefinedAndNotNull(Y.maxEventDrivenThreadCount)&&!A.isNumeric(Y.maxEventDrivenThreadCount)){X.push("Maximum Event Driven Thread Count must be an integer value")}if(X.length>0){k.showOkDialog({dialogContent:M.formatUnorderedList(X),headerText:"Configuration Error"});return false}else{return true}};var m=function(X){var Z=S();if(Q(Z)){var Y={revision:i.getRevision({revision:{version:X}}),disconnectedNodeAcknowledged:s.isDisconnectionAcknowledged(),component:Z};A.ajax({type:"PUT",url:F.urls.controllerConfig,data:JSON.stringify(Y),dataType:"json",contentType:"application/json"}).done(function(aa){k.showOkDialog({headerText:"Settings",dialogContent:"Settings successfully applied."});A("#settings-save").off("click").on("click",function(){m(aa.revision.version)})}).fail(d.handleConfigurationUpdateAjaxError)}};var j=function(){};var S=function(){var X={};X.maxTimerDrivenThreadCount=A("#maximum-timer-driven-thread-count-field").val();X.maxEventDrivenThreadCount=A("#maximum-event-driven-thread-count-field").val();return X};var W=function(Z,Y){if(Y.searchString===""){return true}try{var ac=new RegExp(Y.searchString,"i")}catch(ab){return false}var aa=Z.label.search(ac)>=0;var X=Z.tags.search(ac)>=0;return aa||X};var o=function(Z,X){var Y=[];A.each(Z,function(ac,ad){Y.push(ad)});var aa=X.toLowerCase();var ab=true;A.each(Y,function(ac,ad){if(aa.indexOf(ad)===-1){ab=false;return false}});return ab};var n=function(X){return X.restricted===false||M.canAccessComponentRestrictions(X.explicitRestrictions)};var v=function(ab,Y,aa,Z,X){if(!X.permissions.canRead){return'<span class="blank">'+M.escapeHtml(X.id)+"</span>"}return M.escapeHtml(X.component.name)};var U=function(X,Z){var Y=function(ah,ag){if(ah.permissions.canRead&&ag.permissions.canRead){if(X.columnId==="moreDetails"){var ad=0;if(!M.isEmpty(ah.bulletins)){ad=ah.bulletins.length}var aa=0;if(!M.isEmpty(ag.bulletins)){aa=ag.bulletins.length}return ad-aa}else{if(X.columnId==="type"){var ae=M.isDefinedAndNotNull(ah.component[X.columnId])?M.substringAfterLast(ah.component[X.columnId],"."):"";var ac=M.isDefinedAndNotNull(ag.component[X.columnId])?M.substringAfterLast(ag.component[X.columnId],"."):"";return ae===ac?0:ae>ac?1:-1}else{if(X.columnId==="state"){var af;if(ah.component.validationStatus==="VALIDATING"){af="Validating"}else{if(ah.component.validationStatus==="INVALID"){af="Invalid"}else{af=M.isDefinedAndNotNull(ah.component[X.columnId])?ah.component[X.columnId]:""}}var aj;if(ag.component.validationStatus==="VALIDATING"){aj="Validating"}else{if(ag.component.validationStatus==="INVALID"){aj="Invalid"}else{aj=M.isDefinedAndNotNull(ag.component[X.columnId])?ag.component[X.columnId]:""}}return af===aj?0:af>aj?1:-1}else{var ab=M.isDefinedAndNotNull(ah.component[X.columnId])?ah.component[X.columnId]:"";var ai=M.isDefinedAndNotNull(ag.component[X.columnId])?ag.component[X.columnId]:"";return ab===ai?0:ab>ai?1:-1}}}}else{if(!ah.permissions.canRead&&!ag.permissions.canRead){return 0}if(ah.permissions.canRead){return 1}else{return -1}}};Z.sort(Y,X.sortAsc)};var C=function(){return A("#reporting-task-type-filter").val()};var p=function(){var Y=A("#reporting-task-types-table").data("gridInstance");if(M.isDefinedAndNotNull(Y)){var X=Y.getData();X.setFilterArgs({searchString:C()});X.refresh();A("#new-reporting-task-dialog").modal("refreshButtons");if(X.getLength()>0){R.choseFirstRow(Y)}}};var P=function(){A("#reporting-task-type-description").attr("title","").text("");A("#reporting-task-type-name").attr("title","").text("");A("#reporting-task-type-bundle").attr("title","").text("");A("#selected-reporting-task-name").text("");A("#selected-reporting-task-type").text("").removeData("bundle");A("#reporting-task-description-container").hide()};var h=function(){P();var X=A("#reporting-task-types-table").data("gridInstance");X.resetActiveCell()};var I=function(af,aa){var ad=W(af,aa);var Z=true;if(ad){var ae=A("#reporting-task-tag-cloud").tagcloud("getSelectedTags");var ac=ae.length>0;if(ac){Z=o(ae,af.tags)}}var ab=true;if(ad&&Z){var X=A("#reporting-task-bundle-group-combo").combo("getSelectedOption");if(M.isDefinedAndNotNull(X)&&X.value!==""){ab=(af.bundle.group===X.value)}}var Y=ad&&Z&&ab;if(Y===false&&A("#selected-reporting-task-type").text()===af.type){h()}return Y};var L=function(){var Y=A("#selected-reporting-task-type").text();var X=A("#selected-reporting-task-type").data("bundle");if(Y===""){k.showOkDialog({headerText:"Settings",dialogContent:"The type of reporting task to create must be selected."})}else{l(Y,X)}};var l=function(X,Z){var aa={revision:i.getRevision({revision:{version:0}}),disconnectedNodeAcknowledged:s.isDisconnectionAcknowledged(),component:{type:X,bundle:Z}};var Y=A.ajax({type:"POST",url:F.urls.createReportingTask,data:JSON.stringify(aa),dataType:"json",contentType:"application/json"}).done(function(ac){var ae=A("#reporting-tasks-table").data("gridInstance");var ab=ae.getData();ab.addItem(A.extend({type:"ReportingTask",bulletins:[]},ac));ab.reSort();ae.invalidate();var ad=ab.getRowById(ac.id);R.choseRow(ae,ad);ae.scrollRowIntoView(ad)}).fail(d.handleAjaxError);A("#new-reporting-task-dialog").modal("hide");return Y};var f=function(){var X={revision:i.getRevision({revision:{version:0}}),disconnectedNodeAcknowledged:s.isDisconnectionAcknowledged(),component:{name:A("#registry-name").val(),uri:A("#registry-location").val(),description:A("#registry-description").val()}};var Y=A.ajax({type:"POST",url:F.urls.registries,data:JSON.stringify(X),dataType:"json",contentType:"application/json"}).done(function(ac){var Z=A("#registries-table").data("gridInstance");var aa=Z.getData();aa.addItem(A.extend({type:"Registry"},ac));aa.reSort();Z.invalidate();var ab=aa.getRowById(ac.id);R.choseRow(Z,ab);Z.scrollRowIntoView(ab);A("#registry-configuration-dialog").modal("hide")}).fail(d.handleConfigurationUpdateAjaxError);return Y};var y=function(ab){var Y=A("#registries-table").data("gridInstance");var Z=Y.getData();var ac=Z.getItemById(ab);var aa={revision:i.getRevision(ac),disconnectedNodeAcknowledged:s.isDisconnectionAcknowledged(),component:{id:ab,name:A("#registry-name").val(),uri:A("#registry-location").val(),description:A("#registry-description").val()}};var X=A.ajax({type:"PUT",url:ac.uri,data:JSON.stringify(aa),dataType:"json",contentType:"application/json"}).done(function(ad){Z.updateItem(ab,A.extend({type:"Registry"},ad));A("#registry-configuration-dialog").modal("hide")}).fail(d.handleConfigurationUpdateAjaxError);return X};var g=function(){var Y=[{id:"type",name:"Type",field:"label",formatter:M.typeFormatter,sortable:true,resizable:true},{id:"version",name:"Version",field:"version",formatter:M.typeVersionFormatter,sortable:true,resizable:true},{id:"tags",name:"Tags",field:"tags",sortable:true,resizable:true,formatter:M.genericValueFormatter}];var X=new a.Data.DataView({inlineFilters:false});X.setItems([]);X.setFilterArgs({searchString:C()});X.setFilter(I);M.sortType({columnId:"type",sortAsc:true},X);var ab=new a.Grid("#reporting-task-types-table",X,Y,z);ab.setSelectionModel(new a.RowSelectionModel());ab.registerPlugin(new a.AutoTooltips());ab.setSortColumn("type",true);ab.onSort.subscribe(function(ad,ac){M.sortType({columnId:ac.sortCol.field,sortAsc:ac.sortAsc},X)});ab.onSelectedRowsChanged.subscribe(function(ah,ae){if(A.isArray(ae.rows)&&ae.rows.length===1){var ag=ae.rows[0];var ac=ab.getDataItem(ag);if(M.isDefinedAndNotNull(ac)){A("#reporting-task-description-container").show();if(M.isBlank(ac.description)){A("#reporting-task-type-description").attr("title","").html('<span class="unset">No description specified</span>')}else{A("#reporting-task-type-description").width(A("#reporting-task-description-container").innerWidth()-1).html(ac.description).ellipsis()}var ad=M.formatBundle(ac.bundle);var af=M.formatType(ac);A("#reporting-task-type-name").text(af).attr("title",af);A("#reporting-task-type-bundle").text(ad).attr("title",ad);A("#selected-reporting-task-name").text(ac.label);A("#selected-reporting-task-type").text(ac.type).data("bundle",ac.bundle);A("#new-reporting-task-dialog").modal("refreshButtons")}}});ab.onDblClick.subscribe(function(ae,ad){var ac=ab.getDataItem(ad.row);if(n(ac)){l(ac.type,ac.bundle)}});ab.onViewportChanged.subscribe(function(ad,ac){M.cleanUpTooltips(A("#reporting-task-types-table"),"div.view-usage-restriction")});X.onRowCountChanged.subscribe(function(ad,ac){ab.updateRowCount();ab.render();A("#displayed-reporting-task-types").text(ac.current)});X.onRowsChanged.subscribe(function(ad,ac){ab.invalidateRows(ac.rows);ab.render()});X.syncGridSelection(ab,true);A("#reporting-task-types-table").data("gridInstance",ab).on("mouseenter","div.slick-cell",function(af){var ag=A(this).find("div.view-usage-restriction");if(ag.length&&!ag.data("qtip")){var ae=A(this).find("span.row-id").text();var ad=X.getItemById(ae);if(ad.restricted===true){var ah=A("<div></div>");if(M.isBlank(ad.usageRestriction)){ah.append(A('<p style="margin-bottom: 3px;"></p>').text("Requires the following permissions:"))}else{ah.append(A('<p style="margin-bottom: 3px;"></p>').text(ad.usageRestriction+" Requires the following permissions:"))}var ac=[];if(M.isDefinedAndNotNull(ad.explicitRestrictions)){A.each(ad.explicitRestrictions,function(ai,ak){var aj=ak.requiredPermission;ac.push("'"+aj.label+"' - "+M.escapeHtml(ak.explanation))})}else{ac.push("Access to restricted components regardless of restrictions.")}ah.append(M.formatUnorderedList(ac));ag.qtip(A.extend({},M.config.tooltipConfig,{content:ah,position:{container:A("#summary"),at:"bottom right",my:"top left",adjust:{x:4,y:4}}}))}}});var aa=M.getPolicyTypeListing("restricted-components");A.ajax({type:"GET",url:F.urls.reportingTaskTypes,dataType:"json"}).done(function(ad){var ai=0;var af=[];var ac=O.set();var ah=O.map();var ag=O.map();X.beginUpdate();A.each(ad.reportingTaskTypes,function(aj,ak){if(ak.restricted===true){if(M.isDefinedAndNotNull(ak.explicitRestrictions)){A.each(ak.explicitRestrictions,function(al,an){var am=an.requiredPermission;if(!ag.has(am.id)){ag.set(am.id,am.label)}if(!ah.has(am.id)){ah.set(am.id,[])}ah.get(am.id).push({type:M.formatType(ak),bundle:M.formatBundle(ak.bundle),explanation:M.escapeHtml(an.explanation)})})}else{if(!ag.has(aa.value)){ag.set(aa.value,aa.text)}if(!ah.has(aa.value)){ah.set(aa.value,[])}ah.get(aa.value).push({type:M.formatType(ak),bundle:M.formatBundle(ak.bundle),explanation:M.escapeHtml(ak.usageRestriction)})}}ac.add(ak.bundle.group);X.addItem({id:ai++,label:M.substringAfterLast(ak.type,"."),type:ak.type,bundle:ak.bundle,description:M.escapeHtml(ak.description),restricted:ak.restricted,usageRestriction:M.escapeHtml(ak.usageRestriction),explicitRestrictions:ak.explicitRestrictions,tags:ak.tags.join(", ")});A.each(ak.tags,function(am,al){af.push(al.toLowerCase())})});X.endUpdate();X.reSort();ab.invalidate();T.addComponentRestrictions(ah,ag);A("#total-reporting-task-types, #displayed-reporting-task-types").text(ad.reportingTaskTypes.length);A("#reporting-task-tag-cloud").tagcloud({tags:af,select:p,remove:p});var ae=[{text:"all groups",value:""}];ac.each(function(aj){ae.push({text:aj,value:aj})});A("#reporting-task-bundle-group-combo").combo({options:ae,select:p})}).fail(d.handleAjaxError);var Z=[A.ui.keyCode.UP,A.ui.keyCode.PAGE_UP,A.ui.keyCode.DOWN,A.ui.keyCode.PAGE_DOWN];A("#reporting-task-type-filter").off("keyup").on("keyup",function(af){var ae=af.keyCode?af.keyCode:af.which;if(A.inArray(ae,Z)!==-1){return}if(ae===A.ui.keyCode.ENTER){var ac=ab.getSelectedRows();if(ac.length>0){var ad=ab.getDataItem(ac[0]);if(n(ad)){L()}}}else{p()}});R.addKeydownListener("#reporting-task-type-filter",ab,ab.getData());A("#new-reporting-task-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Add Reporting Task",buttons:[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){var ac=ab.getSelectedRows();if(ac.length>0){var ad=ab.getDataItem(ac[0]);return n(ad)===false}else{return ab.getData().getLength()===0}},handler:{click:function(){L()}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){A(this).modal("hide")}}}],handler:{close:function(){P();A("#reporting-task-type-filter").val("");A("#reporting-task-tag-cloud").tagcloud("clearSelectedTags");A("#reporting-task-bundle-group-combo").combo("setSelectedOption",{value:""});p();var ac=A("#reporting-task-types-table").data("gridInstance");ac.setSelectedRows([]);ac.resetActiveCell()},resize:function(){A("#reporting-task-type-description").width(A("#reporting-task-description-container").innerWidth()-1).text(A("#reporting-task-type-description").attr("title")).ellipsis()}}});A("#registry-configuration-dialog").modal({scrollableContentStyle:"scrollable",handler:{close:function(){A("#registry-id").text("");A("#registry-name").val("");A("#registry-location").val("");A("#registry-description").val("")}}})};var c=function(){g();var ab=function(ak,ae,aj,ag,ad){if(!ad.permissions.canRead){return""}var af='<div title="View Details" class="pointer view-reporting-task fa fa-info-circle"></div>';af+='<div title="Usage" class="pointer reporting-task-usage fa fa-book"></div>';var ah=!M.isEmpty(ad.component.validationErrors);var ai=!M.isEmpty(ad.bulletins);if(ah){af+='<div class="pointer has-errors fa fa-warning" ></div>'}if(ai){af+='<div class="has-bulletins fa fa-sticky-note-o"></div>'}if(ah||ai){af+='<span class="hidden row-id">'+M.escapeHtml(ad.component.id)+"</span>"}return af};var ac=function(al,ak,aj,af,ad){var ah="",ai="";if(ad.status.validationStatus==="VALIDATING"){ah="validating fa fa-spin fa-circle-notch";ai="Validating"}else{if(ad.status.validationStatus==="INVALID"){ah="invalid fa fa-warning";ai="Invalid"}else{if(ad.status.runStatus==="STOPPED"){ai="Stopped";ah="fa fa-stop stopped"}else{if(ad.status.runStatus==="RUNNING"){ai="Running";ah="fa fa-play running"}else{ai="Disabled";ah="icon icon-enable-false disabled"}}}}var ag="";if(M.isDefinedAndNotNull(ad.status.activeThreadCount)&&ad.status.activeThreadCount>0){ag="("+ad.status.activeThreadCount+")"}var ae='<div layout="row"><div class="'+ah+'"></div>';return ae+'<div class="status-text">'+M.escapeHtml(ai)+'</div><div style="float: left; margin-left: 4px;">'+M.escapeHtml(ag)+"</div></div>"};var aa=function(am,ak,ai,ah,ad){var al="";var ae=ad.permissions.canWrite;var ag=ad.permissions.canRead;var aj=ad.operatePermissions.canWrite||ae;var af=ad.status.runStatus==="STOPPED";if(ad.status.runStatus==="RUNNING"){if(aj){al+='<div title="Stop" class="pointer stop-reporting-task fa fa-stop"></div>'}}else{if(af||ad.status.runStatus==="DISABLED"){if(ag&&ae){al+='<div title="Edit" class="pointer edit-reporting-task fa fa-pencil"></div>'}if(aj&&ad.status.runStatus==="STOPPED"&&ad.status.validationStatus==="VALID"){al+='<div title="Start" class="pointer start-reporting-task fa fa-play"></div>'}if(ag&&ae&&ad.component.multipleVersionsAvailable===true){al+='<div title="Change Version" class="pointer change-version-reporting-task fa fa-exchange"></div>'}if(ag&&ae&&M.canModifyController()){al+='<div title="Remove" class="pointer delete-reporting-task fa fa-trash"></div>'}}}if(ag&&ae&&ad.component.persistsState===true){al+='<div title="View State" class="pointer view-state-reporting-task fa fa-tasks"></div>'}if(T.isManagedAuthorizer()&&M.canAccessTenants()){al+='<div title="Access Policies" class="pointer edit-access-policies fa fa-key"></div>'}return al};var X=[{id:"moreDetails",name:"&nbsp;",resizable:false,formatter:ab,sortable:true,width:90,maxWidth:90,toolTip:"Sorts based on presence of bulletins"},{id:"name",name:"Name",sortable:true,resizable:true,formatter:v},{id:"type",name:"Type",formatter:M.instanceTypeFormatter,sortable:true,resizable:true},{id:"bundle",name:"Bundle",formatter:M.instanceBundleFormatter,sortable:true,resizable:true},{id:"state",name:"Run Status",sortable:true,resizeable:true,formatter:ac}];X.push({id:"actions",name:"&nbsp;",resizable:false,formatter:aa,sortable:false,width:90,maxWidth:90});var Z=new a.Data.DataView({inlineFilters:false});Z.setItems([]);U({columnId:"name",sortAsc:true},Z);var Y=new a.Grid("#reporting-tasks-table",Z,X,z);Y.setSelectionModel(new a.RowSelectionModel());Y.registerPlugin(new a.AutoTooltips());Y.setSortColumn("name",true);Y.onSort.subscribe(function(ae,ad){U({columnId:ad.sortCol.id,sortAsc:ad.sortAsc},Z)});Y.onClick.subscribe(function(ah,ae){var ag=A(ah.target);var af=Z.getItem(ae.row);if(Y.getColumns()[ae.cell].id==="actions"){if(ag.hasClass("edit-reporting-task")){B.showConfiguration(af)}else{if(ag.hasClass("start-reporting-task")){B.start(af)}else{if(ag.hasClass("stop-reporting-task")){B.stop(af)}else{if(ag.hasClass("delete-reporting-task")){B.promptToDeleteReportingTask(af)}else{if(ag.hasClass("view-state-reporting-task")){var ad=af.status.runStatus==="STOPPED"&&af.status.activeThreadCount===0;e.showState(af,ad)}else{if(ag.hasClass("change-version-reporting-task")){t.promptForVersionChange(af)}else{if(ag.hasClass("edit-access-policies")){w.showReportingTaskPolicy(af);A("#shell-close-button").click()}}}}}}}}else{if(Y.getColumns()[ae.cell].id==="moreDetails"){if(ag.hasClass("view-reporting-task")){B.showDetails(af)}else{if(ag.hasClass("reporting-task-usage")){A("#shell-close-button").click();K.showPage("../nifi-docs/documentation?"+A.param({select:af.component.type,group:af.component.bundle.group,artifact:af.component.bundle.artifact,version:af.component.bundle.version})).done(function(){E.showSettings()})}}}}});Z.onRowCountChanged.subscribe(function(ae,ad){Y.updateRowCount();Y.render()});Z.onRowsChanged.subscribe(function(ae,ad){Y.invalidateRows(ad.rows);Y.render()});Z.syncGridSelection(Y,true);A("#reporting-tasks-table").data("gridInstance",Y).on("mouseenter","div.slick-cell",function(aj){var ah=A(this).find("div.has-errors");if(ah.length&&!ah.data("qtip")){var ad=A(this).find("span.row-id").text();var af=Z.getItemById(ad);var ag=M.formatUnorderedList(af.component.validationErrors);if(M.isDefinedAndNotNull(ag)){ah.qtip(A.extend({},M.config.tooltipConfig,{content:ag,position:{target:"mouse",viewport:A("#shell-container"),adjust:{x:8,y:8,method:"flipinvert flipinvert"}}}))}}var ae=A(this).find("div.has-bulletins");if(ae.length&&!ae.data("qtip")){var ad=A(this).find("span.row-id").text();var af=Z.getItemById(ad);var ai=M.getFormattedBulletins(af.bulletins);var ag=M.formatUnorderedList(ai);if(M.isDefinedAndNotNull(ag)){ae.qtip(A.extend({},M.config.tooltipConfig,{content:ag,position:{target:"mouse",viewport:A("#shell-container"),adjust:{x:8,y:8,method:"flipinvert flipinvert"}}}))}}})};var u=function(){var ac=function(ah,ae,ag,af,ad){if(!ad.permissions.canRead){return'<span class="blank">'+M.escapeHtml(ad.id)+"</span>"}return M.escapeHtml(ad.component.uri)};var aa=function(ah,ae,ag,af,ad){if(!ad.permissions.canRead){return'<span class="blank">'+M.escapeHtml(ad.id)+"</span>"}return M.escapeHtml(ad.component.description)};var Y=function(ai,ae,ah,ag,ad){var af="";if(M.canModifyController()){af+='<div title="Edit" class="pointer edit-registry fa fa-pencil"></div>';af+='<div title="Remove" class="pointer remove-registry fa fa-trash"></div>'}return af};var ab=[{id:"name",name:"Name",field:"name",formatter:v,sortable:true,resizable:true},{id:"uri",name:"Location",field:"uri",formatter:ac,sortable:true,resizable:true},{id:"description",name:"Description",field:"description",formatter:aa,sortable:true,resizable:true}];ab.push({id:"actions",name:"&nbsp;",resizable:false,formatter:Y,sortable:false,width:90,maxWidth:90});var Z=new a.Data.DataView({inlineFilters:false});Z.setItems([]);U({columnId:"name",sortAsc:true},Z);var X=new a.Grid("#registries-table",Z,ab,z);X.setSelectionModel(new a.RowSelectionModel());X.registerPlugin(new a.AutoTooltips());X.setSortColumn("name",true);X.onSort.subscribe(function(ae,ad){U({columnId:ad.sortCol.id,sortAsc:ad.sortAsc},Z)});X.onClick.subscribe(function(af,ad){var ae=A(af.target);var ag=Z.getItem(ad.row);if(X.getColumns()[ad.cell].id==="actions"){if(ae.hasClass("edit-registry")){D(ag)}else{if(ae.hasClass("remove-registry")){q(ag)}}}else{if(X.getColumns()[ad.cell].id==="moreDetails"){}}});Z.onRowCountChanged.subscribe(function(ae,ad){X.updateRowCount();X.render()});Z.onRowsChanged.subscribe(function(ae,ad){X.invalidateRows(ad.rows);X.render()});Z.syncGridSelection(X,true);A("#registries-table").data("gridInstance",X)};var D=function(X){A("#registry-id").text(X.id);A("#registry-name").val(X.component.name);A("#registry-location").val(X.component.uri);A("#registry-description").val(X.component.description);A("#registry-configuration-dialog").modal("setHeaderText","Edit Registry Client").modal("setButtonModel",[{buttonText:"Update",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){y(X.id)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){A(this).modal("hide")}}}]).modal("show")};var q=function(X){k.showYesNoDialog({headerText:"Delete Registry",dialogContent:"Delete registry '"+M.escapeHtml(X.component.name)+"'?",yesHandler:function(){b(X)}})};var b=function(Y){var X=i.getRevision(Y);A.ajax({type:"DELETE",url:Y.uri+"?"+A.param({version:X.version,clientId:X.clientId,disconnectedNodeAcknowledged:s.isDisconnectionAcknowledged()}),dataType:"json"}).done(function(aa){var Z=A("#registries-table").data("gridInstance");var ab=Z.getData();ab.deleteItem(Y.id)}).fail(d.handleAjaxError)};var N=function(){var ad=function(){A("#read-only-maximum-timer-driven-thread-count-field").addClass("unset").text("Unauthorized");A("#read-only-maximum-event-driven-thread-count-field").addClass("unset").text("Unauthorized")};var ab=function(ae){if(ae){A("#general-settings div.editable").show();A("#general-settings div.read-only").hide();A("#settings-save").show()}else{A("#general-settings div.editable").hide();A("#general-settings div.read-only").show();A("#settings-save").hide()}};var aa=A.Deferred(function(ae){A.ajax({type:"GET",url:F.urls.controllerConfig,dataType:"json"}).done(function(af){if(af.permissions.canWrite){A("#maximum-timer-driven-thread-count-field").removeClass("unset").val(af.component.maxTimerDrivenThreadCount);A("#maximum-event-driven-thread-count-field").removeClass("unset").val(af.component.maxEventDrivenThreadCount);ab(true);A("#settings-save").off("click").on("click",function(){m(af.revision.version)})}else{if(af.permissions.canRead){A("#read-only-maximum-timer-driven-thread-count-field").removeClass("unset").text(af.component.maxTimerDrivenThreadCount);A("#read-only-maximum-event-driven-thread-count-field").removeClass("unset").text(af.component.maxEventDrivenThreadCount)}else{ad()}ab(false)}ae.resolve()}).fail(function(ah,af,ag){if(ah.status===403){ad();ab(false);ae.resolve()}else{ae.reject(ah,af,ag)}})}).promise();var X=F.urls.api+"/flow/controller/controller-services";var Z=H.loadControllerServices(X,r());var ac=G();var Y=V();return A.when(aa,Z,ac).done(function(ag,af){var ae=af[0];A("#settings-last-refreshed").text(ae.currentTime)}).fail(d.handleAjaxError)};var G=function(){return A.ajax({type:"GET",url:F.urls.reportingTasks,dataType:"json"}).done(function(X){var ab=[];A.each(X.reportingTasks,function(ad,ac){ab.push(A.extend({type:"ReportingTask",bulletins:[]},ac))});var Z=A("#reporting-tasks-table");M.cleanUpTooltips(Z,"div.has-errors");M.cleanUpTooltips(Z,"div.has-bulletins");var Y=Z.data("gridInstance");var aa=Y.getData();aa.setItems(ab);aa.reSort();Y.invalidate()})};var V=function(){return A.ajax({type:"GET",url:F.urls.registries,dataType:"json"}).done(function(X){var Y=[];A.each(X.registries,function(ab,ac){Y.push(A.extend({type:"Registry"},ac))});var Z=A("#registries-table").data("gridInstance");var aa=Z.getData();aa.setItems(Y);aa.reSort();Z.invalidate()})};var x=function(){K.showContent("#settings").done(function(){J()});A("#settings-tabs").find(".selected-tab").click();E.resetTableSize()};var J=function(){A("#settings-save").mouseout()};var E={init:function(){A("#settings-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"General",tabContentId:"general-settings-tab-content"},{name:"Reporting Task Controller Services",tabContentId:"controller-services-tab-content"},{name:"Reporting Tasks",tabContentId:"reporting-tasks-tab-content"},{name:"Registry Clients",tabContentId:"registries-tab-content"}],select:function(){var X=A(this).text();if(X==="General"){A("#controller-cs-availability").hide();A("#new-service-or-task").hide();A("#settings-save").show()}else{var Y=false;if(M.isDefinedAndNotNull(M.currentUser)){Y=M.currentUser.controllerPermissions.canWrite===true}if(Y){A("#new-service-or-task").show();A("div.controller-settings-table").css("top","32px");A("#new-service-or-task").attr("title",function(){if(X==="Reporting Task Controller Services"){A("#settings-save").hide();return"Create a new reporting task controller service"}else{if(X==="Reporting Tasks"){A("#settings-save").hide();return"Create a new reporting task"}else{if(X==="Registry Clients"){A("#settings-save").hide();return"Register a new registry client"}}}})}else{A("#new-service-or-task").hide();A("div.controller-settings-table").css("top","0")}if(X==="Reporting Task Controller Services"){A("#controller-cs-availability").show()}else{if(X==="Reporting Tasks"||X==="Registry Clients"){A("#controller-cs-availability").hide()}}E.resetTableSize()}}});A("#settings-refresh-button").click(function(){N()});A("#new-service-or-task").on("click",function(){var Z=A("#settings-tabs li.selected-tab").text();if(Z==="Reporting Task Controller Services"){var Y=F.urls.api+"/controller/controller-services";H.promptNewControllerService(Y,r())}else{if(Z==="Reporting Tasks"){A("#new-reporting-task-dialog").modal("show");var aa=A("#reporting-task-types-table").data("gridInstance");if(M.isDefinedAndNotNull(aa)){var X=aa.getData();aa.resizeCanvas();if(X.getLength()>0){R.choseFirstRow(aa)}}A("#reporting-task-type-filter").focus()}else{if(Z==="Registry Clients"){A("#registry-configuration-dialog").modal("setHeaderText","Add Registry Client").modal("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){f()}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){A(this).modal("hide")}}}]).modal("show");A("#registry-name").focus()}}}});j();H.init(r(),E.showSettings);c();u()},resetTableSize:function(){H.resetTableSize(r());var X=A("#reporting-tasks-table").data("gridInstance");if(M.isDefinedAndNotNull(X)){X.resizeCanvas()}},showSettings:function(){return N().done(x)},loadSettings:function(){return N()},selectControllerService:function(X){var Y=r().data("gridInstance");var Z=Y.getData();var aa=Z.getRowById(X);R.choseRow(Y,aa);Y.scrollRowIntoView(aa);A("#settings-tabs").find("li:eq(1)").click()},selectReportingTask:function(X){var aa=A("#reporting-tasks-table").data("gridInstance");var Y=aa.getData();var Z=Y.getRowById(X);R.choseRow(aa,Z);aa.scrollRowIntoView(Z);A("#settings-tabs").find("li:eq(2)").click()},setBulletins:function(Z,X){if(A("#controller-services-table").data("gridInstance")){H.setBulletins(r(),Z)}var Y=A("#reporting-tasks-table").data("gridInstance");var ab=Y.getData();ab.beginUpdate();if(!M.isEmpty(X)){var ac=O.nest().key(function(ad){return ad.sourceId}).map(X,O.map);ac.each(function(ad,ae){var af=ab.getItemById(ae);if(M.isDefinedAndNotNull(af)){ab.updateItem(ae,A.extend(af,{bulletins:ad}))}})}else{var aa=ab.getItems();A.each(aa,function(ad,ae){ab.updateItem(ae.id,A.extend(ae,{bulletins:[]}))})}ab.endUpdate()}};return E}));