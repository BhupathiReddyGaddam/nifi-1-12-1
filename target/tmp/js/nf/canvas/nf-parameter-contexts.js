(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","Slick","d3","nf.Client","nf.Dialog","nf.Storage","nf.Common","nf.CanvasUtils","nf.ng.Bridge","nf.ErrorHandler","nf.FilteredDialogCommon","nf.Shell","nf.ComponentState","nf.ComponentVersion","nf.PolicyManagement","nf.Processor","nf.ProcessGroup","nf.ProcessGroupConfiguration","lodash-core"],function(f,o,r,t,m,g,j,n,u,h,e,q,c,d,p,l,i,k,s){return(nf.ParameterContexts=b(f,o,r,t,m,g,j,n,u,h,e,q,c,d,p,l,i,k,s))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ParameterContexts=b(require("jquery"),require("Slick"),require("d3"),require("nf.Client"),require("nf.Dialog"),require("nf.Storage"),require("nf.Common"),require("nf.CanvasUtils"),require("nf.ng.Bridge"),require("nf.ErrorHandler"),require("nf.FilteredDialogCommon"),require("nf.Shell"),require("nf.ComponentState"),require("nf.ComponentVersion"),require("nf.PolicyManagement"),require("nf.Processor"),require("nf.ProcessGroup"),require("nf.ProcessGroupConfiguration"),require("lodash-core")))}else{nf.ParameterContexts=b(a.$,a.Slick,a.d3,a.nf.Client,a.nf.Dialog,a.nf.Storage,a.nf.Common,a.nf.CanvasUtils,a.nf.ng.Bridge,a.nf.ErrorHandler,a.nf.FilteredDialogCommon,a.nf.Shell,a.nf.ComponentState,a.nf.ComponentVersion,a.nf.PolicyManagement,a.nf.Processor,a.nf.ProcessGroup,a.nf.ProcessGroupConfiguration,a._)}}}(this,function(D,a,U,e,g,r,T,ac,m,b,aa,S,d,s,x,p,A,G,ah){var K={urls:{parameterContexts:"../nifi-api/parameter-contexts"}};var z={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,autoEdit:false,multiSelect:false,rowHeight:24};var f={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,editable:false,enableAddRow:false,autoEdit:false,multiSelect:false,rowHeight:24};var v=function(am,aj,al,ak,ai){if(!ai.permissions.canRead){return'<span class="blank">'+T.escapeHtml(ai.id)+"</span>"}return T.escapeHtml(ai.component.name)};var ae=function(ai,ak){var aj=function(an,al){if(an.permissions.canRead&&al.permissions.canRead){var am=ah.get(an,"component["+ai.columnId+"]","");var ao=ah.get(al,"component["+ai.columnId+"]","");return am===ao?0:am>ao?1:-1}else{if(!an.permissions.canRead&&!al.permissions.canRead){return 0}if(an.permissions.canRead){return 1}else{return -1}}};ak.sort(aj,ai.sortAsc)};var L=null;var ag=function(ai,ak){var aj=function(an,al){if(ai.columnId==="name"){var am=ah.get(an,"["+ai.columnId+"]","");var ao=ah.get(al,"["+ai.columnId+"]","");return am===ao?0:am>ao?1:-1}};ak.sort(aj,ai.sortAsc)};var l=function(){D("#parameter-context-name").val("");D("#parameter-context-name-read-only").text("");D("#parameter-context-description-field").val("");D("#parameter-context-description-read-only").text("");D("#parameter-table, #add-parameter").show();D("#parameter-context-tabs").show();D("#parameter-context-tabs").find(".tab")[0].click();D("#parameter-context-update-status").hide();D("#process-group-parameter").text("");D("#parameter-process-group-id").text("").removeData("revision");D("#parameter-referencing-components-context").removeClass("unset").attr("title","").text("");var ai=D("#parameter-table").data("gridInstance");var aj=ai.getData();aj.setItems([]);Y();L=null;F=0;t=null;T.cleanUpTooltips(D("#parameter-table"),"div.fa-question-circle")};var q=function(){D("#parameter-name").val("");D("#parameter-value-field").val("");D("#parameter-description-field").val("");D("#parameter-sensitive-radio-button").prop("checked",false);D("#parameter-not-sensitive-radio-button").prop("checked",false);D("#parameter-name").prop("disabled",false);D("#parameter-sensitive-radio-button").prop("disabled",false);D("#parameter-not-sensitive-radio-button").prop("disabled",false);D("#parameter-set-empty-string-field").removeClass("checkbox-checked").addClass("checkbox-unchecked");D("#parameter-value-field").prop("disabled",false)};var i=function(){var al=[];var ak=D("#parameter-table");var ai=ak.data("gridInstance");var aj=ai.getData();D.each(aj.getItems(),function(){var am={name:this.name};if(this.hidden===true&&this.isNew!==true){al.push({parameter:am})}else{if(this.isNew===true){am.value=this.value;am.sensitive=this.sensitive;am.description=this.description;al.push({parameter:am})}else{if(this.isModified===true){am.sensitive=this.sensitive;if(this.hasValueChanged){am.value=this.value}am.description=this.description;al.push({parameter:am})}}}});return al};var y=function(){if(!D("#parameter-dialog").hasClass("hidden")){h()}return D.Deferred(function(ai){if(D("#parameter-context-update-status").is(":visible")){R();ai.resolve()}else{var aj=i();if(D.isEmptyObject(aj)){R();ai.resolve()}else{g.showYesNoDialog({headerText:"Parameters",dialogContent:"Save changes before leaving parameter context configuration?",noHandler:function(){R();ai.resolve()},yesHandler:function(){C(t).done(function(){ai.resolve()}).fail(function(){ai.reject()})}})}}}).promise()};var V=function(ai){var aj=ai.get(0).scrollHeight>Math.round(ai.innerHeight())||ai.get(0).scrollWidth>Math.round(ai.innerWidth());if(ai.is(":visible")&&aj){ai.css("border-width","1px")}else{ai.css("border-width","0px")}};var R=function(){D("#parameter-context-dialog").modal("hide")};var Q=function(al,aj){var ai=D('<li class="referencing-component-container"></li>').appendTo(aj);var ak=al.component;D('<div class="referencing-component-state"></div>').addClass(function(){if(T.isDefinedAndNotNull(ak.state)){var am=D(this);var ao=ak.state.toLowerCase();if(ao==="stopped"&&!T.isEmpty(ak.validationErrors)){ao="invalid";var an=T.formatUnorderedList(ak.validationErrors);am.qtip(D.extend({},ac.config.systemTooltipConfig,{content:an}))}return ao}else{return""}}).appendTo(ai);D('<span class="parameter-context-referencing-component-name link ellipsis"></span>').prop("title",ak.name).text(ak.name).on("click",function(){y().done(function(){D("#shell-dialog").modal("hide");ac.showComponent(al.processGroup.id,ak.id)})}).appendTo(ai);D('<div class="referencing-component-bulletins"></div>').addClass(ak.id+"-referencing-bulletins").appendTo(ai);D('<span class="referencing-component-active-thread-count"></span>').text(function(){if(T.isDefinedAndNotNull(ak.activeThreadCount)&&ak.activeThreadCount>0){return"("+ak.activeThreadCount+")"}else{return""}}).appendTo(ai)};var w=function(ak,ai){var al=D('<li class="referencing-component-container"></li>').appendTo(ai);var aj=ak.component;D('<div class="referencing-component-state"></div>').addClass(function(){if(T.isDefinedAndNotNull(aj.state)){var am=D(this);var ao=aj.state==="ENABLED"?"enabled":"disabled";if(ao==="disabled"&&!T.isEmpty(aj.validationErrors)){ao="invalid";var an=T.formatUnorderedList(aj.validationErrors);am.qtip(D.extend({},ac.config.systemTooltipConfig,{content:an}))}return ao}else{return""}}).appendTo(al);D('<div class="referencing-component-bulletins"></div>').addClass(aj.id+"-referencing-bulletins").appendTo(al);D('<span class="parameter-context-referencing-component-name link ellipsis"></span>').prop("title",aj.name).text(aj.name).on("click",function(){y().done(function(){D("#shell-dialog").modal("hide");A.enterGroup(aj.processGroupId);G.showConfiguration(aj.processGroupId).done(function(){G.selectControllerService(aj.id)})})}).appendTo(al)};var Z=function(aq){var al=function(aw,av){if(aw.hasClass("expanded")){aw.removeClass("expanded").addClass("collapsed");av.hide()}else{aw.removeClass("collapsed").addClass("expanded");av.show()}};var am=[];var an=[];var ap=[];Y();var ao=D("#parameter-referencing-components-container");if(T.isUndefined(aq)){D('<div class="referencing-component-container"><span class="unset">Pending Apply</span></div>').appendTo(ao)}else{var au=[];D.each(aq,function(av,aw){if(aw.permissions.canRead===true&&aw.permissions.canWrite===true){au.push(aw.id);if(aw.component.referenceType==="PROCESSOR"){am.push(aw)}else{an.push(aw)}}else{if(aw.permissions.canRead===true){au.push(aw.id)}ap.push(aw)}});var aj={};D.each(am,function(av,aw){if(aj[aw.processGroup.id]){aj[aw.processGroup.id].referencingProcessors.push(aw);aj[aw.processGroup.id].id=aw.processGroup.id;aj[aw.processGroup.id].name=aw.processGroup.name}else{aj[aw.processGroup.id]={referencingProcessors:[],referencingControllerServices:[],unauthorizedReferencingComponents:[],name:aw.processGroup.name,id:aw.processGroup.id};aj[aw.processGroup.id].referencingProcessors.push(aw)}});D.each(an,function(av,aw){if(aj[aw.processGroup.id]){aj[aw.processGroup.id].referencingControllerServices.push(aw);aj[aw.processGroup.id].id=aw.processGroup.id;aj[aw.processGroup.id].name=aw.processGroup.name}else{aj[aw.processGroup.id]={referencingProcessors:[],referencingControllerServices:[],unauthorizedReferencingComponents:[],name:aw.processGroup.name,id:aw.processGroup.id};aj[aw.processGroup.id].referencingControllerServices.push(aw)}});D.each(ap,function(aw,av){if(aj[av.processGroup.id]){aj[av.processGroup.id].unauthorizedReferencingComponents.push(av);aj[av.processGroup.id].id=av.processGroup.id;aj[av.processGroup.id].name=av.processGroup.name}else{aj[av.processGroup.id]={referencingProcessors:[],referencingControllerServices:[],unauthorizedReferencingComponents:[],name:av.processGroup.name,id:av.processGroup.id};aj[av.processGroup.id].unauthorizedReferencingComponents.push(av)}});var ao=D("#parameter-referencing-components-container");var ak=D('<ul class="referencing-component-listing clear"></ul>');var ar=[];for(var at in aj){if(aj.hasOwnProperty(at)){ar.push(aj[at])}}var ai=ar.sort(function(aw,av){if(aw.name<av.name){return -1}if(aw.name>av.name){return 1}return 0});ai.forEach(function(av){var aw=D('<div class="referencing-component-references"></div>');ao.append(aw);var ax=function(aA,aC){var aE=D('<div class="expansion-button collapsed"></div>');var aD=D('<span class="referencing-component-title"></span>').text(aA.name);var aB=D('<span class="referencing-component-count"></span>').text("("+(aA.referencingProcessors.length+aA.referencingControllerServices.length+aA.unauthorizedReferencingComponents.length)+")");var ay=D("#referencing-components-template").clone();ay.removeAttr("id");ay.removeClass("hidden");var az=D('<div class="referencing-component-block pointer unselectable"></div>').data("processGroupId",aA.id).on("click",function(){if(aE.hasClass("collapsed")){az.append(ay);var aH=az.find(".parameter-context-referencing-processors");T.cleanUpTooltips(aH,"div.referencing-component-state");T.cleanUpTooltips(aH,"div.referencing-component-bulletins");aH.empty();var aG=az.find(".parameter-context-referencing-controller-services");T.cleanUpTooltips(aG,"div.referencing-component-state");T.cleanUpTooltips(aG,"div.referencing-component-bulletins");aG.empty();var aF=az.find(".parameter-context-referencing-unauthorized-components").empty();if(aj[D(this).data("processGroupId")].referencingProcessors.length===0){D('<li class="referencing-component-container"><span class="unset">None</span></li>').appendTo(aH)}else{aj[D(this).data("processGroupId")].referencingProcessors.sort(ab);D.each(aj[D(this).data("processGroupId")].referencingProcessors,function(aI,aJ){Q(aJ,aH)})}if(aj[D(this).data("processGroupId")].referencingControllerServices.length===0){D('<li class="referencing-component-container"><span class="unset">None</span></li>').appendTo(aG)}else{aj[D(this).data("processGroupId")].referencingControllerServices.sort(ab);D.each(aj[D(this).data("processGroupId")].referencingControllerServices,function(aI,aJ){w(aJ,aG)})}if(aj[D(this).data("processGroupId")].unauthorizedReferencingComponents.length===0){D('<li class="referencing-component-container"><span class="unset">None</span></li>').appendTo(aF)}else{aj[D(this).data("processGroupId")].unauthorizedReferencingComponents.sort(function(aJ,aI){if(aJ.permissions.canRead===true&&aI.permissions.canRead===true){var aK=aJ.component.referenceType===aI.component.referenceType?0:aJ.component.referenceType>aI.component.referenceType?-1:1;if(aK===0){aK=aJ.component.name===aI.component.name?0:aJ.component.name>aI.component.name?1:-1}return aK}else{if(aJ.permissions.canRead===false&&aI.permissions.canRead===false){return aJ.id>aI.id?1:-1}else{if(aJ.permissions.canRead===true){return -1}else{return 1}}}});D.each(aj[D(this).data("processGroupId")].unauthorizedReferencingComponents,function(aJ,aI){if(aI.permissions.canRead===true){if(aI.component.referenceType==="PROCESSOR"){Q(aI,aF)}else{w(aI,aF)}}else{var aK=D('<li class="referencing-component-container"></li>').appendTo(aF);D('<span class="parameter-context-referencing-component-name link ellipsis"></span>').prop("title",aI.id).text(aI.id).on("click",function(){y().done(function(){D("#shell-dialog").modal("hide");if(aI.referenceType==="PROCESSOR"){ac.showComponent(aI.processGroup.id,aI.id)}else{if(aI.referenceType==="CONTROLLER_SERVICE"){G.showConfiguration(aI.processGroup.id).done(function(){A.enterGroup(aI.processGroup.id);G.selectControllerService(aI.id)})}}})}).appendTo(aK)}})}if(au.length>0){ac.queryBulletins(au).done(function(aJ){var aK=aJ.bulletinBoard.bulletins;var aI=U.nest().key(function(aL){return aL.sourceId}).map(aK,U.map);aI.each(function(aL,aM){D("div."+aM+"-referencing-bulletins").each(function(){var aO=D(this);if(aL.length>0){var aN=T.getFormattedBulletins(aL);var aP=T.formatUnorderedList(aN);aO.addClass("has-bulletins").show().qtip(D.extend({},ac.config.systemTooltipConfig,{content:aP}))}})})})}}else{az.find(".referencing-components-template").remove()}al(aE,aC);V(D("#parameter-referencing-components-container"))}).append(aE).append(aD).append(aB).appendTo(aw);aC.appendTo(aw);az.click()};ax(av,ak)})}};var ab=function(aj,ai){return aj.component.name.localeCompare(ai.component.name)};var h=function(){var am=c();var ai=D("#parameter-table").data("gridInstance");var aj=ai.getData();var ak=ad(am,aj.getItems());if(ak){var an=ah.extend({},am,{id:ah.defaultTo(am.id,X),hidden:false,type:"Parameter",previousValue:null,previousDescription:null,isEditable:true,isModified:true,hasValueChanged:false,isNew:true,});if(ah.isNil(am.id)){aj.addItem(an)}else{aj.updateItem(am.id,an)}aj.reSort();var al=aj.getRowById(X);ai.setActiveCell(al,ai.getColumnIndex("value"));X++;D("#parameter-dialog").modal("hide")}D("#parameter-context-dialog").modal("refreshButtons")};var c=function(aq){var ai=D.trim(D("#parameter-name").val());var an=D("#parameter-value-field").val();var ak=D("#parameter-set-empty-string-field").hasClass("checkbox-checked");var ao=D("#parameter-description-field").val();var al=D("#parameter-dialog").find('input[name="sensitive"]:checked').val()==="sensitive"?true:false;var aj=function(){if(!this.isNew){if(ah.isEmpty(this.value)&&!this.isEmptyStringSet){return false}}return true};var am={name:ai,value:null,description:null,sensitive:al,isEmptyStringSet:ak,previousValue:null,isNew:true};var ap=j(D("#parameter-value-field"),ah.isNil(aq)?am:aq,ak);return{name:ai,value:ap.value,description:ao,sensitive:al,isEmptyStringSet:ak,hasValueChanged:ap.hasChanged,hasDescriptionChanged:ao!==ah.get(aq,"description",""),isValueValid:aj}};var ad=function(an,am,al){if(an.name===""){g.showOkDialog({headerText:"Configuration Error",dialogContent:"The name of the parameter must be specified."});return false}var ai=/^[a-zA-Z0-9-_. ]+$/;if(!ai.test(an.name)){g.showOkDialog({headerText:"Configuration Error",dialogContent:"The name of the parameter appears to have an invalid character or characters. Only alpha-numeric characters (a-z, A-Z, 0-9), hyphens (-), underscores (_), periods (.), and spaces ( ) are accepted."});return false}var ak=ah.find(am,{name:an.name});if(ah.isNil(ak)||(al===true&&!ah.isNil(ak))){return true}else{var aj=ah.get(ak,"hidden",false);if(aj&&ak.sensitive!==an.sensitive){g.showOkDialog({headerText:"Parameter Exists",dialogContent:"A parameter with this name has been marked for deletion. Please apply this change to delete this parameter from the parameter context before recreating it with a different sensitivity."})}else{if(aj&&ak.sensitive===an.sensitive){an.id=ak.id;return true}else{g.showOkDialog({headerText:"Parameter Exists",dialogContent:"A parameter with this name already exists."})}}return false}};var j=function(aj,an,am){var ai;var al=aj.val();if(!am&&ah.isEmpty(al)){al=null}var ak=an.value!==al;if(!T.isBlank(al)){if(!ah.isEmpty(an)&&an.sensitive===true&&aj.hasClass("sensitive")&&an.isNew===false){ai=an.previousValue;ak=false}else{ai=al;if(!ak&&!ah.isEmpty(an)&&an.sensitive===true&&an.isNew===false){ak=true}}}else{if(am){ai=""}else{ai=null}}return{value:ai,hasChanged:ak}};var k=function(aj){var ai=c(aj);var ak=D("#parameter-table").data("gridInstance");var al=ak.getData();var am=ad(ai,al.getItems(),true);if(am){var ao=ah.extend({},aj,{id:aj.id,hidden:false,type:"Parameter",sensitive:aj.sensitive,name:aj.name,description:ai.description,referencingComponents:aj.referencingComponents,previousValue:aj.value,previousDescription:aj.description,isEditable:aj.isEditable,isEmptyStringSet:ai.isEmptyStringSet,isNew:aj.isNew,hasValueChanged:ai.hasValueChanged,hasDescriptionChanged:ai.hasDescriptionChanged,value:ai.value,isModified:ai.hasValueChanged||ai.hasDescriptionChanged});al.updateItem(aj.id,ao);al.reSort();var an=al.getRowById(aj.id);ak.setActiveCell(an,ak.getColumnIndex("value"));D("#parameter-dialog").modal("hide")}D("#parameter-context-dialog").modal("refreshButtons")};var O=function(al){var aj=i();var ak=D("#parameter-context-name").val();var ai=D("#parameter-context-description-field").val();if(ah.isEmpty(aj)&&ak===ah.get(al,"component.name")&&ai===ah.get(al,"component.description")){return false}else{return true}};var C=function(aj){var ai=i();if(ai.length===0){aj.component.parameters=[];if(D("#parameter-context-name").val()===aj.component.name&&D("#parameter-context-description-field").val()===aj.component.description){R();return}}else{aj.component.parameters=ai}aj.component.name=D("#parameter-context-name").val();aj.component.description=D("#parameter-context-description-field").val();return D.Deferred(function(ak){var an=function(){D("#parameter-context-dialog").modal("setButtonModel",[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){ak.resolve();R()}}}])};var ap=function(){D("#parameter-context-dialog").modal("setButtonModel",[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){if(D("#parameter-context-name").val()!==""&&O(aj)){return false}return true},handler:{click:function(){if(D("#parameter-referencing-components-container").is(":visible")){V(D("#parameter-referencing-components-container"))}C(aj)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){ak.resolve();if(D("#parameter-referencing-components-container").is(":visible")){V(D("#parameter-referencing-components-container"))}R()}}}])};var al=false;D("#parameter-context-dialog").modal("setButtonModel",[{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){al=true;if(D("#parameter-referencing-components-container").is(":visible")){V(D("#parameter-referencing-components-container"))}an()}}}]);var ao;var am=function(at,aq,ar){if(T.isDefinedAndNotNull(ao)){P(aj.id,ao)}D("#parameter-context-update-steps").find("div.parameter-context-step.ajax-loading").removeClass("ajax-loading").addClass("ajax-error");if(D("#parameter-referencing-components-container").is(":visible")){V(D("#parameter-referencing-components-container"))}ap()};u(aj).done(function(aq){var ar=function(az){var ay=az.request;var av=T.isDefinedAndNotNull(ay.failureReason);ao=ay.requestId;Z(ay.referencingComponents);var au=[];D.each(ai,function(aA,aB){au.push(aB.parameter.name)});D("#parameter-referencing-components-context").removeClass("unset").attr("title",au.join(", ")).text(au.join(", "));B(ay.updateSteps,al,av);if(al){P(aj.id,ao)}else{if(ay.complete===true){if(av){g.showOkDialog({headerText:"Parameter Context Update Error",dialogContent:"Unable to complete parameter context update request: "+T.escapeHtml(ay.failureReason)})}D.each(ay.referencingComponents,function(aA,aC){if(aC.permissions.canRead===true){var aB=aC.component;if(aB.referenceType==="PROCESSOR"&&ac.getGroupId()===aB.processGroupId){p.reload(aB.id)}}});var at=D("#parameter-contexts-table").data("gridInstance");if(T.isDefinedAndNotNull(at)){var ax=at.getData();D.extend(aj,{revision:az.parameterContextRevision,component:az.request.parameterContext});var aw=ax.getItemById(aj.id);if(T.isDefinedAndNotNull(aw)){ax.updateItem(aj.id,aj)}}P(aj.id,ao);an();V(D("#parameter-referencing-components-container"))}else{setTimeout(function(){o(aj.id,ao).done(function(aA){ar(aA)}).fail(am)},2000)}}};D("#parameter-table, #add-parameter").hide();D("#parameter-context-tabs").find(".tab")[1].click();D("#parameter-context-tabs").hide();D("#parameter-context-update-status").show();ar(aq)}).fail(am)}).promise()};var o=function(ai,aj){return D.ajax({type:"GET",url:K.urls.parameterContexts+"/"+encodeURIComponent(ai)+"/update-requests/"+encodeURIComponent(aj),dataType:"json"}).fail(b.handleAjaxError)};var P=function(ai,aj){return D.ajax({type:"DELETE",url:K.urls.parameterContexts+"/"+encodeURIComponent(ai)+"/update-requests/"+encodeURIComponent(aj)+"?"+D.param({disconnectedNodeAcknowledged:r.isDisconnectionAcknowledged()}),dataType:"json"}).fail(b.handleAjaxError)};var u=function(ai){return D.ajax({type:"POST",data:JSON.stringify(ai),url:K.urls.parameterContexts+"/"+encodeURIComponent(ai.id)+"/update-requests",dataType:"json",contentType:"application/json"}).fail(b.handleAjaxError)};var B=function(al,ak,aj){var ai=D("#parameter-context-update-steps").empty();D.each(al,function(ao,an){var am=D("<li></li>").text(an.description).appendTo(ai);D('<div class="parameter-context-step"></div>').addClass(function(){if(T.isDefinedAndNotNull(an.failureReason)){return"ajax-error"}else{if(an.complete===true){return"ajax-complete"}else{return ak===true||aj===true?"ajax-error":"ajax-loading"}}}).appendTo(am);D('<div class="clear"></div>').appendTo(am)})};var X=0;var F=0;var M=function(am,aj,an){if(T.isDefinedAndNotNull(am)){var ai=D("#parameter-table").data("gridInstance");var al=ai.getData();al.beginUpdate();var ak=[];D.each(am.component.parameters,function(ao,ap){var aq={id:X++,hidden:false,type:"Parameter",isNew:false,isModified:false,hasValueChanged:false,name:ap.parameter.name,value:ap.parameter.value,sensitive:ap.parameter.sensitive,description:ap.parameter.description,previousValue:ap.parameter.value,previousDescription:ap.parameter.description,isEditable:ah.defaultTo(an,false)?false:ap.canWrite,referencingComponents:ap.parameter.referencingComponents};ak.push({parameter:aq});al.addItem(aq)});al.endUpdate();al.reSort();if(T.isDefinedAndNotNull(aj)){D.each(ak,function(ao,ap){if(ap.parameter.name===aj){F=al.getRowById(ap.parameter.id);return false}})}else{F=0}if(ak.length===0){Y()}else{ai.setSelectedRows([F])}}};var Y=function(){var ak=D(".parameter-context-referencing-processors");T.cleanUpTooltips(ak,"div.referencing-component-state");T.cleanUpTooltips(ak,"div.referencing-component-bulletins");ak.empty();var aj=D(".parameter-context-referencing-controller-services");T.cleanUpTooltips(aj,"div.referencing-component-state");T.cleanUpTooltips(aj,"div.referencing-component-bulletins");aj.empty();var ai=D(".parameter-context-referencing-unauthorized-components").empty();D("#parameter-referencing-components-container").empty();L=null;D('<li class="referencing-component-container"><span class="unset">None</span></li>').appendTo(ak);D('<li class="referencing-component-container"><span class="unset">None</span></li>').appendTo(aj);D('<li class="referencing-component-container"><span class="unset">None</span></li>').appendTo(ai);D("#parameter-referencing-components-context").addClass("unset").attr("title","None").text("None");V(D("#parameter-referencing-components-container"))};var E=function(aj,ai){return aj.hidden===false};var H=function(){var ak=D("#parameter-table");var an=function(ax,aq,av,ar,ap){var aw=30;var at=D("<div></div>");var au=D("<span/>").addClass("table-cell").text(av).appendTo(at);if(ap.type==="required"){au.addClass("required")}if(!T.isBlank(ap.description)){D('<div class="fa fa-question-circle" alt="Info" style="float: right;"></div>').appendTo(at);D('<span class="hidden parameter-row"></span>').text(ax).appendTo(at);aw=46}au.width(ar.width-aw).ellipsis();return at.html()};var aj=function(au,aq,at,ar,ap){if(ap.sensitive===true&&!ah.isNil(at)){return'<span class="table-cell sensitive">Sensitive value set</span>'}else{if(at===""){return'<span class="table-cell blank">Empty string set</span>'}else{if(ah.isNil(at)){return'<span class="unset">No value set</span>'}else{return T.escapeHtml(at)}}}};var al=function(av,aq,au,at,ap){var ar="";if(ap.isEditable===true){ar+='<div title="Edit" class="edit-parameter pointer fa fa-pencil"></div>';ar+='<div title="Delete" class="delete-parameter pointer fa fa-trash"></div>'}return ar};var ao=[{id:"name",name:"Name",field:"name",formatter:an,sortable:true,resizable:true,rerenderOnResize:true},{id:"value",name:"Value",field:"value",formatter:aj,sortable:false,resizable:true},{id:"actions",name:"&nbsp;",resizable:false,rerenderOnResize:true,formatter:al,sortable:false,width:90,maxWidth:90}];var am=new a.Data.DataView({inlineFilters:false});am.setFilterArgs({searchString:"",property:"hidden"});am.setFilter(E);ag({columnId:"name",sortAsc:true},am);var ai=new a.Grid(ak,am,ao,f);ai.setSelectionModel(new a.RowSelectionModel());ai.registerPlugin(new a.AutoTooltips());ai.setSortColumn("name",true);ai.onSort.subscribe(function(aq,ap){ag({columnId:ap.sortCol.id,sortAsc:ap.sortAsc},am)});ai.onClick.subscribe(function(au,aw){var ax=am.getItem(aw.row);if(ai.getColumns()[aw.cell].id==="actions"){var av=D(au.target);if(av.hasClass("delete-parameter")){if(!ax.isNew){am.updateItem(ax.id,D.extend(ax,{hidden:true}))}else{am.deleteItem(ax.id)}var aq=ai.getSelectedRows();if(aq.length===0){ai.setSelectedRows([0])}var ay=am.getItems();if(ay.length===0){Y()}else{var at=true;D.each(ay,function(az,aA){if(!aA.hidden){at=false}});if(at){Y()}}D("#parameter-context-dialog").modal("refreshButtons");au.stopImmediatePropagation()}else{if(av.hasClass("edit-parameter")){var ap=function(){q()};var ar=function(){D("#parameter-sensitive-radio-button").prop("checked",false);D("#parameter-not-sensitive-radio-button").prop("checked",true);D("#parameter-name").focus();D("#parameter-name").val(ax.name);D("#parameter-name").prop("disabled",true);D("#parameter-sensitive-radio-button").prop("disabled",true);D("#parameter-not-sensitive-radio-button").prop("disabled",true);if(ax.value===""){D("#parameter-set-empty-string-field").removeClass("checkbox-unchecked").addClass("checkbox-checked")}else{D("#parameter-set-empty-string-field").removeClass("checkbox-checked").addClass("checkbox-unchecked")}if(ax.sensitive){D("#parameter-sensitive-radio-button").prop("checked",true);D("#parameter-not-sensitive-radio-button").prop("checked",false);if(!ah.isNil(ax.value)){D("#parameter-value-field").addClass("sensitive").val(T.config.sensitiveText).select()}}else{D("#parameter-sensitive-radio-button").prop("checked",false);D("#parameter-not-sensitive-radio-button").prop("checked",true);D("#parameter-value-field").val(ax.value)}D("#parameter-description-field").val(ax.description);D("#parameter-dialog").modal("refreshButtons")};D("#parameter-set-empty-string-field").off().on("change",function(aA,az){if(az.isChecked){D("#parameter-value-field").prop("disabled",true).val("");D("#parameter-dialog").modal("refreshButtons")}else{var aB=ax.sensitive?"":ax.previousValue;D("#parameter-value-field").prop("disabled",false).val(aB);D("#parameter-dialog").modal("refreshButtons")}});D("#parameter-dialog").modal("setHeaderText","Edit Parameter").modal("setOpenHandler",ar).modal("setCloseHandler",ap).modal("setButtonModel",[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){var az=c(ax);if(az.hasValueChanged){return !az.isValueValid()}else{return !az.hasDescriptionChanged}},handler:{click:function(){k(ax)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){D(this).modal("hide")}}}]).modal("show");au.stopImmediatePropagation()}}}});ai.onSelectedRowsChanged.subscribe(function(ar,aq){if(D.isArray(aq.rows)&&aq.rows.length===1){if(ai.getDataLength()>0){var ap=aq.rows[0];var at=ai.getDataItem(ap);if(L===null||L!==at.id){Z(at.referencingComponents);D("#parameter-referencing-components-context").removeClass("unset").attr("title",at.name).text(at.name);V(D("#parameter-referencing-components-container"));L=at.id}}}});ai.onBeforeCellEditorDestroy.subscribe(function(aq,ap){setTimeout(function(){ai.resizeCanvas()},50)});am.onRowCountChanged.subscribe(function(aq,ap){ai.updateRowCount();ai.render()});am.onRowsChanged.subscribe(function(aq,ap){ai.invalidateRows(ap.rows);ai.render()});am.syncGridSelection(ai,true);ak.data("gridInstance",ai).on("mouseenter","div.slick-cell",function(aq){var ap=D(this).find("div.fa-question-circle");if(ap.length){if(ap.data("qtip")){ap.qtip("destroy",true)}var ar=D(this).find("span.parameter-row").text();var at=am.getItem(ar);if(T.isDefinedAndNotNull(at.description)){ap.qtip(D.extend({},T.config.tooltipConfig,{content:at.description}))}}})};var n=function(){D("#parameter-context-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Settings",tabContentId:"parameter-context-standard-settings-tab-content"},{name:"Parameters",tabContentId:"parameter-context-parameters-tab-content"}],select:function(){if(D(this).text()==="Parameters"){var ai=D("#parameter-table").data("gridInstance");if(T.isDefinedAndNotNull(ai)){ai.resizeCanvas()}}}});D("#parameter-context-dialog").modal({scrollableContentStyle:"scrollable",handler:{close:function(){l()}}});D("#parameter-dialog").modal();D("#parameter-value-field").on("keydown",function(){var ai=D(this);if(ai.hasClass("sensitive")){ai.removeClass("sensitive");if(ai.val()===T.config.sensitiveText){ai.val("")}}});D("#parameter-set-empty-string-field").on("click",function(){var ai=D("#parameter-value-field");if(ai.hasClass("sensitive")){ai.removeClass("sensitive");if(ai.val()===T.config.sensitiveText){ai.val("")}}});D("#parameter-name").on("keydown",function(aj){var ai=aj.keyCode?aj.keyCode:aj.which;if(ai===D.ui.keyCode.ENTER){h();aj.stopImmediatePropagation();aj.preventDefault()}});D("#add-parameter").on("click",function(){var aj=function(){q()};var ai=function(){D("#parameter-sensitive-radio-button").prop("checked",false);D("#parameter-not-sensitive-radio-button").prop("checked",true);D("#parameter-name").focus()};D("#parameter-dialog").modal("setHeaderText","Add Parameter").modal("setOpenHandler",ai).modal("setCloseHandler",aj).modal("setButtonModel",[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){var ak=c();if(ak.name!==""){return false}return true},handler:{click:function(){h()}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){D(this).modal("hide")}}}]).modal("show")});D("#parameter-set-empty-string-field").off().on("change",function(aj,ai){if(ai.isChecked){D("#parameter-value-field").prop("disabled",true).val("");D("#parameter-dialog").modal("refreshButtons")}else{D("#parameter-value-field").prop("disabled",false);D("#parameter-dialog").modal("refreshButtons")}});D("#parameter-context-name").on("keyup",function(ai){D("#parameter-context-dialog").modal("refreshButtons")});D("#parameter-context-description-field").on("keyup",function(ai){D("#parameter-context-dialog").modal("refreshButtons")});D("#parameter-name").on("keyup",function(ai){D("#parameter-dialog").modal("refreshButtons")});D("#parameter-value-field").on("keyup",function(ai){D("#parameter-dialog").modal("refreshButtons")});D("#parameter-description-field").on("keyup",function(ai){D("#parameter-dialog").modal("refreshButtons")});D("#parameter-set-empty-string-field").on("change",function(ai){D("#parameter-dialog").modal("refreshButtons")});H()};var W=function(ai){D("#parameter-dialog").modal("setHeaderText","Add Parameter").modal("setButtonModel",[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){var ak=c();var aj=D("#parameter-context-updating-status").hasClass("show-status");if(aj||ah.isEmpty(ak.name)){return true}return false},handler:{click:ai.onApply}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:ai.onCancel}}]).modal("show");D("#parameter-set-empty-string-field").off().on("change",function(ak,aj){if(aj.isChecked){D("#parameter-value-field").prop("disabled",true).val("");D("#parameter-dialog").modal("refreshButtons")}else{D("#parameter-value-field").prop("disabled",false);D("#parameter-dialog").modal("refreshButtons")}})};var I=function(ai){var aj=D.Deferred(function(ak){D.ajax({type:"GET",url:"../nifi-api/flow/parameter-contexts",dataType:"json"}).done(function(al){ak.resolve(al)}).fail(function(an,al,am){ak.reject(an,al,am)})}).promise();return D.when(aj).done(function(ak){D("#parameter-contexts-last-refreshed").text(ak.currentTime);var ao=[];D.each(ak.parameterContexts,function(ap,aq){ao.push(D.extend({type:"ParameterContext"},aq))});var am=D("#parameter-contexts-table").data("gridInstance");var an=am.getData();an.setItems(ao);an.reSort();am.invalidate();if(T.isDefinedAndNotNull(ai)){var al=null;D.each(ao,function(aq,ap){if(ap.id===ai){al=an.getRowById(ai);return false}});if(al!==null){am.setSelectedRows([al])}}}).fail(b.handleAjaxError)};var J=function(ai){S.showContent("#parameter-contexts");af.resetTableSize()};var N=function(){var an=function(aw,ap,av,at,ao){var ar="";var au=ao.permissions.canWrite;var aq=ao.permissions.canRead;if(aq&&au){ar+='<div title="Edit" class="pointer edit-parameter-context fa fa-pencil"></div>'}if(aq&&au&&T.canModifyParameterContexts()){ar+='<div title="Remove" class="pointer delete-parameter-context fa fa-trash"></div>'}if(ac.isManagedAuthorizer()&&T.canAccessTenants()){ar+='<div title="Access Policies" class="pointer edit-access-policies fa fa-key"></div>'}return ar};var al=function(at,ap,ar,aq,ao){if(!ao.permissions.canRead){return""}return T.escapeHtml(ao.component.description)};var ak=function(av,ap,au,at,ao){var ar="";var aq=ao.permissions.canRead;if(aq){ar+='<div title="View Details" class="pointer view-parameter-context fa fa-info-circle"></div>'}return ar};var ai=[{id:"info",name:"&nbsp;",resizable:false,formatter:ak,sortable:false,width:30,maxWidth:30},{id:"name",name:"Name",sortable:true,resizable:true,formatter:v},{id:"description",name:"Description",sortable:true,resizable:true,formatter:al}];ai.push({id:"actions",name:"&nbsp;",resizable:false,formatter:an,sortable:false,width:90,maxWidth:90});var am=new a.Data.DataView({inlineFilters:false});am.setItems([]);ae({columnId:"name",sortAsc:true},am);var aj=new a.Grid("#parameter-contexts-table",am,ai,z);aj.setSelectionModel(new a.RowSelectionModel());aj.registerPlugin(new a.AutoTooltips());aj.setSortColumn("name",true);aj.onSort.subscribe(function(ap,ao){ae({columnId:ao.sortCol.id,sortAsc:ao.sortAsc},am)});aj.onClick.subscribe(function(ar,ao){var aq=D(ar.target);var ap=am.getItem(ao.row);if(aj.getColumns()[ao.cell].id==="actions"){if(aq.hasClass("edit-parameter-context")){af.showParameterContext(ap.id)}else{if(aq.hasClass("delete-parameter-context")){af.promptToDeleteParameterContext(ap)}else{if(aq.hasClass("edit-access-policies")){x.showParameterContextPolicy(ap);D("#shell-close-button").click()}}}}else{if(aj.getColumns()[ao.cell].id==="info"){if(aq.hasClass("view-parameter-context")){af.showParameterContext(ap.id,true)}}}});am.onRowCountChanged.subscribe(function(ap,ao){aj.updateRowCount();aj.render()});am.onRowsChanged.subscribe(function(ap,ao){aj.invalidateRows(ao.rows);aj.render()});am.syncGridSelection(aj,true);D("#parameter-contexts-table").data("gridInstance",aj).on("mouseenter","div.slick-cell",function(at){var ar=D(this).find("div.has-errors");if(ar.length&&!ar.data("qtip")){var ao=D(this).find("span.row-id").text();var aq=am.getItemById(ao);var ap=T.formatUnorderedList(aq.component.validationErrors);if(T.isDefinedAndNotNull(ap)){ar.qtip(D.extend({},T.config.tooltipConfig,{content:ap,position:{target:"mouse",viewport:D("#shell-container"),adjust:{x:8,y:8,method:"flipinvert flipinvert"}}}))}}})};var t=null;var af={init:function(){D("#parameter-contexts-refresh-button").on("click",function(){I()});D("#new-parameter-context").on("click",function(){Y();if(!D("#parameter-context-id-setting").hasClass("hidden")){D("#parameter-context-id-setting").addClass("hidden")}D("#parameter-context-dialog").removeClass("read-only");D("#parameter-context-dialog").addClass("edit-mode");D("#parameter-context-dialog").modal("setHeaderText","Add Parameter Context").modal("setButtonModel",[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){if(D("#parameter-context-name").val()!==""){return false}return true},handler:{click:function(){af.addParameterContext()}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){D(this).modal("hide")}}}]).modal("show");D("#parameter-context-name").focus()});n();N();D(window).on("resize",function(ai){if(D("#parameter-referencing-components-container").is(":visible")){V(D("#parameter-referencing-components-container"))}})},addParameterContext:function(ak){var ai={component:{name:D("#parameter-context-name").val(),description:D("#parameter-context-description-field").val(),parameters:i()},revision:e.getRevision({revision:{version:0}})};var aj=D.ajax({type:"POST",url:K.urls.parameterContexts,data:JSON.stringify(ai),dataType:"json",contentType:"application/json"}).done(function(an){var al=D("#parameter-contexts-table").data("gridInstance");if(T.isDefinedAndNotNull(al)){var am=al.getData();am.addItem(an);am.reSort();al.invalidate();var ao=am.getRowById(an.id);aa.choseRow(al,ao);al.scrollRowIntoView(ao)}if(typeof ak==="function"){ak(an)}}).fail(b.handleAjaxError);D("#parameter-context-dialog").modal("hide");return aj},resetTableSize:function(){var ai=D("#parameter-contexts-table").data("gridInstance");if(T.isDefinedAndNotNull(ai)){ai.resizeCanvas()}},showParameterContexts:function(ai){D("#new-parameter-context").prop("disabled",!T.canModifyParameterContexts());return I(ai).done(J)},showParameterContext:function(al,ak,aj){X=0;var ai=D.ajax({type:"GET",url:K.urls.parameterContexts+"/"+encodeURIComponent(al),dataType:"json"});ai.done(function(ap){var ao=ah.get(ap,"permissions.canWrite",false);if(ah.defaultTo(ak,false)){ao=false}t=ap;if(ao){D("#parameter-context-dialog").removeClass("read-only");D("#parameter-context-dialog").addClass("edit-mode");D("#parameter-context-name").val(ap.component.name);D("#parameter-context-description-field").val(ap.component.description)}else{D("#parameter-context-dialog").removeClass("edit-mode");D("#parameter-context-dialog").addClass("read-only");D("#parameter-context-name-read-only").prop("title",ap.component.name).text(ap.component.name);D("#parameter-context-description-read-only").text(ap.component.description)}if(D("#parameter-context-id-setting").hasClass("hidden")){D("#parameter-context-id-setting").removeClass("hidden")}D("#parameter-context-id-field").prop("title",ap.id).text(ap.id);M(ap,aj,ak||!ao);var an=[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){if(D("#parameter-context-name").val()!==""&&O(t)){return false}return true},handler:{click:function(){C(t)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){D(this).modal("hide")}}}];var am=[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){return false},handler:{click:function(){D(this).modal("hide")}}}];D("#parameter-context-dialog").modal("setHeaderText",ao?"Update Parameter Context":"View Parameter Context").modal("setButtonModel",ao?an:am).modal("show");D("#parameter-context-tabs").find("li:last").click();V(D("#parameter-referencing-components-container"))}).fail(b.handleAjaxError)},promptToDeleteParameterContext:function(ai){g.showYesNoDialog({headerText:"Delete Parameter Context",dialogContent:"Delete parameter context '"+T.escapeHtml(ai.component.name)+"'?",yesHandler:function(){af.remove(ai)}})},remove:function(ai){D.ajax({type:"DELETE",url:K.urls.parameterContexts+"/"+encodeURIComponent(ai.id)+"?"+D.param({disconnectedNodeAcknowledged:r.isDisconnectionAcknowledged(),clientId:ai.revision.clientId,version:ai.revision.version}),dataType:"json"}).done(function(aj){var ak=D("#parameter-contexts-table").data("gridInstance");var al=ak.getData();al.deleteItem(ai.id)}).fail(b.handleAjaxError)},convertPropertyToParameter:function(ak,ai,aj){return D.Deferred(function(al){if(ah.isNil(aj)){g.showOkDialog({headerText:"Unable to Convert Property",dialogContent:"There is no parameter context set for the current process group."});al.reject()}var am=D.ajax({type:"GET",url:K.urls.parameterContexts+"/"+encodeURIComponent(aj),dataType:"json"});am.done(function(ao){var an=function(ar){if(ar){D("#parameter-context-updating-status").addClass("show-status");D("#parameter-dialog").modal("refreshButtons")}else{D("#parameter-context-updating-status").removeClass("show-status");D("#parameter-dialog").modal("refreshButtons")}};var aq;var ap;W({onApply:function(){an(true);var au=ao.component.parameters.map(function(av){return av.parameter});var at=c();var ar=ad(at,au);if(!ar){an(false);return}ao.component.parameters=[{parameter:{name:at.name,value:at.value,sensitive:at.sensitive,description:at.description}}];aq=null;u(ao).done(function(av){var aw=function(az){var ay=az.request;var ax=!ah.isEmpty(ay.failureReason);aq=ay.requestId;if(ay.complete===true){an(false);if(ax){g.showOkDialog({headerText:"Parameter Context Update Error",dialogContent:"Unable to complete parameter context update request: "+T.escapeHtml(ay.failureReason)});al.reject()}else{al.resolve(at)}P(ao.id,aq);D("#parameter-dialog").modal("hide")}else{ap=setTimeout(function(){o(ao.id,aq).done(function(aA){aw(aA)}).fail(function(aA){if(!ah.isNil(ao.id)&&!ah.isNil(aq)){P(ao.id,aq)}al.reject(aA)})},1000)}};aw(av)}).fail(function(av){al.reject(av)})},onCancel:function(){an(false);if(!ah.isNil(ao.id)&&!ah.isNil(aq)){P(ao.id,aq);aq=null;if(!ah.isNil(ap)){clearTimeout(ap)}}q();D(this).modal("hide")}});D("#parameter-name").val(ak.displayName);D("#parameter-name").prop("disabled",false);D("#parameter-sensitive-radio-button").prop("disabled",true);D("#parameter-not-sensitive-radio-button").prop("disabled",true);if(ak.value===""){D("#parameter-dialog").find(".nf-checkbox").removeClass("checkbox-unchecked").addClass("checkbox-checked")}else{D("#parameter-dialog").find(".nf-checkbox").removeClass("checkbox-checked").addClass("checkbox-unchecked")}if(T.isSensitiveProperty(ai)){D("#parameter-sensitive-radio-button").prop("checked",true);D("#parameter-not-sensitive-radio-button").prop("checked",false);D("#parameter-value-field").val(null)}else{D("#parameter-sensitive-radio-button").prop("checked",false);D("#parameter-not-sensitive-radio-button").prop("checked",true);D("#parameter-value-field").val(ak.value)}D("#parameter-description-field").val(ak.description);D("#parameter-dialog").modal("refreshButtons")}).fail(function(an){al.reject(an)})}).promise()}};return af}));