(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Common","nf.CanvasUtils","nf.ng.Bridge"],function(f,e,g,d,c){return(nf.ContextMenu=b(f,e,g,d,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ContextMenu=b(require("jquery"),require("d3"),require("nf.Common"),require("nf.CanvasUtils"),require("nf.ng.Bridge")))}else{nf.ContextMenu=b(a.$,a.d3,a.nf.Common,a.nf.CanvasUtils,a.nf.ng.Bridge)}}}(this,function(J,W,S,ab,q){var B;var M=function(ag){return ab.getParentGroupId()!==null&&ag.empty()};var Z=function(ag){if(ag.size()==1&&ab.isProcessor(ag)&&ab.canModify(ag)&&(ab.isConfigurable(ag)||b(ag))){return true}else{return ab.isConfigurable(ag)}};var ae=function(ag){return ag.empty()||ab.isProcessGroup(ag)};var n=function(ag){var ah;if(ag.empty()){ah=ab.getParameterContext()}else{if(ab.isProcessGroup(ag)){var ai=ag.datum();ah=ai.parameterContext}}if(S.isDefinedAndNotNull(ah)){return S.isDefinedAndNotNull(ah)&&ah.permissions.canRead===true}return false};var K=function(ag){if(ag.size()==1&&ab.isProcessor(ag)&&ab.canModify(ag)){return !Z(ag)}else{return ab.hasDetails(ag)}};var w=function(ag){return ab.areDeletable(ag)};var T=function(ag){return ab.canWriteCurrentGroup()&&(ag.empty()||ab.canRead(ag))};var d=function(ag){return ab.canWriteCurrentGroup()&&ag.empty()};var aa=function(ag){return ab.getComponentByType("Connection").isDisconnected(ag)&&ab.canModify(ag)};var L=function(ag){return ab.canEnable(ag)};var F=function(ag){return ab.canDisable(ag)};var H=function(ag){return ab.isManagedAuthorizer()&&ab.canManagePolicies(ag)};var r=function(ag){return ab.areRunnable(ag)};var P=function(ag){return ab.areStoppable(ag)};var b=function(ai){if(ai.size()!==1){return false}if(ab.canOperate(ai)===false){return false}var ag=false;if(ab.isProcessor(ai)){var aj=ai.datum();var ah=aj.status.aggregateSnapshot;ag=ah.runStatus!=="Running"&&ah.activeThreadCount>0}return ag};var m=function(ag){if(ag.size()!==1){return false}return ab.isProcessor(ag)||ab.isProcessGroup(ag)||ab.isRemoteProcessGroup(ag)||ab.isConnection(ag)};var Q=function(ag){if(ag.size()!==1){return false}if(ab.canRead(ag)===false){return false}return ab.isProcessor(ag)};var x=function(ag){return ag.size()===1&&!ab.isConnection(ag)};var i=function(ag){return ab.isCopyable(ag)};var e=function(ag){return ab.isPastable()};var X=function(ag){return ag.empty()};var A=function(ag){if(ag.size()!==1){return false}if(ab.canModify(ag)===false){return false}return ab.isConnection(ag)};var s=function(ag){return ab.canAlign(ag)};var z=function(ag){return ab.isColorable(ag)};var ad=function(ag){if(ag.size()!==1){return false}return ab.isConnection(ag)};var p=function(ag){if(ag.size()!==1){return false}return ab.isFunnel(ag)||ab.isProcessor(ag)||ab.isProcessGroup(ag)||ab.isRemoteProcessGroup(ag)||ab.isInputPort(ag)||(ab.isOutputPort(ag)&&ab.getParentGroupId()!==null)};var u=function(ag){if(ag.size()!==1){return false}return ab.isFunnel(ag)||ab.isProcessor(ag)||ab.isProcessGroup(ag)||ab.isRemoteProcessGroup(ag)||ab.isOutputPort(ag)||(ab.isInputPort(ag)&&ab.getParentGroupId()!==null)};var o=function(ah){if(ah.size()!==1){return false}if(ab.canRead(ah)===false||ab.canModify(ah)===false){return false}if(ab.isProcessor(ah)){var ag=ah.datum();return ag.component.persistsState===true}else{return false}};var N=function(ah){if(ah.size()!==1){return false}if(ab.canRead(ah)===false||ab.canModify(ah)===false){return false}if(ab.isProcessor(ah)){var ag=ah.datum();return ag.component.multipleVersionsAvailable===true}else{return false}};var a=function(ag){if(ag.size()!==1){return false}return ab.isProcessGroup(ag)};var D=function(ag){return(ag.empty()&&ab.canReadCurrentGroup())||(ag.size()===1&&ab.isProcessGroup(ag)&&ab.canRead(ag))};var O=function(ag){if(S.canVersionFlows()===false){return false}if(ag.empty()){if(ab.getParentGroupId()===null){return false}return ab.canReadCurrentGroup()&&ab.canWriteCurrentGroup()}if(a(ag)===true){return ab.canRead(ag)&&ab.canModify(ag)}return false};var U=function(ah){if(O(ah)===false){return false}if(ah.empty()){var ag=q.injector.get("breadcrumbsCtrl").getBreadcrumbs();if(ag.length>0){var ai=ag[ag.length-1];if(ai.permissions.canRead){return S.isUndefinedOrNull(ai.breadcrumb.versionControlInformation)}else{return false}}else{return false}}var aj=ah.datum();return S.isUndefinedOrNull(aj.component.versionControlInformation)};var R=function(ag){var ah=v(ag);return ah!==null&&ah.state==="LOCALLY_MODIFIED"};var ac=function(ag){var ah=v(ag);return ah!==null&&ah.state==="LOCALLY_MODIFIED_AND_STALE"};var f=function(ag){var ah=v(ag);return ah!==null&&(ah.state==="LOCALLY_MODIFIED"||ah.state==="LOCALLY_MODIFIED_AND_STALE")};var af=function(ag){var ah=v(ag);return ah!==null&&ah.state!=="LOCALLY_MODIFIED"&&ah.state!=="LOCALLY_MODIFIED_AND_STALE"&&ah.state!=="SYNC_FAILURE"};var I=function(ag){var ah=v(ag);return ah!==null};var v=function(ah){if(O(ah)===false){return null}var aj;if(ah.empty()){var ag=q.injector.get("breadcrumbsCtrl").getBreadcrumbs();if(ag.length>0){var ai=ag[ag.length-1];if(ai.permissions.canRead){aj=ai.breadcrumb.versionControlInformation}else{return null}}else{return null}}else{var ak=ah.datum();aj=ak.component.versionControlInformation}if(S.isDefinedAndNotNull(aj)){return aj}return null};var t=function(ag){if(ag.size()!==1){return false}return !ab.isLabel(ag)&&!ab.isConnection(ag)&&!ab.isProcessGroup(ag)&&!ab.isRemoteProcessGroup(ag)&&S.canAccessProvenance()};var c=function(ag){if(ag.size()!==1){return false}if(ab.canRead(ag)===false){return false}return ab.isRemoteProcessGroup(ag)};var E=function(ag){if(ab.canOperate(ag)===false){return false}return ab.canAllStartTransmitting(ag)};var k=function(ag){if(ab.canOperate(ag)===false){return false}return ab.canAllStopTransmitting(ag)};var Y=function(ag){return ad(ag)};var l=function(ag){return ad(ag)};var y=function(ag){if(ab.canModify(ag)===false){return false}return !ag.empty()&&ab.getComponentByType("Connection").isDisconnected(ag)&&ab.getParentGroupId()!==null};var G=function(ag){ag.remove().find(".group-menu-item").each(function(){var ah=J(this).attr("id");G(J("#"+ah+"-sub-menu"))})};var j=function(ah,aj){var ai=J('<div class="context-menu-item"></div>').attr("id",aj.id).on("mouseenter",function(){J(this).addClass("hover");ah.find(".group-menu-item").not("#"+aj.id).each(function(){var ak=J(this).attr("id");G(J("#"+ak+"-sub-menu"))})}).on("mouseleave",function(){J(this).removeClass("hover")}).appendTo(ah);var ag=J('<div class="context-menu-item-img"></div>').addClass(aj.clazz).appendTo(ai);if(S.isDefinedAndNotNull(aj.imgStyle)){ag.addClass(aj.imgStyle)}J('<div class="context-menu-item-text"></div>').text(aj.text).appendTo(ai);if(aj.isGroup){J('<div class="fa fa-caret-right context-menu-group-item-img"></div>').appendTo(ai)}J('<div class="clear"></div>').appendTo(ai);return ai};var g=function(ah,ag){ah.css({left:ag.x+"px",top:ag.y+"px"}).show()};var V=function(ai,ah,ag){B[ai](ah,ag);C.hide()};var h=[{id:"reload-menu-item",condition:X,menuItem:{clazz:"fa fa-refresh",text:"Refresh",action:"reload"}},{id:"leave-group-menu-item",condition:M,menuItem:{clazz:"fa fa-level-up",text:"Leave group",action:"leaveGroup"}},{separator:true},{id:"show-configuration-menu-item",condition:Z,menuItem:{clazz:"fa fa-gear",text:"Configure",action:"showConfiguration"}},{id:"show-details-menu-item",condition:K,menuItem:{clazz:"fa fa-gear",text:"View configuration",action:"showDetails"}},{id:"parameters-menu-item",condition:n,menuItem:{clazz:"fa",text:"Parameters",action:"openParameterContext"}},{id:"variable-registry-menu-item",condition:ae,menuItem:{clazz:"fa",text:"Variables",action:"openVariableRegistry"}},{separator:true},{id:"version-menu-item",groupMenuItem:{clazz:"fa",text:"Version"},menuItems:[{id:"start-version-control-menu-item",condition:U,menuItem:{clazz:"fa fa-upload",text:"Start version control",action:"saveFlowVersion"}},{separator:true},{id:"commit-menu-item",condition:R,menuItem:{clazz:"fa fa-upload",text:"Commit local changes",action:"saveFlowVersion"}},{id:"force-commit-menu-item",condition:ac,menuItem:{clazz:"fa fa-upload",text:"Commit local changes",action:"forceSaveFlowVersion"}},{id:"local-changes-menu-item",condition:f,menuItem:{clazz:"fa",text:"Show local changes",action:"showLocalChanges"}},{id:"revert-menu-item",condition:f,menuItem:{clazz:"fa fa-undo",text:"Revert local changes",action:"revertLocalChanges"}},{id:"change-version-menu-item",condition:af,menuItem:{clazz:"fa",text:"Change version",action:"changeFlowVersion"}},{separator:true},{id:"stop-version-control-menu-item",condition:I,menuItem:{clazz:"fa",text:"Stop version control",action:"stopVersionControl"}}]},{separator:true},{id:"enter-group-menu-item",condition:a,menuItem:{clazz:"fa fa-sign-in",text:"Enter group",action:"enterGroup"}},{separator:true},{id:"start-menu-item",condition:r,menuItem:{clazz:"fa fa-play",text:"Start",action:"start"}},{id:"stop-menu-item",condition:P,menuItem:{clazz:"fa fa-stop",text:"Stop",action:"stop"}},{id:"terminate-menu-item",condition:b,menuItem:{clazz:"fa fa-hourglass-end",text:"Terminate",action:"terminate"}},{id:"enable-menu-item",condition:L,menuItem:{clazz:"fa fa-flash",text:"Enable",action:"enable"}},{id:"disable-menu-item",condition:F,menuItem:{clazz:"icon icon-enable-false",text:"Disable",action:"disable"}},{id:"enable-transmission-menu-item",condition:E,menuItem:{clazz:"fa fa-bullseye",text:"Enable transmission",action:"enableTransmission"}},{id:"disable-transmission-menu-item",condition:k,menuItem:{clazz:"icon icon-transmit-false",text:"Disable transmission",action:"disableTransmission"}},{separator:true},{id:"data-provenance-menu-item",condition:t,menuItem:{clazz:"icon icon-provenance",imgStyle:"context-menu-provenance",text:"View data provenance",action:"openProvenance"}},{id:"show-stats-menu-item",condition:m,menuItem:{clazz:"fa fa-area-chart",text:"View status history",action:"showStats"}},{id:"view-state-menu-item",condition:o,menuItem:{clazz:"fa fa-tasks",text:"View state",action:"viewState"}},{id:"list-queue-menu-item",condition:l,menuItem:{clazz:"fa fa-list",text:"List queue",action:"listQueue"}},{id:"show-usage-menu-item",condition:Q,menuItem:{clazz:"fa fa-book",text:"View usage",action:"showUsage"}},{id:"view-menu-item",groupMenuItem:{clazz:"icon icon-connect",text:"View connections"},menuItems:[{id:"show-upstream-menu-item",condition:u,menuItem:{clazz:"icon",text:"Upstream",action:"showUpstream"}},{id:"show-downstream-menu-item",condition:p,menuItem:{clazz:"icon",text:"Downstream",action:"showDownstream"}}]},{separator:true},{id:"refresh-remote-flow-menu-item",condition:c,menuItem:{clazz:"fa fa-refresh",text:"Refresh remote",action:"refreshRemoteFlow"}},{separator:true},{id:"remote-ports-menu-item",condition:c,menuItem:{clazz:"fa fa-cloud",text:"Manage remote ports",action:"remotePorts"}},{id:"manage-policies-menu-item",condition:H,menuItem:{clazz:"fa fa-key",text:"Manage access policies",action:"managePolicies"}},{id:"change-version-menu-item",condition:N,menuItem:{clazz:"fa fa-exchange",text:"Change version",action:"changeVersion"}},{separator:true},{id:"show-source-menu-item",condition:ad,menuItem:{clazz:"fa fa-long-arrow-left",text:"Go to source",action:"showSource"}},{id:"show-destination-menu-item",condition:ad,menuItem:{clazz:"fa fa-long-arrow-right",text:"Go to destination",action:"showDestination"}},{separator:true},{id:"align-menu-item",groupMenuItem:{clazz:"fa",text:"Align"},menuItems:[{id:"align-horizontal-menu-item",condition:s,menuItem:{clazz:"fa fa-align-center fa-rotate-90",text:"Horizontally",action:"alignHorizontal"}},{id:"align-vertical-menu-item",condition:s,menuItem:{clazz:"fa fa-align-center",text:"Vertically",action:"alignVertical"}}]},{id:"to-front-menu-item",condition:A,menuItem:{clazz:"fa fa-clone",text:"Bring to front",action:"toFront"}},{id:"center-menu-item",condition:x,menuItem:{clazz:"fa fa-crosshairs",text:"Center in view",action:"center"}},{id:"fill-color-menu-item",condition:z,menuItem:{clazz:"fa fa-paint-brush",text:"Change color",action:"fillColor"}},{id:"open-uri-menu-item",condition:c,menuItem:{clazz:"fa fa-external-link",text:"Go to",action:"openUri"}},{separator:true},{id:"move-into-parent-menu-item",condition:y,menuItem:{clazz:"fa fa-arrows",text:"Move to parent group",action:"moveIntoParent"}},{id:"group-menu-item",condition:aa,menuItem:{clazz:"icon icon-group",text:"Group",action:"group"}},{separator:true},{id:"download-menu-item",condition:D,menuItem:{clazz:"fa",text:"Download flow",action:"downloadFlow"}},{separator:true},{id:"upload-template-menu-item",condition:d,menuItem:{clazz:"icon icon-template-import",text:"Upload template",action:"uploadTemplate"}},{id:"template-menu-item",condition:T,menuItem:{clazz:"icon icon-template-save",text:"Create template",action:"template"}},{separator:true},{id:"copy-menu-item",condition:i,menuItem:{clazz:"fa fa-copy",text:"Copy",action:"copy"}},{id:"paste-menu-item",condition:e,menuItem:{clazz:"fa fa-paste",text:"Paste",action:"paste"}},{separator:true},{id:"empty-queue-menu-item",condition:Y,menuItem:{clazz:"fa fa-minus-circle",text:"Empty queue",action:"emptyQueue"}},{id:"empty-all-queues-menu-item",condition:a,menuItem:{clazz:"fa fa-minus-circle",text:"Empty all queues",action:"emptyAllQueues"}},{id:"empty-all-queues-menu-item-noselection",condition:X,menuItem:{clazz:"fa fa-minus-circle",text:"Empty all queues",action:"emptyAllQueues"}},{id:"delete-menu-item",condition:w,menuItem:{clazz:"fa fa-trash",text:"Delete",action:"delete"}}];var C={init:function(ag){B=ag;J("#context-menu").on("contextmenu",function(ah){ah.preventDefault();ah.stopPropagation()})},show:function(){nf.ContextMenu.hide();var ak=J("#context-menu").empty();var an=J("#canvas-body").get(0);var at=J("#banner-footer").get(0);var al=J("#breadcrumbs").get(0);var aq=ab.getSelection();var ao=W.mouse(an);var ah=function(au,av){return au+av.width()>an.clientWidth};var ai=function(av,au){return av+au.height()>(an.clientHeight-al.clientHeight-at.clientHeight)};var ar=function(av,aw,au){j(av,{id:aw,clazz:au.clazz,imgStyle:au.imgStyle,text:au.text,isGroup:false}).on("click",function(ax){V(au.action,aq,ax)}).on("contextmenu",function(ax){V(au.action,aq,ax);ax.preventDefault();ax.stopPropagation()})};var ap=function(aw,av,au,ax){j(aw,{id:av,clazz:au.clazz,imgStyle:au.imgStyle,text:au.text,isGroup:true}).addClass("group-menu-item").on("mouseenter",function(){if(J("#"+av+"-sub-menu").length==0){var aC=J(this);var az=aw.position();var aB=aC.position();var ay=az.left+aB.left+aC.width();var aD=az.top+aB.top;var aA=J('<div class="context-menu unselectable sub-menu"></div>').attr("id",av+"-sub-menu").appendTo("body");ag(aA,ax);if(ah(ay,aA)){ay-=(aA.width()+aC.width()-4)}if(ai(aD,aA)){aD-=(aA.height()-aC.height())}aA.css({top:aD+"px",left:ay+"px"}).show()}})};var am=function(av){if(av.separator){return true}else{if(av.menuItem){return av.condition(aq)}else{var au=[];J.each(av.menuItems,function(aw,ax){if(am(ax)){au.push(ax)}});return au.length>0}}};var ag=function(ax,au){var av=false;J.each(au,function(ay,az){if(az.separator&&av){J('<div class="context-menu-item-separator"></div>').appendTo(ax);av=false}else{if(aj(ax,az)){av=true}}});var aw=ax.children().last();if(aw.hasClass("context-menu-item-separator")){aw.remove()}};var aj=function(aw,au){var av=false;if(au.menuItem){av=au.condition(aq);if(av){ar(aw,au.id,au.menuItem)}}else{if(au.groupMenuItem){var ay=[];J.each(au.menuItems,function(aA,az){if(am(az)){ay.push(az)}});var ax=J.grep(ay,function(az){return S.isUndefinedOrNull(az.separator)});av=ax.length>0;if(av){ap(aw,au.id,au.groupMenuItem,ay)}}}return av};ag(ak,h);if(ah(ao[0],ak)){ao[0]=an.clientWidth-ak.width()-2}if(ai(ao[1],ak)){ao[1]=an.clientHeight-al.clientHeight-at.clientHeight-ak.height()-9}g(ak,{x:ao[0],y:ao[1]});q.digest()},hide:function(){J("#context-menu").hide();J("div.context-menu.sub-menu").remove()},activate:function(ag){ag.on("contextmenu.selection",function(){C.show();W.event.preventDefault();W.event.stopPropagation()})}};return C}));