(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.ErrorHandler","nf.Common","nf.Dialog","nf.Storage","nf.Client","nf.Settings","nf.UniversalCapture","nf.CustomUi","nf.CanvasUtils","nf.Processor"],function(g,m,l,d,f,h,n,e,i,k,c,j){return(nf.ControllerService=b(g,m,l,d,f,h,n,e,i,k,c,j))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ControllerService=b(require("jquery"),require("d3"),require("nf.ErrorHandler"),require("nf.Common"),require("nf.Dialog"),require("nf.Storage"),require("nf.Client"),require("nf.Settings"),require("nf.UniversalCapture"),require("nf.CustomUi"),require("nf.CanvasUtils"),require("nf.Processor")))}else{nf.ControllerService=b(a.$,a.d3,a.nf.ErrorHandler,a.nf.Common,a.nf.Dialog,a.nf.Storage,a.nf.Client,a.nf.Settings,a.nf.UniversalCapture,a.nf.CustomUi,a.nf.CanvasUtils,a.nf.Processor)}}}(this,function(E,V,d,T,k,u,g,J,c,B,Y,t){var P,F;var O={edit:"edit",readOnly:"read-only",serviceOnly:"SERVICE_ONLY",serviceAndReferencingComponents:"SERVICE_AND_REFERENCING_COMPONENTS",urls:{api:"../nifi-api"}};var I=function(){var ab=E("#controller-service-configuration").data("controllerServiceDetails");if(E("#controller-service-name").val()!==ab.component.name){return true}if(E("#controller-service-comments").val()!==ab.component.comments){return true}return E("#controller-service-properties").propertytable("isSaveRequired")};var o=function(){var ac=E("#controller-service-properties").propertytable("marshalProperties");var ad={};ad.id=E("#controller-service-id").text();ad.name=E("#controller-service-name").val();ad.comments=E("#controller-service-comments").val();if(E.isEmptyObject(ac)===false){ad.properties=ac}var ab={};ab.disconnectedNodeAcknowledged=u.isDisconnectionAcknowledged();ab.component=ad;return ab};var b=function(ab){return true};var Z=function(ae,af){var ac=ae.data("gridInstance");var ad=ac.getData();var ab=ad.getItemById(af);if(T.isUndefined(ab)||ab.permissions.canRead===false){return E.Deferred(function(ag){ag.reject()}).promise()}return E.ajax({type:"GET",url:ab.uri,dataType:"json"}).done(function(ag){Q(ae,ag)}).fail(d.handleAjaxError)};var Q=function(af,ab){var ac=af.data("gridInstance");var ae=ac.getData();var ad=ae.getItemById(ab.id);ae.updateItem(ab.id,E.extend({type:"ControllerService",bulletins:ad.bulletins},ab))};var h=function(ac,ab){Z(ac,ab.id).done(function(ad){f(ac,ad.component)})};var f=function(ac,ab){E.each(ab.referencingComponents,function(ae,ag){if(ag.permissions.canRead===false){return}var ad=ag.component;if(ad.referenceType==="Processor"){if(Y.getGroupId()===ad.groupId){t.reload(ad.id)}E("div."+ad.id+"-active-threads").text(ad.activeThreadCount);var af=E("div."+ad.id+"-state");if(af.length){m(af,ad)}}else{if(ad.referenceType==="ReportingTask"){F.reload(ad.id);E("div."+ad.id+"-active-threads").text(ad.activeThreadCount);var af=E("div."+ad.id+"-state");if(af.length){m(af,ad)}}else{Z(ac,ad.id);var af=E("div."+ad.id+"-state");if(af.length){K(af,ad)}if(ad.referenceCycle===false){f(ac,ad)}}}});U.reloadReferencedServices(ac,ab)};var W=function(ab){var ac=ab.get(0).scrollHeight>Math.round(ab.innerHeight())||ab.get(0).scrollWidth>Math.round(ab.innerWidth());if(ab.is(":visible")&&ac){ab.css("border-width","1px")}else{ab.css("border-width","0px")}};var l=function(ae,ac){var af=ac.data("bulletins");if(T.doBulletinsDiffer(af,ae)){ac.data("bulletins",ae);var ab=T.getFormattedBulletins(ae);if(ae.length>0){var ad=T.formatUnorderedList(ab);if(ac.data("qtip")){ac.qtip("option","content.text",ad)}else{ac.addClass("has-bulletins").show().qtip(E.extend({},Y.config.systemTooltipConfig,{content:ad}))}}else{if(ac.data("qtip")){ac.removeClass("has-bulletins").removeData("bulletins").hide().qtip("api").destroy(true)}}}};var m=function(ab,ac){ab.removeClass("disabled stopped running invalid").addClass(function(){var ad=E(this);var af=ac.state.toLowerCase();if(af==="stopped"&&!T.isEmpty(ac.validationErrors)){af="invalid";var ae=T.formatUnorderedList(ac.validationErrors);if(ad.data("qtip")){ad.qtip("option","content.text",ae)}else{ad.qtip(E.extend({},Y.config.systemTooltipConfig,{content:ae}))}}else{if(ad.data("qtip")){ad.qtip("api").destroy(true)}}return af})};var K=function(ac,ab){ac.removeClass("disabled enabled invalid").addClass(function(){var ad=E(this);var af=ab.state==="ENABLED"?"enabled":"disabled";if(af==="disabled"&&!T.isEmpty(ab.validationErrors)){af="invalid";var ae=T.formatUnorderedList(ab.validationErrors);if(ad.data("qtip")){ad.qtip("option","content.text",ae)}else{ad.qtip(E.extend({},Y.config.systemTooltipConfig,{content:ae}))}}else{if(ad.data("qtip")){ad.qtip("api").destroy(true)}}return af})};var n=function(ac){var ab=V.nest().key(function(ad){return ad.sourceId}).map(ac,V.map);ab.each(function(ad,ae){E("div."+ae+"-bulletins").each(function(){l(ad,E(this))})})};var N=function(ak,al,ac){if(ac.permissions.canRead===false){al.append('<div class="unset">Unauthorized</div>');return}var af=ac.component.referencingComponents;if(T.isEmpty(af)){al.append('<div class="unset">No referencing components.</div>');return}var ad=function(an,am){if(an.hasClass("expanded")){an.removeClass("expanded").addClass("collapsed");am.hide()}else{an.removeClass("collapsed").addClass("expanded");am.show()}};var ae=[];var ag=E('<ul class="referencing-component-listing clear"></ul>');var aj=E('<ul class="referencing-component-listing clear"></ul>');var ab=E('<ul class="referencing-component-listing clear"></ul>');var ah=E('<ul class="referencing-component-listing clear"></ul>');E.each(af,function(aJ,at){if(at.permissions.canRead===false){var ap=E('<div class="unset"></div>').text(at.id);ah.append(ap)}else{var aC=at.component;ae.push(aC.id);if(aC.referenceType==="Processor"){var aI=E('<span class="referencing-component-name link"></span>').text(aC.name).on("click",function(){Y.showComponent(aC.groupId,aC.id);al.closest(".dialog").modal("hide");E("#shell-close-button").click()});var ay=E('<div class="referencing-component-state"></div>').addClass(aC.id+"-state");m(ay,aC);var aA=E('<div class="referencing-component-bulletins"></div>').addClass(aC.id+"-bulletins");var aD=E('<span class="referencing-component-type"></span>').text(aC.type);var ao=E('<span class="referencing-component-active-thread-count"></span>').addClass(aC.id+"-active-threads");if(T.isDefinedAndNotNull(aC.activeThreadCount)&&aC.activeThreadCount>0){ao.text("("+aC.activeThreadCount+")")}var av=E("<li></li>").append(ay).append(aA).append(aI).append(aD).append(ao);ag.append(av)}else{if(aC.referenceType==="ControllerService"){var aF=E('<span class="referencing-component-name link"></span>').text(aC.name).on("click",function(){var aK=ak.data("gridInstance");var aL=aK.getData();var aM=aL.getRowById(aC.id);aK.setSelectedRows([aM]);aK.scrollRowIntoView(aM);al.closest(".dialog").modal("hide")});var aG=E('<div class="referencing-component-references hidden"></div>');var ar=E('<div class="service expansion-button collapsed pointer"></div>').on("click",function(){if(ar.hasClass("collapsed")){if(aC.referenceCycle===true){aG.append('<div class="unset">Reference cycle detected.</div>')}else{var aK=ak.data("gridInstance");var aL=aK.getData();p(aC.id,aL).done(function(aM){N(ak,aG,aM)})}}else{aG.empty()}ad(ar,aG);W(al)});var aw=E('<div class="referencing-component-state"></div>').addClass(aC.id+"-state");K(aw,aC);var aH=E('<div class="referencing-component-bulletins"></div>').addClass(aC.id+"-bulletins");var aB=E('<span class="referencing-component-type"></span>').text(aC.type);var au=E("<li></li>").append(ar).append(aw).append(aH).append(aF).append(aB).append(aG);aj.append(au)}else{if(aC.referenceType==="ReportingTask"){var aq=E('<span class="referencing-component-name link"></span>').text(aC.name).on("click",function(){var aM=E("#reporting-tasks-table").data("gridInstance");var aK=aM.getData();var aL=aK.getRowById(aC.id);aM.setSelectedRows([aL]);aM.scrollRowIntoView(aL);E("#settings-tabs").find("li:last").click();al.closest(".dialog").modal("hide")});var az=E('<div class="referencing-component-state"></div>').addClass(aC.id+"-state");m(az,aC);var am=E('<div class="referencing-component-bulletins"></div>').addClass(aC.id+"-bulletins");var an=E('<span class="referencing-component-type"></span>').text(T.substringAfterLast(aC.type,"."));var ax=E('<span class="referencing-component-active-thread-count"></span>').addClass(aC.id+"-active-threads");if(T.isDefinedAndNotNull(aC.activeThreadCount)&&aC.activeThreadCount>0){ax.text("("+aC.activeThreadCount+")")}var aE=E("<li></li>").append(az).append(am).append(aq).append(an).append(ax);ab.append(aE)}}}}});Y.queryBulletins(ae).done(function(am){var an=am.bulletinBoard.bulletins;n(an)});var ai=function(am,ao){if(ao.is(":empty")){ao.remove();return}var aq=E('<div class="expansion-button expanded"></div>');var ap=E('<span class="referencing-component-title"></span>').text(am);var an=E('<span class="referencing-component-count"></span>').text("("+ao.children().length+")");E('<div class="referencing-component-block pointer unselectable"></div>').on("click",function(){ad(aq,ao);W(al)}).append(aq).append(ap).append(an).appendTo(al);ao.appendTo(al)};ai("Processors",ag);ai("Reporting Tasks",ab);ai("Controller Services",aj);ai("Unauthorized",ah)};var e=function(ag,ac,ae,af){var ab={revision:g.getRevision(ac),disconnectedNodeAcknowledged:u.isDisconnectionAcknowledged(),state:ae?"ENABLED":"DISABLED"};var ad=E.ajax({type:"PUT",url:ac.uri+"/run-status",data:JSON.stringify(ab),dataType:"json",contentType:"application/json"}).done(function(ah){Q(ag,ah)}).fail(d.handleAjaxError);return E.Deferred(function(ah){ad.done(function(){if(ac.permissions.canRead===false){ah.resolve();return}var ai=v(ac,function(al,ak){if(E.isArray(ak)){if(ae){l(ak,E("#enable-controller-service-bulletins"))}else{l(ak,E("#disable-controller-service-bulletins"))}}var aj=al.status.runStatus;if(ae){return aj==="ENABLING"||aj==="ENABLED"}else{return aj==="DISABLED"}},function(aj){return Y.queryBulletins([ac.id])},af);ai.done(function(){ah.resolve()}).fail(function(){ah.reject()})}).fail(function(){ah.reject()})}).promise()};var r=function(ab){var ac=V.set();ac.add(ab.id);var ad=function(ae){E.each(ae,function(af,ah){var ag=ah.component;if(ag.referenceType==="ControllerService"){ac.add(ag.id);if(ag.referenceCycle===false){ad(ag.referencingComponents)}}})};ad(ab.referencingComponents);return ac};var a=function(ac,ab,ad){E.each(ac,function(ae,ag){var af=ag.component;if(ad){if(af.referenceType==="ControllerService"){ab[ag.id]=g.getRevision(ag)}}else{if(af.referenceType!=="ControllerService"){ab[ag.id]=g.getRevision(ag)}}a(af.referencingComponents,ab,ad)})};var G=function(ag,ab,ad,af){var ah={};a(ab.component.referencingComponents,ah,false);var ae={id:ab.id,state:ad?"RUNNING":"STOPPED",referencingComponentRevisions:ah,disconnectedNodeAcknowledged:u.isDisconnectionAcknowledged()};var ac=E.ajax({type:"PUT",url:ab.uri+"/references",data:JSON.stringify(ae),dataType:"json",contentType:"application/json"}).fail(d.handleAjaxError);return E.Deferred(function(ai){ac.done(function(aj){ab.component.referencingComponents=aj.controllerServiceReferencingComponents;if(ad){ai.resolve()}else{var ak=r(ab.component);var al=ag.data("gridInstance");var an=al.getData();var am=[];ak.each(function(ao){p(ao,an).done(function(ap){am.push(x(ap,af))})});E.when.apply(window,am).done(function(){ai.resolve()}).fail(function(){ai.reject()})}}).fail(function(){ai.reject()})}).promise()};var p=function(ac,ad){var ab=ad.getItemById(ac);if(T.isDefinedAndNotNull(ab)){return E.Deferred(function(ae){ae.resolve(ab)})}else{return E.ajax({type:"GET",url:"../nifi-api/controller-services/"+encodeURIComponent(ac),dataType:"json"}).fail(d.handleAjaxError)}};var v=function(ab,ae,ad,af){var ac=ab.component;return E.Deferred(function(ag){var aj=2;var ai=function(){var al=aj;aj=Math.min(aj*2,4);return al*1000};var ak=function(){var am=ad(ac);var al=E.ajax({type:"GET",url:ab.uri,dataType:"json"});E.when(am,al).done(function(an,ao){var ap=ao[0];ah(ap,an.bulletinBoard.bulletins)}).fail(function(ap,an,ao){ag.reject();d.handleAjaxError(ap,an,ao)})};var ah=function(am,al){if(ae(am,al)){ag.resolve()}else{if(typeof af==="function"&&af()){setTimeout(ak,ai())}else{ag.reject()}}};ad(ac).done(function(al){ah(ab,al.bulletinBoard.bulletins)}).fail(function(an,al,am){ag.reject();d.handleAjaxError(an,al,am)})}).promise()};var x=function(ab,ac){return v(ab,function(ag,af){var ad=ag.component.referencingComponents;var ae=false;E.each(ad,function(ah,ak){var aj=ak.component;if(aj.referenceType==="Processor"||aj.referenceType==="ReportingTask"){if(aj.state==="RUNNING"||aj.activeThreadCount>0){ae=true}E("div."+aj.id+"-active-threads").text(aj.activeThreadCount);var ai=E("div."+aj.id+"-state");m(ai,aj)}});n(af);return ae===false},function(ad){var af=[];var ae=ad.referencingComponents;E.each(ae,function(ag,ai){var ah=ai.component;if(ah.referenceType==="Processor"||ah.referenceType==="ReportingTask"){af.push(ah.id)}});return Y.queryBulletins(af)},ac)};var aa=function(ab,ac){return v(ab,function(ag,af){var ad=ag.component.referencingComponents;var ae=false;E.each(ad,function(ah,ak){var ai=ak.component;if(ai.referenceType==="ControllerService"){if(ai.state!=="ENABLING"&&ai.state!=="ENABLED"){ae=true}var aj=E("div."+ai.id+"-state");K(aj,ai)}});n(af);return ae===false},function(ad){var af=[];var ae=ad.referencingComponents;E.each(ae,function(ag,ai){var ah=ai.component;if(ah.referenceType==="ControllerService"){af.push(ah.id)}});return Y.queryBulletins(af)},ac)};var M=function(ab,ac){return v(ab,function(af,ae){var ad=af.component.referencingComponents;var ag=false;E.each(ad,function(ah,ak){var ai=ak.component;if(ai.referenceType==="ControllerService"){if(ai.state!=="DISABLED"){ag=true}var aj=E("div."+ai.id+"-state");K(aj,ai)}});n(ae);return ag===false},function(ad){var af=[];var ae=ad.referencingComponents;E.each(ae,function(ag,ai){var ah=ai.component;if(ah.referenceType==="ControllerService"){af.push(ah.id)}});return Y.queryBulletins(af)},ac)};var s=function(ag,ab,ad,af){var ah={};a(ab.component.referencingComponents,ah,true);var ae={id:ab.id,state:ad?"ENABLED":"DISABLED",referencingComponentRevisions:ah,disconnectedNodeAcknowledged:u.isDisconnectionAcknowledged()};var ac=E.ajax({type:"PUT",url:ab.uri+"/references",data:JSON.stringify(ae),dataType:"json",contentType:"application/json"}).fail(d.handleAjaxError);return E.Deferred(function(ai){ac.done(function(aj){ab.component.referencingComponents=aj.controllerServiceReferencingComponents;var ak=r(ab.component);var al=ag.data("gridInstance");var an=al.getData();var am=[];ak.each(function(ao){p(ao,an).done(function(ap){if(ad){am.push(aa(ap,af))}else{am.push(M(ap,af))}})});E.when.apply(window,am).done(function(){ai.resolve()}).fail(function(){ai.reject()})}).fail(function(){ai.reject()})}).promise()};var A=function(ae,ac){E("#disable-controller-service-id").text(ac.id);E("#disable-controller-service-name").text(T.getComponentName(ac));var ab=E("#disable-controller-service-referencing-components");N(ae,ab,ac);var ad=[{buttonText:"Disable",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){H(ae)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:S}}];E("#disable-controller-service-dialog").modal("setButtonModel",ad).modal("show");Y.queryBulletins([ac.id]).done(function(af){l(af.bulletinBoard.bulletins,E("#disable-controller-service-bulletins"))});W(ab)};var D=function(ae,ac){E("#enable-controller-service-id").text(ac.id);E("#enable-controller-service-name").text(T.getComponentName(ac));var ab=E("#enable-controller-service-referencing-components");N(ae,ab,ac);var ad=[{buttonText:"Enable",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){i(ae)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:S}}];E("#enable-controller-service-dialog").modal("setButtonModel",ad).modal("show");Y.queryBulletins([ac.id]).done(function(af){l(af.bulletinBoard.bulletins,E("#enable-controller-service-bulletins"))});W(ab)};var S=function(){E(this).modal("hide")};var H=function(ak){var ae=E("#disable-controller-service-dialog");var ad=false;ae.modal("setButtonModel",[{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){ad=true;ae.modal("setButtonModel",[]);E("#disable-controller-service-dialog div.controller-service-canceling").show()}}}]);E("#disable-controller-service-scope-container").hide();E("#disable-controller-service-progress-container").show();var aj=E("#disable-controller-service-id").text();var ab=ak.data("gridInstance");var af=ab.getData();var ac=af.getItemById(aj);var ag=ac.component;var al=function(){return ad===false};var ai=function(){E("#disable-controller-service-dialog div.controller-service-canceling").hide();ae.modal("setButtonModel",[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:S}}])};if(C(ac)){ai();k.showOkDialog({headerText:"Controller Service",dialogContent:ac.permissions.canRead===false?"Unable to disable due to a lack of read permission to see referencing components.":"Unable to disable due to unauthorized referencing components."});return}E("#disable-progress-label").text("Steps to disable "+T.getComponentName(ac));var ah=E("#disable-referencing-schedulable").addClass("ajax-loading");E.Deferred(function(am){var an=G(ak,ac,false,al);an.done(function(){ah.removeClass("ajax-loading").addClass("ajax-complete");var ao=E("#disable-referencing-services").addClass("ajax-loading");var ap=s(ak,ac,false,al);ap.done(function(){ao.removeClass("ajax-loading").addClass("ajax-complete");var aq=E("#disable-controller-service").addClass("ajax-loading");e(ak,ac,false,al).done(function(){am.resolve();aq.removeClass("ajax-loading").addClass("ajax-complete")}).fail(function(){am.reject();aq.removeClass("ajax-loading").addClass("ajax-error")})}).fail(function(){am.reject();ao.removeClass("ajax-loading").addClass("ajax-error")})}).fail(function(){am.reject();ah.removeClass("ajax-loading").addClass("ajax-error")})}).always(function(){if(ac.permissions.canRead===true){h(ak,ag)}ai();if(ad===true&&E("#nf-ok-dialog").not(":visible")){k.showOkDialog({headerText:"Controller Service",dialogContent:"The request to disable has been canceled. Parts of this request may have already completed. Please verify the state of this service and all referencing components."})}})};var C=function(ab){if(ab.permissions.canRead===false||(ab.permissions.canWrite===false&&ab.operatePermissions.canWrite===false)){return true}var ad=false;var ac=ab.component.referencingComponents;E.each(ac,function(ae,af){if(C(af)){ad=true;return false}});return ad};var i=function(ak){var ab=E("#enable-controller-service-dialog");var ae=false;var aj=E("#enable-controller-service-id").text();var ac=ak.data("gridInstance");var af=ac.getData();var ad=af.getItemById(aj);var ag=ad.component;var am=E("#enable-controller-service-scope").combo("getSelectedOption").value;if(am===O.serviceOnly){E("#enable-controller-service-progress li.referencing-component").hide()}ab.modal("setButtonModel",[{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){ae=true;ab.modal("setButtonModel",[]);E("#enable-controller-service-dialog div.controller-service-canceling").show()}}}]);E("#enable-controller-service-scope-container").hide();E("#enable-controller-service-progress-container").show();var al=function(){return ae===false};var ai=function(){E("#enable-controller-service-dialog div.controller-service-canceling").hide();ab.modal("setButtonModel",[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:S}}])};if(am===O.serviceAndReferencingComponents&&C(ad)){ai();k.showOkDialog({headerText:"Controller Service",dialogContent:ad.permissions.canRead===false?"Unable to enable due to a lack of read permission to see referencing components.":"Unable to enable due to unauthorized referencing components."});return}E("#enable-progress-label").text("Steps to enable "+T.getComponentName(ad));var ah=E("#enable-controller-service").addClass("ajax-loading");E.Deferred(function(an){var ao=e(ak,ad,true,al);if(am===O.serviceAndReferencingComponents){ao.done(function(){ah.removeClass("ajax-loading").addClass("ajax-complete");var ap=E("#enable-referencing-services").addClass("ajax-loading");var aq=s(ak,ad,true,al);aq.done(function(){ap.removeClass("ajax-loading").addClass("ajax-complete");var ar=E("#enable-referencing-schedulable").addClass("ajax-loading");G(ak,ad,true,al).done(function(){an.resolve();ar.removeClass("ajax-loading").addClass("ajax-complete")}).fail(function(){an.reject();ar.removeClass("ajax-loading").addClass("ajax-error")})}).fail(function(){an.reject();ap.removeClass("ajax-loading").addClass("ajax-error")})}).fail(function(){an.reject();ah.removeClass("ajax-loading").addClass("ajax-error")})}else{ao.done(function(){an.resolve();ah.removeClass("ajax-loading").addClass("ajax-complete")}).fail(function(){an.reject();ah.removeClass("ajax-loading").addClass("ajax-error")})}}).always(function(){if(ad.permissions.canRead===true){h(ak,ag)}ai();if(ae===true&&E("#nf-ok-dialog").not(":visible")){k.showOkDialog({headerText:"Controller Service",dialogContent:"The request to enable has been canceled. Parts of this request may have already completed. Please verify the state of this service and all referencing components."})}})};var L=function(ac){var ab=E("#controller-service-configuration").data("controllerServiceDetails");return E.ajax({type:"GET",url:ab.uri+"/descriptors",data:{propertyName:ac},dataType:"json"}).fail(d.handleAjaxError)};var z=function(ab,ac){return E.Deferred(function(ae){if(T.isDefinedAndNotNull(ac)){var af;if(ac===Y.getGroupId()){af=Y.getParameterContext()}else{var ad=Y.getComponentByType("ProcessGroup").get(ac);af=ad.parameterContext}if(T.isDefinedAndNotNull(af)){E.ajax({type:"GET",url:"../nifi-api/parameter-contexts/"+encodeURIComponent(af.id),dataType:"json"}).done(function(ah){var ag=T.isSensitiveProperty(ab);ae.resolve(ah.component.parameters.map(function(ai){return ai.parameter}).filter(function(ai){return ai.sensitive===ag}))}).fail(function(){ae.resolve([])})}else{ae.resolve([])}}else{ae.resolve([])}}).promise()};var R=function(ab){return E.Deferred(function(ac){E("#controller-service-properties").propertytable("saveRow");if(I()){k.showYesNoDialog({headerText:"Save",dialogContent:"Save changes before going to this Controller Service?",noHandler:function(){ac.resolve()},yesHandler:function(){var ad=E("#controller-service-configuration").data("controllerServiceDetails");y(ab,ad).done(function(){ac.resolve()}).fail(function(){ac.reject()})}})}else{ac.resolve()}}).promise()};var j=function(ac){if(_.isNil(ac)){return null}var ad;if(ac===Y.getGroupId()){ad=Y.getParameterContext()}else{var ab=Y.getComponentByType("ProcessGroup").get(ac);ad=ab.parameterContext}return ad};var y=function(ad,ab){var ae=o();if(b(ae)){ae.revision=g.getRevision(ab);var ac=[];E.each(q(ab.component),function(ag,ai){var af=!T.isUndefined(ae.component.properties)&&!T.isUndefined(ae.component.properties[ai.name]);var ah=T.isDefinedAndNotNull(ab.component.properties[ai.name]);if(af&&ah){ac.push(ab.component.properties[ai.name])}});return E.ajax({type:"PUT",data:JSON.stringify(ae),url:ab.uri,dataType:"json",contentType:"application/json"}).done(function(af){Q(ad,af);E.each(ac,function(ag,ah){Z(ad,ah)})}).fail(d.handleConfigurationUpdateAjaxError)}else{return E.Deferred(function(af){af.reject()}).promise()}};var q=function(ac){var ab=[];E.each(ac.descriptors,function(ad,ae){if(T.isDefinedAndNotNull(ae.identifiesControllerService)){ab.push(ae)}});return ab};var w=function(ac){var ab=[];E.each(q(ac),function(ad,ae){var af=ac.properties[ae.name];if(T.isDefinedAndNotNull(af)&&E.trim(af).length>0){ab.push(af)}});return ab};var X;var U={init:function(ac,ab){P=ac;F=ab;E("#controller-service-configuration-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Settings",tabContentId:"controller-service-standard-settings-tab-content"},{name:"Properties",tabContentId:"controller-service-properties-tab-content"},{name:"Comments",tabContentId:"controller-service-comments-tab-content"}],select:function(){c.removeAllPropertyDetailDialogs();if(E(this).text()==="Properties"){E("#controller-service-properties").propertytable("resetTableSize")}E("#controller-service-properties").propertytable("saveRow");var ad=E("#controller-service-referencing-components");W(ad)}});E("#controller-service-configuration").modal({headerText:"Configure Controller Service",scrollableContentStyle:"scrollable",handler:{close:function(){var ad=E("#controller-service-referencing-components");T.cleanUpTooltips(ad,"div.referencing-component-state");T.cleanUpTooltips(ad,"div.referencing-component-bulletins");ad.css("border-width","0").empty();E("#controller-service-properties").propertytable("cancelEdit");E("#controller-service-properties").propertytable("clear");T.clearField("read-only-controller-service-comments");E("#controller-service-compatible-apis").empty();E("#controller-service-configuration").removeData("controllerServiceDetails")},open:function(){T.toggleScrollable(E("#"+this.find(".tab-container").attr("id")+"-content").get(0))}}});E("#disable-controller-service-dialog").modal({headerText:"Disable Controller Service",scrollableContentStyle:"scrollable",handler:{close:function(){var ae=E(this);E("#disable-controller-service-scope-container").show();E("#disable-controller-service-progress-container").hide();E("#disable-controller-service-id").text("");E("#disable-controller-service-name").text("");E("#disable-controller-service-bulletins").removeClass("has-bulletins").removeData("bulletins").hide();T.cleanUpTooltips(E("#disable-controller-service-service-container"),"#disable-controller-service-bulletins");E("div.disable-referencing-components").removeClass("ajax-loading ajax-complete ajax-error");var ad=E("#disable-controller-service-referencing-components");T.cleanUpTooltips(ad,"div.referencing-component-state");T.cleanUpTooltips(ad,"div.referencing-component-bulletins");ad.css("border-width","0").empty()}}});E("#enable-controller-service-scope").combo({options:[{text:"Service only",value:O.serviceOnly,description:"Enable only this controller service"},{text:"Service and referencing components",value:O.serviceAndReferencingComponents,description:"Enable this controller service and enable/start all referencing components"}]});E("#enable-controller-service-dialog").modal({headerText:"Enable Controller Service",scrollableContentStyle:"scrollable",handler:{close:function(){var ae=E(this);E("#enable-controller-service-scope-container").show();E("#enable-controller-service-progress-container").hide();E("#enable-controller-service-progress li.referencing-component").show();E("#enable-controller-service-id").text("");E("#enable-controller-service-name").text("");E("#enable-controller-service-bulletins").removeClass("has-bulletins").removeData("bulletins").hide();T.cleanUpTooltips(E("#enable-controller-service-service-container"),"#enable-controller-service-bulletins");E("div.enable-referencing-components").removeClass("ajax-loading ajax-complete ajax-error");var ad=E("#enable-controller-service-referencing-components");T.cleanUpTooltips(ad,"div.referencing-component-state");T.cleanUpTooltips(ad,"div.referencing-component-bulletins");ad.css("border-width","0").empty()}}})},showConfiguration:function(af,ac){if(T.isUndefined(X)){X=af}var ad=E("#controller-service-configuration");ad.find(".dialog-header .dialog-header-text").text("Configure Controller Service");if(ad.data("mode")!==O.edit||X!==af){E("#controller-service-configuration .controller-service-read-only").hide();E("#controller-service-configuration .controller-service-editable").show();var ae=null;if(T.isDefinedAndNotNull(ac.parentGroupId)){ae=z}E("#controller-service-properties").propertytable("destroy").propertytable({readOnly:false,supportsGoTo:true,dialogContainer:"#new-controller-service-property-container",descriptorDeferred:L,parameterDeferred:ae,controllerServiceCreatedDeferred:function(ai){var ah;var aj=ai.component;if(T.isDefinedAndNotNull(aj.parentGroupId)){ah=O.urls.api+"/flow/process-groups/"+encodeURIComponent(aj.parentGroupId)+"/controller-services"}else{ah=O.urls.api+"/flow/controller/controller-services"}return P.loadControllerServices(ah,af)},goToServiceDeferred:function(){return R(af)},getParameterContext:function(ah){return j(ah)}});ad.data("mode",O.edit)}X=af;var ag=E.ajax({type:"GET",url:ac.uri,dataType:"json"});var ab=E.ajax({type:"GET",url:"../nifi-api/flow/history/components/"+encodeURIComponent(ac.id),dataType:"json"});E.when(ag,ab).done(function(am,al){ac=am[0];var ai=ac.component;var an=al[0].componentHistory;ad.data("controllerServiceDetails",ac);T.populateField("controller-service-id",ai.id);T.populateField("controller-service-type",T.formatType(ai));T.populateField("controller-service-bundle",T.formatBundle(ai.bundle));E("#controller-service-name").val(ai.name);E("#controller-service-comments").val(ai.comments);if(!T.isEmpty(ai.controllerServiceApis)){var ah=T.getFormattedServiceApis(ai.controllerServiceApis);var ak=T.formatUnorderedList(ah);E("#controller-service-compatible-apis").append(ak)}else{E("#controller-service-compatible-apis").append('<span class="unset">None</span>')}var aj=E("#controller-service-referencing-components");N(af,aj,ac);var ao=[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){E("#controller-service-properties").propertytable("saveRow");y(af,ac).done(function(ap){f(af,ap.component);ad.modal("hide")})}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){ad.modal("hide")}}}];if(T.isDefinedAndNotNull(ai.customUiUrl)&&ai.customUiUrl!==""){ao.push({buttonText:"Advanced",clazz:"fa fa-cog button-icon",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){var ap=function(){ad.modal("hide");E("#shell-close-button").click();B.showCustomUi(ac,ai.customUiUrl,true).done(function(){h(af,ai);J.showSettings()})};E("#controller-service-properties").propertytable("saveRow");if(I()){k.showYesNoDialog({headerText:"Save",dialogContent:"Save changes before opening the advanced configuration?",noHandler:ap,yesHandler:function(){y(af,ac).done(function(){ap()})}})}else{ap()}}}})}ad.modal("setButtonModel",ao);E("#controller-service-properties").propertytable("setGroupId",ai.parentGroupId).propertytable("loadProperties",ai.properties,ai.descriptors,an.propertyHistory);ad.modal("show");W(aj);E("#controller-service-properties").propertytable("resetTableSize")}).fail(d.handleAjaxError)},showDetails:function(ae,ac){var ad=E("#controller-service-configuration");ad.find(".dialog-header .dialog-header-text").text("Controller Service Details");if(ad.data("mode")!==O.readOnly){E("#controller-service-configuration .controller-service-read-only").show();E("#controller-service-configuration .controller-service-editable").hide();E("#controller-service-properties").propertytable("destroy").propertytable({supportsGoTo:true,readOnly:true,getParameterContext:function(ag){return j(ag)}});ad.data("mode",O.readOnly)}var af=E.ajax({type:"GET",url:ac.uri,dataType:"json"});var ab=E.ajax({type:"GET",url:"../nifi-api/flow/history/components/"+encodeURIComponent(ac.id),dataType:"json"});E.when(af,ab).done(function(al,ak){ac=al[0];var ah=ac.component;var am=ak[0].componentHistory;ad.data("controllerServiceDetails",ac);T.populateField("controller-service-id",ah.id);T.populateField("controller-service-type",T.formatType(ah));T.populateField("controller-service-bundle",T.formatBundle(ah.bundle));T.populateField("read-only-controller-service-name",ah.name);T.populateField("read-only-controller-service-comments",ah.comments);if(!T.isEmpty(ah.controllerServiceApis)){var ag=T.getFormattedServiceApis(ah.controllerServiceApis);var aj=T.formatUnorderedList(ag);E("#controller-service-compatible-apis").append(aj)}else{E("#controller-service-compatible-apis").append('<span class="unset">None</span>')}var ai=E("#controller-service-referencing-components");N(ae,ai,ac);var an=[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){ad.modal("hide")}}}];if(T.isDefinedAndNotNull(B)&&T.isDefinedAndNotNull(ah.customUiUrl)&&ah.customUiUrl!==""){an.push({buttonText:"Advanced",clazz:"fa fa-cog button-icon",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){ad.modal("hide");E("#shell-close-button").click();B.showCustomUi(ac,ah.customUiUrl,false).done(function(){J.showSettings()})}}})}ad.modal("setButtonModel",an);E("#controller-service-properties").propertytable("setGroupId",ah.parentGroupId).propertytable("loadProperties",ah.properties,ah.descriptors,am.propertyHistory);ad.modal("show");W(ai);E("#controller-service-properties").propertytable("resetTableSize")})},enable:function(ac,ab){D(ac,ab)},disable:function(ac,ab){A(ac,ab)},reloadReferencedServices:function(ac,ab){E.each(w(ab),function(ad,ae){Z(ac,ae)})},promptToDeleteController:function(ac,ab){k.showYesNoDialog({headerText:"Delete Controller Service",dialogContent:"Delete controller service '"+T.escapeHtml(ab.component.name)+"'?",yesHandler:function(){U.remove(ac,ab)}})},remove:function(ad,ab){var ac=g.getRevision(ab);E.ajax({type:"DELETE",url:ab.uri+"?"+E.param({version:ac.version,clientId:ac.clientId,disconnectedNodeAcknowledged:u.isDisconnectionAcknowledged()}),dataType:"json"}).done(function(ae){var af=ad.data("gridInstance");var ag=af.getData();ag.deleteItem(ab.id);if(ab.permissions.canRead){f(ad,ab.component)}}).fail(d.handleAjaxError)}};return U}));