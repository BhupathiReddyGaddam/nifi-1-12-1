(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.ErrorHandler","nf.Common","nf.Dialog","nf.Storage","nf.Client","nf.CanvasUtils","nf.ng.Bridge","nf.RemoteProcessGroup"],function(g,k,j,d,f,h,l,e,i,c){return(nf.RemoteProcessGroupPorts=b(g,k,j,d,f,h,l,e,i,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.RemoteProcessGroupPorts=b(require("jquery"),require("d3"),require("nf.ErrorHandler"),require("nf.Common"),require("nf.Dialog"),require("nf.Storage"),require("nf.Client"),require("nf.CanvasUtils"),require("nf.ng.Bridge"),require("nf.RemoteProcessGroup")))}else{nf.RemoteProcessGroupPorts=b(a.$,a.d3,a.nf.ErrorHandler,a.nf.Common,a.nf.Dialog,a.nf.Storage,a.nf.Client,a.nf.CanvasUtils,a.nf.ng.Bridge,a.nf.RemoteProcessGroup)}}}(this,function(g,n,l,c,e,i,o,d,j,b){var h=function(){g("#remote-port-configuration").modal({headerText:"Configure Remote Port",scrollableContentStyle:"scrollable",buttons:[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var r=g("#remote-port-concurrent-tasks").val();var q=g("#remote-port-batch-count").val();var w=new Array();if(!g.isNumeric(r)){w.push("Concurrent tasks must be an integer value.")}if(q&&!g.isNumeric(q)){w.push("Batch Settings: count must be an integer value.")}if(w.length==0){var p=g("#remote-process-group-ports-id").text();var v=n.select("#id-"+p).datum();var u=g("#remote-port-id").text();var t={revision:o.getRevision(v),disconnectedNodeAcknowledged:i.isDisconnectionAcknowledged(),remoteProcessGroupPort:{id:u,groupId:p,useCompression:g("#remote-port-use-compression").hasClass("checkbox-checked"),concurrentlySchedulableTaskCount:r,batchSettings:{count:q,size:g("#remote-port-batch-size").val(),duration:g("#remote-port-batch-duration").val()}}};var s="/output-ports/";if(g("#remote-port-type").text()==="input"){s="/input-ports/"}g.ajax({type:"PUT",data:JSON.stringify(t),url:v.uri+s+encodeURIComponent(u),dataType:"json",contentType:"application/json"}).done(function(x){v.revision=x.revision;var y=x.remoteProcessGroupPort;var A="No";if(y.useCompression===true){A="Yes"}g("#"+u+"-concurrent-tasks").text(y.concurrentlySchedulableTaskCount);g("#"+u+"-compression").text(A);var z=a(y);g("#"+u+"-batch-count").text(z.count);g("#"+u+"-batch-size").text(z.size);g("#"+u+"-batch-duration").text(z.duration);g("#remote-port-configuration").modal("hide")}).fail(l.handleConfigurationUpdateAjaxError)}else{e.showOkDialog({headerText:"Configuration Error",dialogContent:w.reduce(function(x,y){return typeof(x)==="string"?x+" "+y:y})})}}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){g("#remote-port-configuration").modal("hide")}}}],handler:{close:function(){g("#remote-port-id").text("");g("#remote-port-name").text("");g("#remote-port-concurrent-tasks").val("");g("#remote-port-use-compression").removeClass("checkbox-checked checkbox-unchecked");g("#remote-port-batch-count").val("");g("#remote-port-batch-size").val("");g("#remote-port-batch-duration").val("")}}})};var k=function(){g("#remote-process-group-ports").modal({scrollableContentStyle:"scrollable",headerText:"Remote Process Group Ports",buttons:[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var p=g("#remote-process-group-ports-id").text();var r=n.select("#id-"+p);var q=r.datum();if(d.canModify(r)){b.reload(q.id)}g("#remote-process-group-ports").modal("hide")}}}],handler:{close:function(){g("#remote-process-group-ports-id").text("");g("#remote-process-group-ports-name").text("");g("#remote-process-group-ports-urls").text("");var p=g("#remote-process-group-ports");c.cleanUpTooltips(p,"div.remote-port-removed");c.cleanUpTooltips(p,"div.concurrent-tasks-info");g("#remote-process-group-input-ports-container").empty();g("#remote-process-group-output-ports-container").empty()}}})};var a=function(q){var p={};var r=q.batchSettings;if(r){p.count=typeof(r.count)==="number"?r.count:"No value set";p.size=r.size?r.size:"No value set";p.duration=r.duration?r.duration:"No value set"}else{p.count="No value set";p.size="No value set";p.duration="No value set"}return p};var f=function(D,B,w){var t=c.escapeHtml(B.id);var x=g('<div class="remote-port-container"></div>').appendTo(D);var I=g('<div class="remote-port-edit-container"></div>').appendTo(x);var u=g('<div class="remote-port-details-container"></div>').appendTo(x);var z=g("#remote-process-group-ports-id").text();var v=n.select("#id-"+z);if(d.canOperate(v)){var J=function(L){var M;if(L.connected===true){if(L.transmitting===true){M=(j.injector.get("$compile")(g('<md-switch style="margin:0px" class="md-primary enabled-active-transmission" aria-label="Toggle port transmission"></md-switch>'))(j.rootScope));M.click()}else{if(L.exists===true){M=(j.injector.get("$compile")(g('<md-switch style="margin:0px" class="md-primary enabled-inactive-transmission" aria-label="Toggle port transmission"></md-switch>'))(j.rootScope))}else{M=(j.injector.get("$compile")(g('<md-switch ng-disabled="true" style="margin:0px" class="md-primary disabled-inactive-transmission" aria-label="Toggle port transmission"></md-switch>'))(j.rootScope))}}}else{if(L.transmitting===true){M=(j.injector.get("$compile")(g('<md-switch style="margin:0px" class="md-primary disabled-active-transmission" aria-label="Toggle port transmission"></md-switch>'))(j.rootScope))}else{M=(j.injector.get("$compile")(g('<md-switch ng-disabled="true" style="margin:0px" class="md-primary disabled-inactive-transmission" aria-label="Toggle port transmission"></md-switch>'))(j.rootScope))}}return M};var C=J(B);C.appendTo(I);if(d.canModify(v)){if(B.exists===true&&B.connected===true){var H=g('<button class="button edit-remote-port fa fa-pencil"></button>').click(function(){var P=g("#"+t+"-name").text();var O=g("#"+t+"-concurrent-tasks").text();var L=g("#"+t+"-compression").text()==="Yes";var N=g("#"+t+"-batch-count").text();var M=g("#"+t+"-batch-size").text();var Q=g("#"+t+"-batch-duration").text();m(B.id,P,O,L,N,M,Q,w)}).appendTo(I);if(B.transmitting===true){H.hide()}else{H.show()}}else{if(B.exists===false){g('<div class="remote-port-removed" />').appendTo(I).qtip(g.extend({},c.config.tooltipConfig,{content:"This port has been removed."}))}}}if(c.isDefinedAndNotNull(C)){var K=function(){var L=g("#remote-process-group-ports-id").text();var O=n.select("#id-"+L).datum();var P=false;if(C.hasClass("enabled-inactive-transmission")){P=true}var N={revision:o.getRevision(O),disconnectedNodeAcknowledged:i.isDisconnectionAcknowledged(),state:P?"TRANSMITTING":"STOPPED"};var M="/output-ports/";if(w==="input"){M="/input-ports/"}g.ajax({type:"PUT",data:JSON.stringify(N),url:O.uri+M+encodeURIComponent(B.id)+"/run-status",dataType:"json",contentType:"application/json"}).done(function(Q){O.revision=Q.revision;var R=Q.remoteProcessGroupPort;if(R.exists===false){C.removeClass("enabled-active-transmission enabled-inactive-transmission").addClass("disabled-inactive-transmission").off("click");if(c.isDefinedAndNotNull(H)){H.hide()}}else{if(R.transmitting===true){C.removeClass("enabled-active-transmission enabled-inactive-transmission").addClass("enabled-active-transmission");if(c.isDefinedAndNotNull(H)){H.hide()}}else{C.removeClass("enabled-active-transmission enabled-inactive-transmission").addClass("enabled-inactive-transmission");if(c.isDefinedAndNotNull(H)){H.show()}}}}).fail(function(T,Q,R){var S=J(B);S.click(K);C.replaceWith(S);C=S;l.handleConfigurationUpdateAjaxError(T,Q,R)})};C.click(K)}}else{if(B.transmitting===true){(j.injector.get("$compile")(g('<md-switch style="margin:0px" class="md-primary enabled-inactive-transmission" aria-label="Toggle port transmission"></md-switch>'))(j.rootScope)).appendTo(I)}else{(j.injector.get("$compile")(g('<md-switch ng-disabled="true" style="margin:0px" class="md-primary disabled-inactive-transmission" aria-label="Toggle port transmission"></md-switch>'))(j.rootScope)).appendTo(I)}}g('<div id="'+t+'-id" class="remote-port-id hidden"></div>').text(B.id).appendTo(u);g('<div id="'+t+'-name" class="remote-port-name ellipsis"></div>').text(B.name).appendTo(u);g('<div class="clear"></div>').appendTo(u);if(c.isBlank(B.comments)){g('<div class="remote-port-description unset">No description specified.</div>').appendTo(u)}else{g('<div class="remote-port-description"></div>').text(B.comments).appendTo(u)}g('<div class="clear"></div>').appendTo(u);var E=g('<div class="concurrent-task-container"></div>').appendTo(u);var y=g('<div class="setting-field"></div>').append(g('<div id="'+t+'-concurrent-tasks"></div>').text(B.concurrentlySchedulableTaskCount));g('<div><div class="setting-name">Concurrent tasks<div class="processor-setting concurrent-tasks-info fa fa-question-circle"></div></div></div>').append(y).appendTo(E).find("div.concurrent-tasks-info").qtip(g.extend({},c.config.tooltipConfig,{content:"The number of tasks that should be concurrently scheduled for this port."}));var q=g('<div class="compression-container"></div>').appendTo(u);var p="No";if(B.useCompression===true){p="Yes"}g('<div><div class="setting-name">Compressed</div><div class="setting-field"><div id="'+t+'-compression">'+p+"</div></div></div>").appendTo(q);g('<div class="clear"></div>').appendTo(u);var s=g('<div class="batch-settings-container"></div>').append(g('<div class="setting-name">Batch Settings<div class="processor-setting batch-settings-info fa fa-question-circle"></div></div>')).appendTo(u);s.find("div.batch-settings-info").qtip(g.extend({},nf.Common.config.tooltipConfig,{content:(w==="input"?"The batch settings to control how this NiFi sends data to the remote input port in a transaction. This NiFi will transfer as much flow files as they are queued in incoming relationships, until any of these limits is met. If none of these setting is specified, this NiFi uses 500 milliseconds batch duration by default.":"The batch settings to tell the remote NiFi how this NiFi prefers to receive data from the remote output port in a transaction. The remote NiFi will use these settings as a hint to control batch data transferring. However, actual behavior depends on the version of remote NiFi instance. Recent version of NiFi uses 5 seconds for batch duration if none of these setting is specified.")}));var G=a(B);var r=g('<div class="setting-field"></div>').append(g('<div id="'+t+'-batch-count"></div>').text(G.count));var F=g('<div class="setting-field"></div>').append(g('<div id="'+t+'-batch-size"></div>').text(G.size));var A=g('<div class="setting-field"></div>').append(g('<div id="'+t+'-batch-duration"></div>').text(G.duration));g('<div class="batch-setting"><div class="setting-name">Count<div class="processor-setting"></div></div></div>').append(r).appendTo(s);g('<div class="batch-setting"><div class="setting-name">Size<div class="processor-setting"></div></div></div>').append(F).appendTo(s);g('<div class="batch-setting"><div class="setting-name">Duration<div class="processor-setting"></div></div></div>').append(A).appendTo(s);g('<div class="clear"></div>').appendTo(x);x.find(".ellipsis").ellipsis();j.digest()};var m=function(s,t,v,w,q,u,r,p){g("#remote-port-id").text(s);g("#remote-port-type").text(p);var x="checkbox-unchecked";if(w===true){x="checkbox-checked"}g("#remote-port-use-compression").addClass(x);g("#remote-port-concurrent-tasks").val(v);g("#remote-port-batch-count").val(q==="No value set"?null:q);g("#remote-port-batch-size").val(u==="No value set"?null:u);g("#remote-port-batch-duration").val(r==="No value set"?null:r);g("#remote-port-name").text(t).ellipsis();g("#remote-port-configuration").modal("show")};return{init:function(){h();k()},showPorts:function(p){if(d.isRemoteProcessGroup(p)){var q=p.datum();g.ajax({type:"GET",url:q.uri,dataType:"json"}).done(function(t){var w=t.component;b.set(t);g("#remote-process-group-ports-id").text(w.id);g("#remote-process-group-ports-name").text(w.name);g("#remote-process-group-ports-urls").text(w.targetUris);var r=w.contents;if(c.isDefinedAndNotNull(r)){var A=[];var u=[];var s=function(C,B){var E=C.name.toUpperCase();var D=B.name.toUpperCase();return E<D?-1:(E>D?1:0)};var y=g("#remote-process-group-input-ports-container");g.each(r.inputPorts,function(C,B){if(B.connected===true){A.push(B)}else{u.push(B)}});A.sort(s);u.sort(s);g.each(A,function(C,B){f(y,B,"input")});g.each(u,function(C,B){f(y,B,"input")});if(c.isEmpty(A)&&c.isEmpty(u)){g('<div class="unset"></div>').text("No ports to display").appendTo(y)}var v=[];var z=[];var x=g("#remote-process-group-output-ports-container");g.each(r.outputPorts,function(B,C){if(C.connected===true){v.push(C)}else{z.push(C)}});v.sort(s);z.sort(s);g.each(v,function(B,C){f(x,C,"output")});g.each(z,function(B,C){f(x,C,"output")});if(c.isEmpty(v)&&c.isEmpty(z)){g('<div class="unset"></div>').text("No ports to display").appendTo(x)}}g("#remote-process-group-ports").modal("show")}).fail(l.handleAjaxError)}}}}));