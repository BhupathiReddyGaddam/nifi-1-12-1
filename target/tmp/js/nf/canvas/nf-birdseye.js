(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Common","nf.CanvasUtils","nf.ContextMenu","nf.Label"],function(f,e,g,d,c,h){return(nf.Birdseye=b(f,e,g,d,c,h))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Birdseye=b(require("jquery"),require("d3"),require("nf.Common"),require("nf.CanvasUtils"),require("nf.ContextMenu"),require("nf.Label")))}else{nf.Birdseye=b(a.$,a.d3,a.nf.Common,a.nf.CanvasUtils,a.nf.ContextMenu,a.nf.Label)}}}(this,function(g,l,d,e,k,f){var h;var c;var j;var i=function(F){var D=e.getCanvasTranslate();var U=e.getCanvasScale();D=[D[0]/U,D[1]/U];var x=l.select("#canvas").node().getBoundingClientRect();var m=(x.left/U)-D[0];var z=((x.top-e.getCanvasOffset())/U)-D[1];var E=(x.right/U)-D[0];var s=(x.bottom/U)-D[1];var H=g("#canvas-container");var I=H.width()/U;var S=H.height()/U;var y=-D[0];var M=-D[1];var T=y+I;var v=M+S;var K=Math.min(m,y);var N=Math.min(z,M);var p=Math.max(E,T);var Q=Math.max(s,v);var R=p-K;var n=Q-N;var C=g("#birdseye");var B=C.width();var u=C.height();var L=B/R;var t=u/n;var J=Math.min(L,t);var r=[0,0];var o=[0,0];if(D[0]<0&&D[1]<0){r=[0,0];o=[-D[0],-D[1]]}else{if(D[0]>=0&&D[1]<0){r=[D[0],0];o=[0,-D[1]]}else{if(D[0]<0&&D[1]>=0){r=[0,D[1]];o=[-D[0],0]}else{r=[D[0],D[1]];o=[0,0]}}}var P=0;var w=-m;if(D[0]<0){if(D[0]<w){P=w}else{P=w-(w-D[0])}}else{if(D[0]<w){P=w-D[0]}}var O=0;var G=-z;if(D[1]<0){if(D[1]<G){O=G}else{O=G-(G-D[1])}}else{if(D[1]<G){O=G-D[1]}}r=[r[0]+P,r[1]+O];o=[o[0]+P,o[1]+O];c.attr("transform","scale("+J+")");j.attr("transform","translate("+r+")");l.select("rect.birdseye-brush").attrs({width:I,height:S,"stroke-width":(2/J),transform:function(V){V.x=o[0];V.y=o[1];return"translate("+o+")"}});var A=l.select("#birdseye-canvas").node();var q=A.getContext("2d");q.save();q.setTransform(1,0,0,1,0,0);q.clearRect(0,0,A.width,A.height);q.restore();q.save();q.translate(r[0]*J,r[1]*J);q.scale(J,J);g.each(F.labels,function(W,X){var V=f.defaultColor();if(X.permissions.canRead){if(d.isDefinedAndNotNull(X.component.style["background-color"])){V=X.component.style["background-color"]}}q.fillStyle=V;q.fillRect(X.position.x,X.position.y,X.dimensions.width,X.dimensions.height)});q.fillStyle="#ad9897";g.each(F.funnels,function(V,W){q.fillRect(W.position.x,W.position.y,W.dimensions.width,W.dimensions.height)});q.fillStyle="#bbdcde";g.each(F.ports,function(V,W){q.fillRect(W.position.x,W.position.y,W.dimensions.width,W.dimensions.height)});q.fillStyle="#728e9b";g.each(F.remoteProcessGroups,function(V,W){q.fillRect(W.position.x,W.position.y,W.dimensions.width,W.dimensions.height)});g.each(F.processGroups,function(V,W){q.fillRect(W.position.x,W.position.y,W.dimensions.width,W.dimensions.height)});g.each(F.processors,function(W,X){var V="#dde4eb";if(X.permissions.canRead){if(d.isDefinedAndNotNull(X.component.style["background-color"])){V=X.component.style["background-color"];if(V==="#ffffff"){V="#dde4eb"}}}q.fillStyle=V;q.fillRect(X.position.x,X.position.y,X.dimensions.width,X.dimensions.height)});q.restore()};var b=true;var a={init:function(m){h=m;var p=g("#birdseye");l.select("#birdseye").append("canvas").attr("id","birdseye-canvas").attr("width",p.width()).attr("height",p.height());var o=l.select("#birdseye").append("svg").attr("width",p.width()).attr("height",p.height());c=o.append("g").attr("class","birdseye");j=c.append("g").attr("pointer-events","none");var n=l.drag().subject(function(q){return{x:q.x,y:q.y,source:"birdseye"}}).on("drag",function(q){q.x+=l.event.dx;q.y+=l.event.dy;l.select(this).attr("transform",function(){return"translate("+q.x+", "+q.y+")"});e.translateCanvas([-l.event.dx,-l.event.dy])}).on("end",function(){h.updateVisibility();e.persistUserView();a.refresh()});c.append("g").attrs({"pointer-events":"all","class":"birdseye-brush-container"}).append("rect").attr("class","birdseye-brush moveable").datum({x:0,y:0}).call(n)},refresh:function(){if(b){i(h.get())}},updateBirdseyeVisibility:function(m){var n=g("#birdseye");if(m){n.show();b=true;i(h.get())}else{n.hide();b=false}}};return a}));