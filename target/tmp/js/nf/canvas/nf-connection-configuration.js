(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.ErrorHandler","nf.Common","nf.Dialog","nf.Storage","nf.Client","nf.CanvasUtils","nf.Connection"],function(f,j,i,c,e,g,k,d,h){return(nf.ConnectionConfiguration=b(f,j,i,c,e,g,k,d,h))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ConnectionConfiguration=b(require("jquery"),require("d3"),require("nf.ErrorHandler"),require("nf.Common"),require("nf.Dialog"),require("nf.Storage"),require("nf.Client"),require("nf.CanvasUtils"),require("nf.Connection")))}else{nf.ConnectionConfiguration=b(a.$,a.d3,a.nf.ErrorHandler,a.nf.Common,a.nf.Dialog,a.nf.Storage,a.nf.Client,a.nf.CanvasUtils,a.nf.Connection)}}}(this,function(x,I,d,H,j,s,g,M,Q){var e;var r;var o;var i;var n=75;var L=200;var t=false;var D={urls:{api:"../nifi-api",prioritizers:"../nifi-api/flow/prioritizers"}};var h=function(){I.select("path.connector").remove()};var w=function(){x("div.available-relationship").bind("change",function(){x("#connection-configuration").modal("refreshButtons")})};var b=function(R){if(M.isProcessor(R)){return x.Deferred(function(S){G(R).done(function(U){if(!H.isEmpty(U.relationships)){x.each(U.relationships,function(V,W){z(W.name)});w();var T=x("#relationship-names").children("div");if(T.length===1){T.children("div.available-relationship").removeClass("checkbox-unchecked").addClass("checkbox-checked")}x("#connection-configuration").modal("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){return v().length===0||y()},handler:{click:function(){E(v())}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},disabled:function(){return y()},handler:{click:function(){x("#connection-configuration").modal("hide")}}}]);S.resolve()}else{j.showOkDialog({headerText:"Connection Configuration",dialogContent:"'"+H.escapeHtml(U.name)+"' does not support any relationships."});l();S.reject()}}).fail(function(){S.reject()})}).promise()}else{return x.Deferred(function(T){var S;if(M.isInputPort(R)){S=F(R)}else{if(M.isRemoteProcessGroup(R)){S=f(R)}else{if(M.isProcessGroup(R)){S=J(R)}else{S=m(R)}}}S.done(function(){x("#connection-configuration").modal("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){return y()},handler:{click:function(){E()}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},disabled:function(){return y()},handler:{click:function(){x("#connection-configuration").modal("hide")}}}]);T.resolve()}).fail(function(){T.reject()})}).promise()}};var F=function(R){return x.Deferred(function(T){var S=R.datum();var U=S.permissions.canRead?S.component.name:S.id;x("#input-port-source").show();x("#input-port-source-name").text(U).attr("title",U);x("#connection-source-id").val(S.id);x("#connection-source-component-id").val(S.id);x("#connection-source-group-id").val(M.getGroupId());x("#connection-source-group-name").text(M.getGroupName());T.resolve()}).promise()};var m=function(R){return x.Deferred(function(T){var S=R.datum();x("#funnel-source").show();x("#connection-source-id").val(S.id);x("#connection-source-component-id").val(S.id);x("#connection-source-group-id").val(M.getGroupId());x("#connection-source-group-name").text(M.getGroupName());T.resolve()}).promise()};var G=function(R){return x.Deferred(function(T){var S=R.datum();var U=S.permissions.canRead?S.component.name:S.id;var V=S.permissions.canRead?H.substringAfterLast(S.component.type,"."):"Processor";x("#processor-source").show();x("#processor-source-name").text(U).attr("title",U);x("#processor-source-type").text(V).attr("title",V);x("#connection-source-id").val(S.id);x("#connection-source-component-id").val(S.id);x("#connection-source-group-id").val(M.getGroupId());x("#connection-source-group-name").text(M.getGroupName());x("#relationship-names-container").show();T.resolve(S.component)})};var J=function(R){return x.Deferred(function(S){var T=R.datum();x.ajax({type:"GET",url:D.urls.api+"/flow/process-groups/"+encodeURIComponent(T.id),dataType:"json"}).done(function(U){var Z=U.processGroupFlow;var Y=U.permissions.canRead?Z.breadcrumb.breadcrumb.name:Z.id;var aa=Z.flow;var V=[];var X=0;x.each(aa.outputPorts,function(ac,ad){if(ad.allowRemoteAccess){X++;return}if(ad.permissions.canRead&&ad.permissions.canWrite){var ab=ad.component;V.push({text:ab.name,value:ab.id,description:H.escapeHtml(ab.comments)})}});if(!H.isEmpty(V)){x("#output-port-source").show();V.sort(function(ac,ab){return ac.text.localeCompare(ab.text)});x("#output-port-options").combo({options:V,maxHeight:300,select:function(ab){x("#connection-source-id").val(ab.value)}});x("#connection-source-component-id").val(Z.id);x("#connection-source-group-id").val(Z.id);x("#connection-source-group-name").text(Y);S.resolve()}else{var W="'"+H.escapeHtml(Y)+"' does not have any local output ports.";if(H.isEmpty(aa.outputPorts)===false&&aa.outputPorts.length>X){W="Not authorized for any local output ports in '"+H.escapeHtml(Y)+"'."}j.showOkDialog({headerText:"Connection Configuration",dialogContent:W});l();S.reject()}}).fail(function(W,U,V){d.handleAjaxError(W,U,V);S.reject()})}).promise()};var f=function(R){return x.Deferred(function(S){var T=R.datum();x.ajax({type:"GET",url:T.uri,dataType:"json"}).done(function(U){var W=U.component;var X=W.contents;if(!H.isEmpty(X.outputPorts)){x("#output-port-source").show();var V=[];x.each(X.outputPorts,function(Y,Z){V.push({text:Z.name,value:Z.id,disabled:Z.exists===false,description:H.escapeHtml(Z.comments)})});V.sort(function(Z,Y){return Z.text.localeCompare(Y.text)});x("#output-port-options").combo({options:V,maxHeight:300,select:function(Y){x("#connection-source-id").val(Y.value)}});x("#connection-source-component-id").val(W.id);x("#connection-source-group div.setting-name").text("Within Remote Group");x("#connection-remote-source-url").text(W.targetUri).show();x("#connection-source-group-id").val(W.id);x("#connection-source-group-name").text(W.name);S.resolve()}else{j.showOkDialog({headerText:"Connection Configuration",dialogContent:"'"+H.escapeHtml(W.name)+"' does not have any output ports."});l();S.reject()}}).fail(function(W,U,V){d.handleAjaxError(W,U,V);S.reject()})}).promise()};var a=function(R){if(M.isOutputPort(R)){return p(R)}else{if(M.isProcessor(R)){return C(R)}else{if(M.isRemoteProcessGroup(R)){return N(R)}else{if(M.isFunnel(R)){return u(R)}else{return P(R)}}}}};var p=function(R){return x.Deferred(function(S){var U=R.datum();var T=U.permissions.canRead?U.component.name:U.id;x("#output-port-destination").show();x("#output-port-destination-name").text(T).attr("title",T);x("#connection-destination-id").val(U.id);x("#connection-destination-component-id").val(U.id);x("#connection-destination-group-id").val(M.getGroupId());x("#connection-destination-group-name").text(M.getGroupName());S.resolve()}).promise()};var u=function(R){return x.Deferred(function(T){var S=R.datum();x("#funnel-destination").show();x("#connection-destination-id").val(S.id);x("#connection-destination-component-id").val(S.id);x("#connection-destination-group-id").val(M.getGroupId());x("#connection-destination-group-name").text(M.getGroupName());T.resolve()}).promise()};var C=function(R){return x.Deferred(function(T){var S=R.datum();var U=S.permissions.canRead?S.component.name:S.id;var V=S.permissions.canRead?H.substringAfterLast(S.component.type,"."):"Processor";x("#processor-destination").show();x("#processor-destination-name").text(U).attr("title",U);x("#processor-destination-type").text(V).attr("title",V);x("#connection-destination-id").val(S.id);x("#connection-destination-component-id").val(S.id);x("#connection-destination-group-id").val(M.getGroupId());x("#connection-destination-group-name").text(M.getGroupName());T.resolve()}).promise()};var P=function(R){return x.Deferred(function(S){var T=R.datum();x.ajax({type:"GET",url:D.urls.api+"/flow/process-groups/"+encodeURIComponent(T.id),dataType:"json"}).done(function(U){var X=U.processGroupFlow;var W=U.permissions.canRead?X.breadcrumb.breadcrumb.name:X.id;var Y=X.flow;var V=[];x.each(Y.inputPorts,function(aa,Z){if(!Z.allowRemoteAccess){V.push({text:Z.permissions.canRead?Z.component.name:Z.id,value:Z.id,description:Z.permissions.canRead?H.escapeHtml(Z.component.comments):null})}});if(!H.isEmpty(V)){x("#input-port-destination").show();V.sort(function(aa,Z){return aa.text.localeCompare(Z.text)});x("#input-port-options").combo({options:V,maxHeight:300,select:function(Z){x("#connection-destination-id").val(Z.value)}});x("#connection-destination-component-id").val(X.id);x("#connection-destination-group-id").val(X.id);x("#connection-destination-group-name").text(W);S.resolve()}else{j.showOkDialog({headerText:"Connection Configuration",dialogContent:"'"+H.escapeHtml(W)+"' does not have any local input ports."});l();S.reject()}}).fail(function(W,U,V){d.handleAjaxError(W,U,V);S.reject()})}).promise()};var N=function(R,S){return x.Deferred(function(T){var U=R.datum();x.ajax({type:"GET",url:U.uri,dataType:"json"}).done(function(V){var X=V.component;var Y=X.contents;if(!H.isEmpty(Y.inputPorts)){x("#input-port-destination").show();var W=[];x.each(Y.inputPorts,function(aa,Z){W.push({text:Z.name,value:Z.id,disabled:Z.exists===false,description:H.escapeHtml(Z.comments)})});W.sort(function(aa,Z){return aa.text.localeCompare(Z.text)});x("#input-port-options").combo({options:W,maxHeight:300,select:function(Z){x("#connection-destination-id").val(Z.value)}});x("#connection-destination-component-id").val(X.id);x("#connection-destination-group div.setting-name").text("Within Remote Group");x("#connection-remote-destination-url").text(X.targetUri).show();x("#connection-destination-group-id").val(X.id);x("#connection-destination-group-name").text(X.name);T.resolve()}else{j.showOkDialog({headerText:"Connection Configuration",dialogContent:"'"+H.escapeHtml(X.name)+"' does not have any input ports."});l();T.reject()}}).fail(function(X,V,W){d.handleAjaxError(X,V,W);T.reject()})}).promise()};var O=function(R){return x.Deferred(function(T){var U=R.datum();var S=U.permissions.canRead?U.component.name:U.id;x("#read-only-output-port-source").show();x("#connection-source-component-id").val(U.id);x("#connection-source-group-id").val(U.id);x("#connection-source-group-name").text(S);if(M.isRemoteProcessGroup(R)){x("#connection-source-group div.setting-name").text("Within Remote Group");if(U.permissions.canRead){x("#connection-remote-source-url").text(U.component.targetUri).show()}}T.resolve()}).promise()};var k=function(R){if(M.isProcessor(R)){return G(R)}else{if(M.isInputPort(R)){return F(R)}else{if(M.isFunnel(R)){return m(R)}else{return O(R)}}}};var A=function(R,S){if(M.isProcessor(R)){return C(R)}else{if(M.isOutputPort(R)){return p(R)}else{if(M.isRemoteProcessGroup(R)){return N(R,S)}else{if(M.isFunnel(R)){return u(R)}else{return P(R)}}}}};var z=function(S){var R=x('<div class="relationship-name nf-checkbox-label ellipsis"></div>').text(S);var T=x('<span class="relationship-name-value hidden"></span>').text(S);return x('<div class="available-relationship-container"><div class="available-relationship nf-checkbox checkbox-unchecked"></div></div>').append(R).append(T).appendTo("#relationship-names")};var c=function(R){var S=(t!==R);t=R;if(S){x("#connection-configuration").modal("refreshButtons")}};var y=function(){return t};var E=function(T){c(true);var aq=x("#connection-source-id").val();var an=x("#connection-destination-id").val();var av=x("#connection-source-component-id").val();var ak=I.select("#id-"+av);var ao=x("#connection-destination-component-id").val();var ac=I.select("#id-"+ao);var aD=ak.datum();var ad=ac.datum();var U=[];if(av===ao){var aj={x:aD.position.x+(aD.dimensions.width),y:aD.position.y+(aD.dimensions.height/2)};var ap=Q.config.selfLoopXOffset;var ar=Q.config.selfLoopYOffset;U.push({x:(aj.x+ap),y:(aj.y-ar)});U.push({x:(aj.x+ap),y:(aj.y+ar)})}else{var aB=[];var au=Q.getComponentConnections(av);x.each(au,function(aG,aJ){var aH=M.getConnectionSourceComponentId(aJ);var aI=M.getConnectionDestinationComponentId(aJ);if((aH===av&&aI===ao)||(aI===av&&aH===ao)){aB.push(aJ)}});if(aB.length>0){var V=false;x.each(aB,function(aG,aH){if(H.isEmpty(aH.bends)){V=true;return false}});if(V===true){var al=[aD.position.x+(aD.dimensions.width/2),aD.position.y+(aD.dimensions.height/2)];var S=[ad.position.x+(ad.dimensions.width/2),ad.position.y+(ad.dimensions.height/2)];var ai=((al[1]-S[1])/(al[0]-S[0]));var az=ai<=1&&ai>=-1;var at=function(aG,aI){var aH=false;x.each(aB,function(aJ,aK){if(!H.isEmpty(aK.bends)){if(az){if(aK.bends[0].y===aI){aH=true;return false}}else{if(aK.bends[0].x===aG){aH=true;return false}}}});return aH};var Z=(al[0]+S[0])/2;var af=(al[1]+S[1])/2;var ay=az?0:L;var ah=az?n:0;var aA=false;while(aA===false){if(at(Z-ay,af-ah)===false){U.push({x:(Z-ay),y:(af-ah)});aA=true}else{if(at(Z+ay,af+ah)===false){U.push({x:(Z+ay),y:(af+ah)});aA=true}}if(az){ah+=n}else{ay+=L}}}}}var X=x("#connection-source-group-id").val();var R=x("#connection-destination-group-id").val();var aE=M.getConnectableTypeForSource(ak);var ag=M.getConnectableTypeForDestination(ac);var aa=x("#connection-name").val();var W=x("#flow-file-expiration").val();var aC=x("#back-pressure-object-threshold").val();var aF=x("#back-pressure-data-size-threshold").val();var am=x("#prioritizer-selected").sortable("toArray");var ae=x("#load-balance-strategy-combo").combo("getSelectedOption").value;var ab="DO_NOT_LOAD_BALANCE"!==ae;var Y=ab&&"PARTITION_BY_ATTRIBUTE"===ae?x("#load-balance-partition-attribute").val():"";var ax=ab?x("#load-balance-compression-combo").combo("getSelectedOption").value:"DO_NOT_COMPRESS";if(K()){var aw={revision:g.getRevision({revision:{version:0}}),disconnectedNodeAcknowledged:s.isDisconnectionAcknowledged(),component:{name:aa,source:{id:aq,groupId:X,type:aE},destination:{id:an,groupId:R,type:ag},selectedRelationships:T,flowFileExpiration:W,backPressureDataSizeThreshold:aF,backPressureObjectThreshold:aC,bends:U,prioritizers:am,loadBalanceStrategy:ae,loadBalancePartitionAttribute:Y,loadBalanceCompression:ax}};x.ajax({type:"POST",url:D.urls.api+"/process-groups/"+encodeURIComponent(M.getGroupId())+"/connections",data:JSON.stringify(aw),dataType:"json",contentType:"application/json"}).done(function(aG){r.add({connections:[aG]},{selectAll:true});c(false);x("#connection-configuration").modal("hide");M.reloadConnectionSourceAndDestination(av,ao);r.updateVisibility();e.refresh()}).fail(function(aI,aG,aH){c(false);d.handleConfigurationUpdateAjaxError(aI,aG,aH)})}};var B=function(ag){c(true);var Y=x("#connection-id").text();var S=x("#connection-uri").val();var ae=x("#connection-source-component-id").val();var R=x("#connection-destination-component-id").val();var ac=I.select("#id-"+R);var V=M.getConnectableTypeForDestination(ac);var ah=x("#connection-destination-id").val();var af=x("#connection-destination-group-id").val();var ab=x("#connection-name").val();var aa=x("#flow-file-expiration").val();var T=x("#back-pressure-object-threshold").val();var ai=x("#back-pressure-data-size-threshold").val();var ak=x("#prioritizer-selected").sortable("toArray");var aj=x("#load-balance-strategy-combo").combo("getSelectedOption").value;var W="DO_NOT_LOAD_BALANCE"!==aj;var Z=W&&"PARTITION_BY_ATTRIBUTE"===aj?x("#load-balance-partition-attribute").val():"";var X=W?x("#load-balance-compression-combo").combo("getSelectedOption").value:"DO_NOT_COMPRESS";if(K()){var ad=Q.get(Y);var U={revision:g.getRevision(ad),disconnectedNodeAcknowledged:s.isDisconnectionAcknowledged(),component:{id:Y,name:ab,destination:{id:ah,groupId:af,type:V},selectedRelationships:ag,flowFileExpiration:aa,backPressureDataSizeThreshold:ai,backPressureObjectThreshold:T,prioritizers:ak,loadBalanceStrategy:aj,loadBalancePartitionAttribute:Z,loadBalanceCompression:X}};return x.ajax({type:"PUT",url:S,data:JSON.stringify(U),dataType:"json",contentType:"application/json"}).done(function(al){c(false);x("#connection-configuration").modal("hide");Q.set(al);M.reloadConnectionSourceAndDestination(ae,R)}).fail(function(an,al,am){c(false);d.handleConfigurationUpdateAjaxError(an,al,am)})}else{return x.Deferred(function(al){al.reject()}).promise()}};var v=function(){var S=x("#relationship-names");var R=[];x.each(S.children(),function(T,W){var V=x(W);var U=V.children("div.available-relationship");if(U.hasClass("checkbox-checked")){R.push(V.children("span.relationship-name-value").text())}});return R};var K=function(){var R=[];if(H.isBlank(x("#flow-file-expiration").val())){R.push("File expiration must be specified")}if(!x.isNumeric(x("#back-pressure-object-threshold").val())){R.push("Back pressure object threshold must be an integer value")}if(H.isBlank(x("#back-pressure-data-size-threshold").val())){R.push("Back pressure data size threshold must be specified")}if(x("#load-balance-strategy-combo").combo("getSelectedOption").value==="PARTITION_BY_ATTRIBUTE"&&H.isBlank(x("#load-balance-partition-attribute").val())){R.push('Cannot set Load Balance Strategy to "Partition by attribute" without providing a partitioning "Attribute Name"')}if(R.length>0){j.showOkDialog({headerText:"Configuration Error",dialogContent:H.formatUnorderedList(R)});return false}else{return true}};var l=function(){var T=x("#prioritizer-selected");var R=x("#prioritizer-available");T.children().detach().appendTo(R);var S=R.children("li").get();S.sort(function(V,U){var X=x(V).text().toUpperCase();var W=x(U).text().toUpperCase();return(X<W)?-1:(X>W)?1:0});x.each(S,function(){x(this).detach()});x.each(S,function(){x(this).appendTo(R)});x("#connection-name").val("");x("#relationship-names").css("border-width","0").empty();x("#relationship-names-container").hide();H.clearField("connection-id");x("#processor-source").hide();x("#input-port-source").hide();x("#output-port-source").hide();x("#read-only-output-port-source").hide();x("#funnel-source").hide();x("#processor-destination").hide();x("#input-port-destination").hide();x("#output-port-destination").hide();x("#funnel-destination").hide();x("#connection-source-id").val("");x("#connection-source-component-id").val("");x("#connection-source-group-id").val("");x("#connection-destination-id").val("");x("#connection-destination-component-id").val("");x("#connection-destination-group-id").val("");x("#output-port-options").empty();x("#input-port-options").empty();x("#load-balance-strategy-combo").combo("setSelectedOption",H.loadBalanceStrategyOptions[0]);x("#load-balance-partition-attribute").val("");x("#load-balance-compression-combo").combo("setSelectedOption",H.loadBalanceCompressionOptions[0]);h()};var q={init:function(U,R,T,S){e=U;r=R;o=T;i=S;x("#relationship-names-container").hide();x("#connection-configuration").modal({scrollableContentStyle:"scrollable",headerText:"Configure Connection",handler:{close:function(){l()},open:function(){H.toggleScrollable(x("#"+this.find(".tab-container").attr("id")+"-content").get(0))}}});x("#connection-configuration-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Details",tabContentId:"connection-details-tab-content"},{name:"Settings",tabContentId:"connection-settings-tab-content"}]});x("#load-balance-strategy-combo").combo({options:H.loadBalanceStrategyOptions,select:function(V){if(V.value==="PARTITION_BY_ATTRIBUTE"){x("#load-balance-partition-attribute-setting-separator").show();x("#load-balance-partition-attribute-setting").show()}else{x("#load-balance-partition-attribute-setting-separator").hide();x("#load-balance-partition-attribute-setting").hide()}if(V.value==="DO_NOT_LOAD_BALANCE"){x("#load-balance-compression-setting").hide()}else{x("#load-balance-compression-setting").show()}}});x("#load-balance-compression-combo").combo({options:H.loadBalanceCompressionOptions});x.ajax({type:"GET",url:D.urls.prioritizers,dataType:"json"}).done(function(V){x.each(V.prioritizerTypes,function(W,X){q.addAvailablePrioritizer("#prioritizer-available",X)});x("#prioritizer-available, #prioritizer-selected").sortable({containment:x("#connection-settings-tab-content").find(".settings-right"),connectWith:"ul",placeholder:"ui-state-highlight",scroll:true,opacity:0.6});x("#prioritizer-available, #prioritizer-selected").disableSelection()}).fail(d.handleAjaxError)},addAvailablePrioritizer:function(W,U){var T=U.type;var S=H.substringAfterLast(T,".");var V=x(W);var R=x("<li></li>").append(x('<span style="float: left;"></span>').text(S)).attr("id",T).addClass("ui-state-default").appendTo(V);if(H.isDefinedAndNotNull(U.description)){x('<div class="fa fa-question-circle"></div>').appendTo(R).qtip(x.extend({content:H.escapeHtml(U.description)},H.config.tooltipConfig))}},createConnection:function(T,U){var S=I.select("#id-"+T);var R=I.select("#id-"+U);if(S.empty()||R.empty()){return}x("#connection-source-group div.setting-name").text("Within Group");x("#connection-destination-group div.setting-name").text("Within Group");x("#connection-remote-source-url").hide();x("#connection-remote-destination-url").hide();x.when(b(S),a(R)).done(function(){x("#flow-file-expiration").val("0 sec");x("#back-pressure-object-threshold").val(o);x("#back-pressure-data-size-threshold").val(i);x("#connection-configuration-tabs").find("li:first").click();x("#connection-configuration").modal("setHeaderText","Create Connection").modal("show");x("#connection-configuration div.relationship-name").ellipsis();H.populateField("connection-id",null);var V=x("#relationship-names");if(V.is(":visible")&&V.get(0).scrollHeight>Math.round(V.innerHeight())){V.css("border-width","1px")}}).fail(function(){h()})},showConfiguration:function(S,R){return x.Deferred(function(U){var V=S.datum();var T=V.component;var Y=M.getConnectionSourceComponentId(V);var W=I.select("#id-"+Y);if(H.isUndefinedOrNull(R)){var X=M.getConnectionDestinationComponentId(V);R=I.select("#id-"+X)}x("#connection-source-group div.setting-name").text("Within Group");x("#connection-destination-group div.setting-name").text("Within Group");x("#connection-remote-source-url").hide();x("#connection-remote-destination-url").hide();x.when(k(W),A(R,T.destination)).done(function(){var ab=T.availableRelationships;var aa=T.selectedRelationships;if(H.isDefinedAndNotNull(ab)||H.isDefinedAndNotNull(aa)){x.each(ab,function(ae,ad){z(ad)});w();x.each(aa,function(af,ad){if(x.inArray(ad,ab)===-1){var ag=z(ad);x(ag).children("div.relationship-name").addClass("undefined")}var ae=x("#relationship-names").children("div");x.each(ae,function(ah,aj){var ai=x(aj).children("span.relationship-name-value");if(ai.text()===ad){x(aj).children("div.available-relationship").removeClass("checkbox-unchecked").addClass("checkbox-checked")}})})}if(M.isProcessGroup(W)||M.isRemoteProcessGroup(W)){x("#connection-source-id").val(T.source.id);x("#read-only-output-port-name").text(T.source.name).attr("title",T.source.name)}if(M.isProcessGroup(R)||M.isRemoteProcessGroup(R)){var Z=R.datum();if(T.destination.groupId===Z.id){x("#input-port-options").combo("setSelectedOption",{value:T.destination.id})}}x("#connection-name").val(T.name);x("#flow-file-expiration").val(T.flowFileExpiration);x("#back-pressure-object-threshold").val(T.backPressureObjectThreshold);x("#back-pressure-data-size-threshold").val(T.backPressureDataSizeThreshold);x("#load-balance-strategy-combo").combo("setSelectedOption",{value:T.loadBalanceStrategy});x("#load-balance-compression-combo").combo("setSelectedOption",{value:T.loadBalanceCompression});x("#load-balance-partition-attribute").val(T.loadBalancePartitionAttribute);H.populateField("connection-id",T.id);x.each(T.prioritizers,function(ad,ae){x("#prioritizer-available").children('li[id="'+ae+'"]').detach().appendTo("#prioritizer-selected")});x("#connection-uri").val(V.uri);x("#connection-configuration").modal("setButtonModel",[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){if(M.isProcessor(W)){return v().length===0||y()}return y()},handler:{click:function(){c(true);if(M.isProcessor(W)){B(v()).done(function(){U.resolve()}).fail(function(){U.reject()}).always(function(){c(false)})}else{B(undefined).done(function(){U.resolve()}).fail(function(){U.reject()}).always(function(){c(false)})}}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},disabled:function(){return y()},handler:{click:function(){x("#connection-configuration").modal("hide");U.reject()}}}]);x("#connection-configuration").modal("setHeaderText","Configure Connection").modal("show");x("#connection-configuration div.relationship-name").ellipsis();var ac=x("#relationship-names");if(ac.is(":visible")&&ac.get(0).scrollHeight>Math.round(ac.innerHeight())){ac.css("border-width","1px")}}).fail(function(){U.reject()})}).promise()}};return q}));