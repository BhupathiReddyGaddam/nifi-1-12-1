(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Client","nf.Birdseye","nf.Storage","nf.Graph","nf.CanvasUtils","nf.ErrorHandler","nf.Dialog","nf.Common"],function(g,k,c,h,i,e,j,f,d){return(nf.ng.TemplateComponent=b(g,k,c,h,i,e,j,f,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.TemplateComponent=b(require("jquery"),require("nf.Client"),require("nf.Birdseye"),require("nf.Storage"),require("nf.Graph"),require("nf.CanvasUtils"),require("nf.ErrorHandler"),require("nf.Dialog"),require("nf.Common")))}else{nf.ng.TemplateComponent=b(a.$,a.nf.Client,a.nf.Birdseye,a.nf.Storage,a.nf.Graph,a.nf.CanvasUtils,a.nf.ErrorHandler,a.nf.Dialog,a.nf.Common)}}}(this,function(e,i,a,f,g,c,h,d,b){return function(l){var k=function(o,p){var n={templateId:o,originX:p.x,originY:p.y,disconnectedNodeAcknowledged:f.isDisconnectionAcknowledged()};e.ajax({type:"POST",url:l.headerCtrl.toolboxCtrl.config.urls.api+"/process-groups/"+encodeURIComponent(c.getGroupId())+"/template-instance",data:JSON.stringify(n),dataType:"json",contentType:"application/json"}).done(function(q){g.add(q.flow,{selectAll:true});g.updateVisibility();a.refresh()}).fail(h.handleAjaxError)};function j(){this.icon="icon icon-template";this.hoverIcon="icon icon-template-add";this.modal={getElement:function(){return e("#instantiate-template-dialog")},init:function(){this.getElement().modal({scrollableContentStyle:"scrollable",headerText:"Add Template"})},update:function(o,n){this.getElement().modal(o,n)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}}j.prototype={constructor:j,getElement:function(){return e("#template-component")},enabled:function(){this.getElement().attr("disabled",false)},disabled:function(){this.getElement().attr("disabled",true)},dropHandler:function(n){this.promptForTemplate(n)},dragIcon:function(n){return e('<div class="icon icon-template-add"></div>')},promptForTemplate:function(n){var o=this;e.ajax({type:"GET",url:l.headerCtrl.toolboxCtrl.config.urls.api+"/flow/templates",dataType:"json"}).done(function(p){var r=p.templates;if(b.isDefinedAndNotNull(r)&&r.length>0){r=r.sort(function(t,s){var v=b.parseDateTime(t.template.timestamp);var u=b.parseDateTime(s.template.timestamp);return u.getTime()-v.getTime()});var q=[];e.each(r,function(s,t){if(t.permissions.canRead===true){q.push({text:t.template.name,value:t.id,description:b.escapeHtml(t.template.description)})}});e("#available-templates").combo({maxHeight:300,options:q});o.modal.update("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var t=e("#available-templates").combo("getSelectedOption");var s=t.value;o.modal.hide();k(s,n)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){o.modal.hide()}}}]);o.modal.show()}else{d.showOkDialog({headerText:"Instantiate Template",dialogContent:"No templates have been loaded into this NiFi."})}}).fail(h.handleAjaxError)}};var m=new j();return m}}));