(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Common","nf.Dialog","nf.CanvasUtils","nf.ContextMenu","nf.ClusterSummary","nf.ErrorHandler","nf.Settings","nf.ParameterContexts","nf.ProcessGroup","nf.ProcessGroupConfiguration"],function(i,e,h,f,l,k,j,g,m,c,d){return(nf.ng.Canvas.FlowStatusCtrl=b(i,e,h,f,l,k,j,g,m,c,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.Canvas.FlowStatusCtrl=b(require("jquery"),require("nf.Common"),require("nf.Dialog"),require("nf.CanvasUtils"),require("nf.ContextMenu"),require("nf.ClusterSummary"),require("nf.ErrorHandler"),require("nf.Settings"),require("nf.ParameterContexts"),require("nf.ProcessGroup"),require("nf.ProcessGroupConfiguration")))}else{nf.ng.Canvas.FlowStatusCtrl=b(a.$,a.nf.Common,a.nf.Dialog,a.nf.CanvasUtils,a.nf.ContextMenu,a.nf.ClusterSummary,a.nf.ErrorHandler,a.nf.Settings,a.nf.ParameterContexts,a.nf.ProcessGroup,a.nf.ProcessGroupConfiguration)}}}(this,function(g,c,f,d,j,i,h,e,k,a,b){return function(o){var l={search:"Search",urls:{search:"../nifi-api/flow/search-results",status:"../nifi-api/flow/status"}};function n(){this.connectedNodesCount="-";this.clusterConnectionWarning=false;this.activeThreadCount="-";this.terminatedThreadCount="-";this.threadCounts="-";this.totalQueued="-";this.controllerTransmittingCount="-";this.controllerNotTransmittingCount="-";this.controllerRunningCount="-";this.controllerStoppedCount="-";this.controllerInvalidCount="-";this.controllerDisabledCount="-";this.controllerUpToDateCount="-";this.controllerLocallyModifiedCount="-";this.controllerStaleCount="-";this.controllerLocallyModifiedAndStaleCount="-";this.controllerSyncFailureCount="-";this.statsLastRefreshed="-";this.search={getInputElement:function(){return g("#search-field")},getButtonElement:function(){return g("#search-button")},getSearchContainerElement:function(){return g("#search-container")},init:function(){var p=this;g.widget("nf.searchAutocomplete",g.ui.autocomplete,{reset:function(){this.term=null},_create:function(){this._super();this.widget().menu("option","items","> :not(.search-header, .search-no-matches)")},_resizeMenu:function(){var q=this.menu.element;q.width(400)},_normalize:function(r){var q=[];q.push(r);return q},_renderMenu:function(s,r){var q=this;var t=r[0];if(!c.isEmpty(t.processorResults)){s.append('<li class="search-header"><div class="search-result-icon icon icon-processor"></div>Processors</li>');g.each(t.processorResults,function(v,u){q._renderItem(s,g.extend({},u,{type:"processor"}))})}if(!c.isEmpty(t.processGroupResults)){s.append('<li class="search-header"><div class="search-result-icon icon icon-group"></div>Process Groups</li>');g.each(t.processGroupResults,function(v,u){q._renderItem(s,g.extend({},u,{type:"process group"}))})}if(!c.isEmpty(t.remoteProcessGroupResults)){s.append('<li class="search-header"><div class="search-result-icon icon icon-group-remote"></div>Remote Process Groups</li>');g.each(t.remoteProcessGroupResults,function(u,v){q._renderItem(s,g.extend({},v,{type:"remote process group"}))})}if(!c.isEmpty(t.connectionResults)){s.append('<li class="search-header"><div class="search-result-icon icon icon-connect"></div>Connections</li>');g.each(t.connectionResults,function(v,u){q._renderItem(s,g.extend({},u,{type:"connection"}))})}if(!c.isEmpty(t.inputPortResults)){s.append('<li class="search-header"><div class="search-result-icon icon icon-port-in"></div>Input Ports</li>');g.each(t.inputPortResults,function(u,v){q._renderItem(s,g.extend({},v,{type:"input port"}))})}if(!c.isEmpty(t.outputPortResults)){s.append('<li class="search-header"><div class="search-result-icon icon icon-port-out"></div>Output Ports</li>');g.each(t.outputPortResults,function(u,v){q._renderItem(s,g.extend({},v,{type:"output port"}))})}if(!c.isEmpty(t.funnelResults)){s.append('<li class="search-header"><div class="search-result-icon icon icon-funnel"></div>Funnels</li>');g.each(t.funnelResults,function(v,u){q._renderItem(s,g.extend({},u,{type:"funnel"}))})}if(!c.isEmpty(t.labelResults)){s.append('<li class="search-header"><div class="search-result-icon icon icon-label"></div>Labels</li>');g.each(t.labelResults,function(u,v){q._renderItem(s,g.extend({},v,{type:"label"}))})}if(!c.isEmpty(t.controllerServiceNodeResults)){s.append('<li class="search-header"><div class="search-result-icon icon"></div>Controller Services</li>');g.each(t.controllerServiceNodeResults,function(u,v){q._renderItem(s,g.extend({},v,{type:"controller service"}))})}if(!c.isEmpty(t.parameterContextResults)){s.append('<li class="search-header"><div class="search-result-icon icon"></div>Parameter Contexts</li>');g.each(t.parameterContextResults,function(u,v){q._renderItem(s,g.extend({},v,{type:"parameter context"}))})}if(!c.isEmpty(t.parameterResults)){s.append('<li class="search-header"><div class="search-result-icon icon"></div>Parameters</li>');g.each(t.parameterResults,function(v,u){q._renderItem(s,g.extend({},u,{type:"parameter"}))})}if(s.children().length===0){s.append('<li class="unset search-no-matches">No results matched the search terms</li>')}},_renderItem:function(u,s){var z=g('<div class="search-match-header"></div>').text(s.name);var t=g("<a></a>").append(z);if(s.type!=="parameter context"&&s.type!=="parameter"){var x=g('<div class="search-match-header"></div>').append(document.createTextNode("Parent: "));var v="-";if(c.isDefinedAndNotNull(s.parentGroup)){v=s.parentGroup.name?s.parentGroup.name:s.parentGroup.id}x=x.append(g("<span></span>").text(v));var w=g('<div class="search-match-header"></div>').append(document.createTextNode("Versioned: "));var r="-";if(c.isDefinedAndNotNull(s.versionedGroup)){r=s.versionedGroup.name?s.versionedGroup.name:s.versionedGroup.id}w=w.append(g("<span></span>").text(r));t.append(x).append(w)}else{if(s.type==="parameter"){var q=g('<div class="search-match-header"></div>').append(document.createTextNode("Parameter Context: "));var y="-";if(c.isDefinedAndNotNull(s.parentGroup)){y=s.parentGroup.name?s.parentGroup.name:s.parentGroup.id}q=q.append(g("<span></span>").text(y));t.append(q)}}g.each(s.matches,function(B,A){t.append(g('<div class="search-match"></div>').text(A))});return g("<li></li>").data("ui-autocomplete-item",s).append(t).appendTo(u)}});this.getInputElement().searchAutocomplete({delay:1000,appendTo:"#search-flow-results",position:{my:"right top",at:"right bottom",offset:"1 1"},source:function(r,q){g.ajax({type:"GET",data:{q:r.term,a:d.getGroupId()},dataType:"json",url:l.urls.search}).done(function(s){q(s.searchResultsDTO)})},select:function(s,t){var r=t.item;switch(r.type){case"parameter context":k.showParameterContexts(r.id);break;case"parameter":var q=r.parentGroup;k.showParameterContext(q.id,null,r.name);break;case"controller service":var u=r.parentGroup;a.enterGroup(u.id).done(function(){b.showConfiguration(u.id).done(function(){b.selectControllerService(r.id)})});break;default:var u=r.parentGroup;d.showComponent(u.id,r.id);break}p.getInputElement().val("").blur();return false},open:function(q,r){var s=g(this);g('<div class="search-glass-pane"></div>').one("click",function(){}).appendTo("body")},close:function(q,r){g(this).searchAutocomplete("reset");p.getInputElement().val("");g("div.search-glass-pane").remove()}});p.toggleSearchField()},toggleSearchField:function(){var s=this;j.hide();var p=s.getInputElement().is(":visible");var t="none";var r="search-container-opened";var q="search-container-closed";if(!p){s.getButtonElement().css("background-color","#FFFFFF");t="inline-block";r="search-container-closed";q="search-container-opened"}else{s.getInputElement().css("display",t)}this.getSearchContainerElement().switchClass(r,q,500,function(){s.getInputElement().css("display",t);if(!p){s.getButtonElement().css("background-color","#FFFFFF");s.getInputElement().focus()}else{s.getButtonElement().css("background-color","#E3E8EB")}})}};this.bulletins={update:function(p){var r=g("#bulletin-button");var t=r.data("bulletins");if(c.doBulletinsDiffer(t,p.bulletins)){r.data("bulletins",p.bulletins);var s=c.getFormattedBulletins(p.bulletins);if(s.length===0){if(r.data("qtip")){r.removeClass("has-bulletins").qtip("api").destroy(true)}}else{var q=c.formatUnorderedList(s);if(r.data("qtip")){r.qtip("option","content.text",q)}else{r.addClass("has-bulletins").qtip(g.extend({},d.config.systemTooltipConfig,{content:q,position:{at:"bottom left",my:"top right",adjust:{x:4}}}))}}}e.setBulletins(p.controllerServiceBulletins,p.reportingTaskBulletins)}}}n.prototype={constructor:n,init:function(){this.search.init()},reloadFlowStatus:function(){var p=this;return g.ajax({type:"GET",url:l.urls.status,dataType:"json"}).done(function(q){if(c.isDefinedAndNotNull(q.controllerStatus)){p.update(q.controllerStatus)}}).fail(h.handleAjaxError)},updateClusterSummary:function(q){if(q.connectedToCluster){var p=q.connectedNodes.split(" / ");if(p.length===2&&p[0]!==p[1]){this.clusterConnectionWarning=true}else{this.clusterConnectionWarning=false}this.connectedNodesCount=q.connectedNodes}else{this.connectedNodesCount="Disconnected"}},hasTerminatedThreads:function(){if(Number.isInteger(this.terminatedThreadCount)){return this.terminatedThreadCount>0}else{return false}},getExtraThreadStyles:function(){if(Number.isInteger(this.terminatedThreadCount)&&this.terminatedThreadCount>0){return"warning"}else{if(this.activeThreadCount===0){return"zero"}}return""},getExtraClusterStyles:function(){if(this.connectedNodesCount==="Disconnected"||this.clusterConnectionWarning===true){return"warning"}return""},update:function(p){this.activeThreadCount=p.activeThreadCount;this.terminatedThreadCount=p.terminatedThreadCount;if(this.hasTerminatedThreads()){this.threadCounts=this.activeThreadCount+" ("+this.terminatedThreadCount+")"}else{this.threadCounts=this.activeThreadCount}this.totalQueued=p.queued;if(this.totalQueued.indexOf("0 / 0")>=0){g("#flow-status-container").find(".fa-list").addClass("zero")}else{g("#flow-status-container").find(".fa-list").removeClass("zero")}this.controllerTransmittingCount=c.isDefinedAndNotNull(p.activeRemotePortCount)?p.activeRemotePortCount:"-";if(this.controllerTransmittingCount>0){g("#flow-status-container").find(".fa-bullseye").removeClass("zero").addClass("transmitting")}else{g("#flow-status-container").find(".fa-bullseye").removeClass("transmitting").addClass("zero")}this.controllerNotTransmittingCount=c.isDefinedAndNotNull(p.inactiveRemotePortCount)?p.inactiveRemotePortCount:"-";if(this.controllerNotTransmittingCount>0){g("#flow-status-container").find(".icon-transmit-false").removeClass("zero").addClass("not-transmitting")}else{g("#flow-status-container").find(".icon-transmit-false").removeClass("not-transmitting").addClass("zero")}this.controllerRunningCount=c.isDefinedAndNotNull(p.runningCount)?p.runningCount:"-";if(this.controllerRunningCount>0){g("#flow-status-container").find(".fa-play").removeClass("zero").addClass("running")}else{g("#flow-status-container").find(".fa-play").removeClass("running").addClass("zero")}this.controllerStoppedCount=c.isDefinedAndNotNull(p.stoppedCount)?p.stoppedCount:"-";if(this.controllerStoppedCount>0){g("#flow-status-container").find(".fa-stop").removeClass("zero").addClass("stopped")}else{g("#flow-status-container").find(".fa-stop").removeClass("stopped").addClass("zero")}this.controllerInvalidCount=c.isDefinedAndNotNull(p.invalidCount)?p.invalidCount:"-";if(this.controllerInvalidCount>0){g("#flow-status-container").find(".fa-warning").removeClass("zero").addClass("invalid")}else{g("#flow-status-container").find(".fa-warning").removeClass("invalid").addClass("zero")}this.controllerDisabledCount=c.isDefinedAndNotNull(p.disabledCount)?p.disabledCount:"-";if(this.controllerDisabledCount>0){g("#flow-status-container").find(".icon-enable-false").removeClass("zero").addClass("disabled")}else{g("#flow-status-container").find(".icon-enable-false").removeClass("disabled").addClass("zero")}this.controllerUpToDateCount=c.isDefinedAndNotNull(p.upToDateCount)?p.upToDateCount:"-";if(this.controllerUpToDateCount>0){g("#flow-status-container").find(".fa-check").removeClass("zero").addClass("up-to-date")}else{g("#flow-status-container").find(".fa-check").removeClass("up-to-date").addClass("zero")}this.controllerLocallyModifiedCount=c.isDefinedAndNotNull(p.locallyModifiedCount)?p.locallyModifiedCount:"-";if(this.controllerLocallyModifiedCount>0){g("#flow-status-container").find(".fa-asterisk").removeClass("zero").addClass("locally-modified")}else{g("#flow-status-container").find(".fa-asterisk").removeClass("locally-modified").addClass("zero")}this.controllerStaleCount=c.isDefinedAndNotNull(p.staleCount)?p.staleCount:"-";if(this.controllerStaleCount>0){g("#flow-status-container").find(".fa-arrow-circle-up").removeClass("zero").addClass("stale")}else{g("#flow-status-container").find(".fa-arrow-circle-up").removeClass("stale").addClass("zero")}this.controllerLocallyModifiedAndStaleCount=c.isDefinedAndNotNull(p.locallyModifiedAndStaleCount)?p.locallyModifiedAndStaleCount:"-";if(this.controllerLocallyModifiedAndStaleCount>0){g("#flow-status-container").find(".fa-exclamation-circle").removeClass("zero").addClass("locally-modified-and-stale")}else{g("#flow-status-container").find(".fa-exclamation-circle").removeClass("locally-modified-and-stale").addClass("zero")}this.controllerSyncFailureCount=c.isDefinedAndNotNull(p.syncFailureCount)?p.syncFailureCount:"-";if(this.controllerSyncFailureCount>0){g("#flow-status-container").find(".fa-question").removeClass("zero").addClass("sync-failure")}else{g("#flow-status-container").find(".fa-question").removeClass("sync-failure").addClass("zero")}},updateBulletins:function(p){this.bulletins.update(p)}};var m=new n();return m}}));