(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Dialog","nf.Storage","nf.Birdseye","nf.CanvasUtils","nf.Common","nf.Client","nf.Processor"],function(g,j,f,h,c,e,d,k,i){return(nf.ng.Canvas.OperateCtrl=b(g,j,f,h,c,e,d,k,i))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.Canvas.OperateCtrl=b(require("jquery"),require("d3"),require("nf.Dialog"),require("nf.Storage"),require("nf.Birdseye"),require("nf.CanvasUtils"),require("nf.Common"),require("nf.Client"),require("nf.Processor")))}else{nf.ng.Canvas.OperateCtrl=b(a.$,a.d3,a.nf.Dialog,a.nf.Storage,a.nf.Birdseye,a.nf.CanvasUtils,a.nf.Common,a.nf.Client,a.nf.Processor)}}}(this,function(e,h,d,f,a,c,b,i,g){return function(){var k=function(){var m=e("#fill-color-value").val();if(/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(m)){e("#fill-color").minicolors("value",m)}};function j(){this.template={modal:{getElement:function(){return e("#new-template-dialog")},init:function(){this.getElement().modal({scrollableContentStyle:"scrollable",headerText:"Create Template"})},update:function(n,m){this.getElement().modal(n,m)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}};this.templateUpload={modal:{getElement:function(){return e("#upload-template-dialog")},init:function(){var m=e("#template-upload-form").ajaxForm({url:"../nifi-api/process-groups/",dataType:"xml",beforeSubmit:function(p,n,o){p.push({name:"disconnectedNodeAcknowledged",value:f.isDisconnectionAcknowledged()});o.url+=(encodeURIComponent(c.getGroupId())+"/templates/upload")},success:function(n,q,r,p){if(n.documentElement.tagName==="templateEntity"){d.showOkDialog({headerText:"Success",dialogContent:"Template successfully imported."})}else{var q="Unable to import template. Please check the log for errors.";if(n.documentElement.tagName==="errorResponse"){var o=n.documentElement.getAttribute("statusText");if(!b.isBlank(o)){q=o}}d.showOkDialog({headerText:"Unable to Upload",dialogContent:b.escapeHtml(q)})}},error:function(p,o,n){d.showOkDialog({headerText:"Unable to Upload",dialogContent:b.escapeHtml(p.responseText)})}});this.getElement().modal({headerText:"Upload Template",buttons:[{buttonText:"Upload",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var n=e("#selected-template-name").text();if(b.isBlank(n)){e("#upload-template-status").text("No template selected. Please browse to select a template.")}else{m.submit();e("#upload-template-dialog").modal("hide")}}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){e("#upload-template-dialog").modal("hide")}}}],handler:{close:function(){e("#selected-template-name").text("");e("#upload-template-status").text("");m.resetForm()}}});e("#template-file-field-button").on("click",function(n){e("#template-file-field").click()});e("#template-file-field").on("change",function(o){var n=e(this).val();if(!b.isBlank(n)){n=n.replace(/^.*[\\\/]/,"")}e("#selected-template-name").text(n);e("#upload-template-status").text("")})},update:function(n,m){this.getElement().modal(n,m)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}};this.fillcolor={modal:{getElement:function(){return e("#fill-color-dialog")},init:function(){this.getElement().modal({scrollableContentStyle:"scrollable",headerText:"Change Color",buttons:[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var m=c.getSelection();m.each(function(r){var p=h.select(this);var q=p.datum();var o=e("#fill-color").minicolors("value");if(o!==q.component.style["background-color"]){var n={revision:i.getRevision(q),disconnectedNodeAcknowledged:f.isDisconnectionAcknowledged(),component:{id:q.id,style:{"background-color":o}}};e.ajax({type:"PUT",url:q.uri,data:JSON.stringify(n),dataType:"json",contentType:"application/json"}).done(function(s){c.getComponentByType(q.type).set(s)}).fail(function(u,s,t){if(u.status===400||u.status===404||u.status===409){d.showOkDialog({headerText:"Error",dialogContent:b.escapeHtml(u.responseText)})}}).always(function(){a.refresh()})}});e("#fill-color-dialog").modal("hide")}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){e("#fill-color-dialog").modal("hide")}}}],handler:{close:function(){e("#fill-color-value").val("");e("#fill-color").minicolors("value","")}}})},update:function(n,m){this.getElement().modal(n,m)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")},minicolors:{getElement:function(){return e("#fill-color")},init:function(){this.getElement().minicolors({inline:true,change:function(n,m){e("#fill-color-value").val(n);if(n.toLowerCase()==="#ffffff"){e("#fill-color-processor-preview-icon").css({color:g.defaultIconColor(),"background-color":n})}else{e("#fill-color-processor-preview-icon").css({color:b.determineContrastColor(b.substringAfterLast(n,"#")),"background-color":n})}var o=n;if(o.toLowerCase()==="#ffffff"){o="rgba(0,0,0,0.25)"}e("#fill-color-processor-preview").css({"border-color":o});e("#fill-color-label-preview").css({background:n});e("#fill-color-label-preview-value").css("color",b.determineContrastColor(b.substringAfterLast(n,"#")))}});e("#fill-color-value").on("blur",k).on("keyup",function(n){var m=n.keyCode?n.keyCode:n.which;if(m===e.ui.keyCode.ENTER){k()}})}}}}}j.prototype={constructor:j,init:function(){this.template.modal.init();this.templateUpload.modal.init();this.fillcolor.modal.init();this.fillcolor.modal.minicolors.init()}};var l=new j();return l}}));