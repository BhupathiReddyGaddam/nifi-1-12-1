(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.ErrorHandler","nf.Common","nf.Dialog","nf.Storage","nf.Client","nf.ProcessGroup","nf.Shell","nf.CanvasUtils"],function(h,k,j,f,g,i,l,c,d,e){return(nf.ProcessGroupConfiguration=b(h,k,j,f,g,i,l,c,d,e))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ProcessGroupConfiguration=b(require("jquery"),require("d3"),require("nf.ErrorHandler"),require("nf.Common"),require("nf.Dialog"),require("nf.Storage"),require("nf.Client"),require("nf.ProcessGroup"),require("nf.Shell"),require("nf.CanvasUtils")))}else{nf.ProcessGroupConfiguration=b(a.$,a.d3,a.nf.ErrorHandler,a.nf.Common,a.nf.Dialog,a.nf.Storage,a.nf.Client,a.nf.ProcessGroup,a.nf.Shell,a.nf.CanvasUtils)}}}(this,function(d,s,f,h,j,e,t,g,q,n){var c;var l;var r={urls:{api:"../nifi-api",parameterContexts:"../nifi-api/flow/parameter-contexts"}};var k=function(){};var b=function(){return d("#process-group-controller-services-table")};var a=function(u,w){var v={revision:t.getRevision({revision:{version:u}}),disconnectedNodeAcknowledged:e.isDisconnectionAcknowledged(),component:{id:w,name:d("#process-group-name").val(),comments:d("#process-group-comments").val(),parameterContext:{id:d("#process-group-parameter-context-combo").combo("getSelectedOption").value},flowfileConcurrency:d("#process-group-flowfile-concurrency-combo").combo("getSelectedOption").value,flowfileOutboundPolicy:d("#process-group-outbound-policy-combo").combo("getSelectedOption").value}};d.ajax({type:"PUT",data:JSON.stringify(v),url:r.urls.api+"/process-groups/"+encodeURIComponent(w),dataType:"json",contentType:"application/json"}).done(function(y){if(y.permissions.canRead&&y.component.parentGroupId===n.getGroupId()){g.set(y)}j.showOkDialog({headerText:"Process Group Configuration",dialogContent:"Process group configuration successfully saved."});d("#process-group-configuration-save").off("click").on("click",function(){a(y.revision.version,w)});var x=r.urls.api+"/flow/process-groups/"+encodeURIComponent(w)+"/controller-services";d.ajax({type:"GET",url:x,dataType:"json"}).done(function(z){var B=b();h.cleanUpTooltips(B,"div.has-errors");var A=B.data("gridInstance");var C=A.getData();d.each(z.controllerServices,function(E,D){C.updateItem(D.id,D)})});n.reload()}).fail(f.handleConfigurationUpdateAjaxError)};var m=function(w){var z=function(){d("#read-only-process-group-name").text("Unauthorized");d("#read-only-process-group-comments").text("Unauthorized")};var y=function(B){if(B){d("#process-group-configuration div.editable").show();d("#process-group-configuration div.read-only").hide();d("#process-group-configuration-save").show()}else{d("#process-group-configuration div.editable").hide();d("#process-group-configuration div.read-only").show();d("#process-group-configuration-save").hide()}};d("#process-group-id").text(w);d("#process-group-configuration-refresh-button").off("click").on("click",function(){m(w)});d("#add-process-group-configuration-controller-service").off("click").on("click",function(){var C=d("#process-group-configuration-tabs li.selected-tab").text();if(C==="Controller Services"){var B=r.urls.api+"/process-groups/"+encodeURIComponent(w)+"/controller-services";c.promptNewControllerService(B,b())}});var x=d.Deferred(function(B){d.ajax({type:"GET",url:r.urls.api+"/process-groups/"+encodeURIComponent(w),dataType:"json"}).done(function(C){d("#process-group-configuration").data("process-group",C);var E=C.component;if(C.permissions.canWrite){d("#process-group-name").removeClass("unset").val(E.name);d("#process-group-comments").removeClass("unset").val(E.comments);d("#process-group-flowfile-concurrency-combo").removeClass("unset").combo({options:[{text:"Single FlowFile Per Node",value:"SINGLE_FLOWFILE_PER_NODE",description:"Only a single FlowFile is to be allowed to enter the Process Group at a time on each node in the cluster. While that FlowFile may be split into many or spawn many children, no additional FlowFiles will be allowed to enter the Process Group through a Local Input Port until the previous FlowFile - and all of its child/descendent FlowFiles - have been processed."},{text:"Single Batch Per Node",value:"SINGLE_BATCH_PER_NODE",description:"When an Input Port pulls a FlowFile into the Process Group, FlowFiles will continue to be ingested into the Process Group until all input queues have been emptied. At that point, no additional FlowFiles will be allowed to enter the Process Group through a Local Input Port until the entire batch of FlowFiles has been processed."},{text:"Unbounded",value:"UNBOUNDED",description:"The number of FlowFiles that can be processed concurrently is unbounded."}],selectedOption:{value:E.flowfileConcurrency}});d("#process-group-outbound-policy-combo").removeClass("unset").combo({options:[{text:"Stream When Available",value:"STREAM_WHEN_AVAILABLE",description:"FlowFiles that are queued up to be transferred out of a Process Group by an Output Port will be transferred out of the Process Group as soon as they are available."},{text:"Batch Output",value:"BATCH_OUTPUT",description:"FlowFiles that are queued up to be transferred out of a Process Group by an Output Port will remain queued until all FlowFiles in the Process Group are ready to be transferred out of the group. The FlowFiles will then be transferred out of the group. This setting will be ignored if the FlowFile Concurrency is Unbounded."}],selectedOption:{value:E.flowfileOutboundPolicy}});d("#process-group-configuration-header-text").text(E.name+" Configuration");y(true);d("#process-group-configuration-save").off("click").on("click",function(){a(C.revision.version,C.id)})}else{if(C.permissions.canRead){d("#read-only-process-group-name").text(E.name);d("#read-only-process-group-comments").text(E.comments);var F;if(E.flowfileConcurrency=="UNBOUNDED"){F="Unbounded"}else{if(E.flowfileConcurrency=="SINGLE_FLOWFILE_PER_NODE"){F="Single FlowFile Per Node"}else{if(E.flowfileConcurrency=="SINGLE_BATCH_PER_NODE"){F="Single Batch Per Node"}else{F="Unknown"}}}d("#read-only-process-group-flowfile-concurrency").text(F);var D=E.flowfileOutboundPolicy=="BATCH_OUTPUT"?"Batch Output":"Stream When Available";d("#read-only-process-group-outbound-policy").text(D);d("#process-group-configuration-header-text").text(E.name+" Configuration")}else{z()}y(false)}B.resolve(C)}).fail(function(F,C,D){if(F.status===403){var E;if(w===n.getGroupId()){E={permissions:{canRead:false,canWrite:n.canWriteCurrentGroup()}}}else{E=g.get(w)}d("#process-group-configuration").data("process-group",E);z();y(false);B.resolve(E)}else{B.reject(F,C,D)}})}).promise();var u=r.urls.api+"/flow/process-groups/"+encodeURIComponent(w)+"/controller-services";var v=c.loadControllerServices(u,b());var A=d.ajax({type:"GET",url:r.urls.parameterContexts,dataType:"json"});return d.when(x,v,A).done(function(F,J,D){var L=J[0];var N=D[0];d("#process-group-configuration-last-refreshed").text(L.currentTime);var E=N.parameterContexts;var O=[{text:"No parameter context",value:null}];var C=E.filter(function(P){return P.permissions.canRead});var K=E.filter(function(P){return !P.permissions.canRead});var M=C.sort(function(Q,P){if(Q.component.name<P.component.name){return -1}if(Q.component.name>P.component.name){return 1}return 0});var I=K.sort(function(Q,P){if(Q.id<P.id){return -1}if(Q.id>P.id){return 1}return 0});var B=M.concat(I);B.forEach(function(Q){var P;if(Q.permissions.canRead){P={text:Q.component.name,value:Q.id,description:Q.component.description}}else{P={disabled:true,text:Q.id,value:Q.id}}O.push(P)});var H={text:"Create new parameter context...",value:undefined,optionClass:"unset"};if(h.canModifyParameterContexts()){O.push(H)}var G={options:O,select:function(P){var Q=this;if(typeof P.value==="undefined"){d("#parameter-context-dialog").modal("setHeaderText","Add Parameter Context").modal("setButtonModel",[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){if(d("#parameter-context-name").val()!==""){return false}return true},handler:{click:function(){l.addParameterContext(function(S){O.pop();var R={text:S.component.name,value:S.component.id,description:S.component.description};O.push(R);if(h.canModifyParameterContexts()){O.push(H)}G.selectedOption={value:S.component.id};Q.combo("destroy").combo(G)})}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){d(this).modal("hide")}}}]).modal("show");if(d("#parameter-context-dialog").hasClass("read-only")){d("#parameter-context-dialog").removeClass("read-only");d("#parameter-context-dialog").addClass("edit-mode")}if(!d("#parameter-context-id-setting").hasClass("hidden")){d("#parameter-context-id-setting").addClass("hidden")}d("#parameter-context-name").focus()}}};if(h.isDefinedAndNotNull(F.parameterContext)){G.selectedOption={value:F.parameterContext.id}}d("#process-group-parameter-context-combo").combo("destroy").combo(G)}).fail(f.handleAjaxError)};var o=function(){q.showContent("#process-group-configuration").done(function(){p()});d("#process-group-configuration-tabs").find(".selected-tab").click();i.resetTableSize()};var p=function(){d("#process-group-configuration").removeData("process-group");d("#process-group-configuration-save").mouseout();d("#process-group-id").text("");d("#process-group-name").val("");d("#process-group-comments").val("");d("#process-group-configuration-header-text").text("Process Group Configuration")};var i={init:function(v,u){c=v;l=u;d("#process-group-configuration-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"General",tabContentId:"general-process-group-configuration-tab-content"},{name:"Controller Services",tabContentId:"process-group-controller-services-tab-content"}],select:function(){var x=d("#process-group-configuration").data("process-group");var y=h.isDefinedAndNotNull(x)?x.permissions.canWrite:false;var w=d(this).text();if(w==="General"){d("#flow-cs-availability").hide();d("#add-process-group-configuration-controller-service").hide();if(y){d("#process-group-configuration-save").show()}else{d("#process-group-configuration-save").hide()}}else{d("#flow-cs-availability").show();d("#process-group-configuration-save").hide();if(y){d("#add-process-group-configuration-controller-service").show();d("#process-group-controller-services-tab-content").css("top","32px")}else{d("#add-process-group-configuration-controller-service").hide();d("#process-group-controller-services-tab-content").css("top","0")}i.resetTableSize()}}});k();c.init(b())},resetTableSize:function(){c.resetTableSize(b())},showConfiguration:function(u){return m(u).done(o)},loadConfiguration:function(u){return m(u)},selectControllerService:function(u){var v=b().data("gridInstance");var w=v.getData();var x=w.getRowById(u);v.setSelectedRows([x]);v.scrollRowIntoView(x);d("#process-group-configuration-tabs").find("li:eq(1)").click()}};return i}));