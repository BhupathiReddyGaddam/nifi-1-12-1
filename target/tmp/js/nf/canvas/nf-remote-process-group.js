(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Connection","nf.Common","nf.Client","nf.CanvasUtils"],function(f,e,h,g,c,d){return(nf.RemoteProcessGroup=b(f,e,h,g,c,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.RemoteProcessGroup=b(require("jquery"),require("d3"),require("nf.Connection"),require("nf.Common"),require("nf.Client"),require("nf.CanvasUtils")))}else{nf.RemoteProcessGroup=b(a.$,a.d3,a.nf.Connection,a.nf.Common,a.nf.Client,a.nf.CanvasUtils)}}}(this,function(g,y,l,j,z,v){var n;var t;var m;var k;var u;var o=30;var h={width:384,height:176};var c;var w;var d;var x;var s=function(){return x.selectAll("g.remote-process-group").data(c.values(),function(A){return A.id})};var f=function(C,A){if(C.empty()){return C}var B=C.append("g").attrs({id:function(D){return"id-"+D.id},"class":"remote-process-group component"}).classed("selected",A).call(v.position);B.append("rect").attrs({"class":"border",width:function(D){return D.dimensions.width},height:function(D){return D.dimensions.height},fill:"transparent",stroke:"transparent"});B.append("rect").attrs({"class":"body",width:function(D){return D.dimensions.width},height:function(D){return D.dimensions.height},filter:"url(#component-drop-shadow)","stroke-width":0});B.append("rect").attrs({width:function(D){return D.dimensions.width},height:32,fill:"#b8c6cd"});B.append("text").attrs({x:30,y:20,width:305,height:16,"class":"remote-process-group-name"});B.call(m.activate).call(u.activate).call(k.activate);return B};var r=function(A){if(A.empty()){return}A.select("rect.border").classed("unauthorized",function(B){return B.permissions.canRead===false});A.select("rect.body").classed("unauthorized",function(B){return B.permissions.canRead===false});A.each(function(G){var H=y.select(this);var E=H.select("g.remote-process-group-details");v.editable(H,n,t);if(H.classed("visible")){if(E.empty()){E=H.append("g").attr("class","remote-process-group-details");E.append("text").attrs({"class":"remote-process-group-transmission-status",x:10,y:20});E.append("rect").attrs({x:0,y:32,width:function(){return G.dimensions.width},height:24,fill:"#e3e8eb"});E.append("text").attrs({"class":"remote-process-group-transmission-secure",x:10,y:48});E.append("text").attrs({x:30,y:48,width:305,height:12,"class":"remote-process-group-uri"});E.append("rect").attrs({width:function(){return G.dimensions.width},height:19,x:0,y:66,fill:"#f4f6f7"});E.append("rect").attrs({width:function(){return G.dimensions.width},height:1,x:0,y:84,fill:"#c7d2d7"});E.append("rect").attrs({width:function(){return G.dimensions.width},height:19,x:0,y:85,fill:"#ffffff"});var F=E.append("g").attrs({transform:"translate(6, 75)"});F.append("text").attrs({width:73,height:10,x:4,y:5,"class":"stats-label"}).text("Sent");F.append("text").attrs({width:73,height:10,x:4,y:23,"class":"stats-label"}).text("Received");var I=E.append("g").attrs({transform:"translate(95, 75)"});var B=I.append("text").attrs({width:180,height:10,x:4,y:5,"class":"remote-process-group-sent stats-value"});B.append("tspan").attrs({"class":"count"});B.append("tspan").attrs({"class":"size"});B.append("tspan").attrs({"class":"ports"});var C=I.append("text").attrs({width:180,height:10,x:4,y:23,"class":"remote-process-group-received stats-value"});C.append("tspan").attrs({"class":"ports"});C.append("tspan").attrs({"class":"count"});C.append("tspan").attrs({"class":"size"});var D=E.append("g").attrs({transform:"translate(335, 75)"});D.append("text").attrs({width:25,height:10,x:4,y:5,"class":"stats-info"}).text("5 min");D.append("text").attrs({width:25,height:10,x:4,y:23,"class":"stats-info"}).text("5 min");E.append("rect").attrs({x:0,y:function(){return G.dimensions.height-24},width:function(){return G.dimensions.width},height:24,fill:"#e3e8eb"});E.append("text").attrs({x:10,y:168,"class":"remote-process-group-last-refresh"});E.append("path").attrs({"class":"component-comments",transform:"translate("+(G.dimensions.width-2)+", "+(G.dimensions.height-10)+")",d:"m0,0 l0,8 l-8,0 z"});E.append("text").attrs({"class":"active-thread-count-icon",y:20}).text("\ue83f");E.append("text").attrs({"class":"active-thread-count",y:20});E.append("rect").attrs({"class":"bulletin-background",x:function(){return G.dimensions.width-24},y:32,width:24,height:24});E.append("text").attrs({"class":"bulletin-icon",x:function(){return G.dimensions.width-17},y:49}).text("\uf24a")}if(G.permissions.canRead){E.select("text.remote-process-group-uri").each(function(K){var J=y.select(this);J.text(null).selectAll("title").remove();v.ellipsis(J,K.component.targetUris)}).append("title").text(function(J){return J.component.name});E.select("text.remote-process-group-transmission-secure").text(function(K){var J="";if(K.component.targetSecure===true){J="\uf023"}else{J="\uf09c"}return J}).each(function(K){var J=y.select("#transmission-secure-"+K.id);if(J.empty()){J=y.select("#remote-process-group-tooltips").append("div").attr("id",function(){return"transmission-secure-"+K.id}).attr("class","tooltip nifi-tooltip")}J.text(function(){if(K.component.targetSecure===true){return"Site-to-Site is secure."}else{return"Site-to-Site is NOT secure."}});v.canvasTooltip(J,y.select(this))});E.select("path.component-comments").style("visibility",j.isBlank(G.component.comments)?"hidden":"visible").each(function(){var J=y.select("#comments-tip-"+G.id);if(j.isBlank(G.component.comments)){if(!J.empty()){J.remove()}}else{if(J.empty()){J=y.select("#remote-process-group-tooltips").append("div").attr("id",function(){return"comments-tip-"+G.id}).attr("class","tooltip nifi-tooltip")}J.text(G.component.comments);v.canvasTooltip(J,y.select(this))}});E.select("text.remote-process-group-last-refresh").text(function(J){if(j.isDefinedAndNotNull(J.component.flowRefreshed)){return J.component.flowRefreshed}else{return"Remote flow not current"}});H.select("text.remote-process-group-name").each(function(K){var J=y.select(this);J.text(null).selectAll("title").remove();v.ellipsis(J,K.component.name)}).append("title").text(function(J){return J.component.name})}else{E.select("text.remote-process-group-uri").text(null);E.select("text.remote-process-group-transmission-secure").text(null);E.select("path.component-comments").style("visibility","hidden");E.select("text.remote-process-group-last-refresh").text(null);H.select("text.remote-process-group-name").text(null);H.call(a)}H.call(e)}else{if(G.permissions.canRead){H.select("text.remote-process-group-name").text(function(K){var J=K.component.name;if(J.length>o){return J.substring(0,o)+String.fromCharCode(8230)}else{return J}})}else{H.select("text.remote-process-group-name").text(null)}H.call(a);if(!E.empty()){E.remove()}}})};var b=function(A){return A.status.validationStatus==="INVALID"};var p=function(B){var A=[];if(!j.isEmpty(B.component.authorizationIssues)){A=A.concat(B.component.authorizationIssues)}if(!j.isEmpty(B.component.validationErrors)){A=A.concat(B.component.validationErrors)}return A};var e=function(A){if(A.empty()){return}A.select("text.remote-process-group-sent tspan.count").text(function(B){return j.substringBeforeFirst(B.status.aggregateSnapshot.sent," ")});A.select("text.remote-process-group-sent tspan.size").text(function(B){return" "+j.substringAfterFirst(B.status.aggregateSnapshot.sent," ")});A.select("text.remote-process-group-sent tspan.ports").text(function(B){return" "+String.fromCharCode(8594)+" "+B.inputPortCount});A.select("text.remote-process-group-received tspan.ports").text(function(B){return B.outputPortCount+" "+String.fromCharCode(8594)+" "});A.select("text.remote-process-group-received tspan.count").text(function(B){return j.substringBeforeFirst(B.status.aggregateSnapshot.received," ")});A.select("text.remote-process-group-received tspan.size").text(function(B){return" "+j.substringAfterFirst(B.status.aggregateSnapshot.received," ")});A.select("text.remote-process-group-transmission-status").text(function(C){var B="";if(b(C)){B="\uf071"}else{if(C.status.transmissionStatus==="Transmitting"){B="\uf140"}else{B="\ue80a"}}return B}).attr("font-family",function(C){var B="";if(b(C)||C.status.transmissionStatus==="Transmitting"){B="FontAwesome"}else{B="flowfont"}return B}).classed("invalid",function(B){return b(B)}).classed("transmitting",function(B){return !b(B)&&B.status.transmissionStatus==="Transmitting"}).classed("not-transmitting",function(B){return !b(B)&&B.status.transmissionStatus!=="Transmitting"}).each(function(C){var B=y.select("#authorization-issues-"+C.id);if(C.permissions.canRead&&b(C)){if(B.empty()){B=y.select("#remote-process-group-tooltips").append("div").attr("id",function(){return"authorization-issues-"+C.id}).attr("class","tooltip nifi-tooltip")}B.html(function(){var D=j.formatUnorderedList(p(C));if(D===null||D.length===0){return""}else{return g("<div></div>").append(D).html()}});v.canvasTooltip(B,y.select(this))}else{if(!B.empty()){B.remove()}}});A.each(function(D){var B=y.select(this);var C=0;v.activeThreadCount(B,D,function(E){C=E});B.select("rect.bulletin-background").classed("has-bulletins",function(){return !j.isEmpty(D.status.aggregateSnapshot.bulletins)});v.bulletins(B,D,function(){return y.select("#remote-process-group-tooltips")},C)})};var i=function(A){if(A.empty()){return}A.call(a).remove()};var a=function(A){A.each(function(B){g("#bulletin-tip-"+B.id).remove();g("#authorization-issues-"+B.id).remove();g("#transmission-secure-"+B.id).remove();g("#comments-tip-"+B.id).remove()})};var q={init:function(C,D,A,B,E){n=C;t=D;m=A;u=B;k=E;c=y.map();w=y.map();d=y.map();x=y.select("#canvas").append("g").attrs({"pointer-events":"all","class":"remote-process-groups"})},add:function(G,B){var E=false;if(j.isDefinedAndNotNull(B)){E=j.isDefinedAndNotNull(B.selectAll)?B.selectAll:E}var A=new Date().getTime();var F=function(H){d.set(H.id,A);c.set(H.id,g.extend({type:"RemoteProcessGroup",dimensions:h},H))};if(g.isArray(G)){g.each(G,function(H,I){F(I)})}else{if(j.isDefinedAndNotNull(G)){F(G)}}var C=s();var D=f(C.enter(),E);r(C.merge(D))},set:function(A,I){var B=false;var F=false;var C=false;if(j.isDefinedAndNotNull(I)){B=j.isDefinedAndNotNull(I.selectAll)?I.selectAll:B;F=j.isDefinedAndNotNull(I.transition)?I.transition:F;C=j.isDefinedAndNotNull(I.overrideRevisionCheck)?I.overrideRevisionCheck:C}var G=function(J){var K=c.get(J.id);if((z.isNewerRevision(K,J)&&!w.has(J.id))||C===true){c.set(J.id,g.extend({type:"RemoteProcessGroup",dimensions:h},J))}};if(g.isArray(A)){g.each(c.keys(),function(K,L){var M=c.get(L);var J=g.grep(A,function(N){return N.id===M.id});if(J.length===0&&!d.has(L)){c.remove(L)}});g.each(A,function(J,K){G(K)})}else{if(j.isDefinedAndNotNull(A)){G(A)}}var H=s();var E=f(H.enter(),B);var D=H.merge(E);D.call(r).call(v.position,F);H.exit().call(i)},get:function(A){if(j.isUndefined(A)){return c.values()}else{return c.get(A)}},refresh:function(A){if(j.isDefinedAndNotNull(A)){y.select("#id-"+A).call(r)}else{y.selectAll("g.remote-process-group").call(r)}},pan:function(){y.selectAll("g.remote-process-group.entering, g.remote-process-group.leaving").call(r)},reload:function(B){if(c.has(B)){var A=c.get(B);return g.ajax({type:"GET",url:A.uri,dataType:"json"}).done(function(C){q.set(C);var D=l.getComponentConnections(B);g.each(D,function(F,E){if(E.permissions.canRead){l.reload(E.id)}})})}},position:function(A){y.select("#id-"+A).call(v.position)},remove:function(B){var A=new Date().getTime();if(g.isArray(B)){g.each(B,function(D,C){w.set(C,A);c.remove(C)})}else{w.set(B,A);c.remove(B)}s().exit().call(i)},removeAll:function(){q.remove(c.keys())},expireCaches:function(B){var A=function(C){C.each(function(D,E){if(B>D){C.remove(E)}})};A(d);A(w)}};return q}));