(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Common","nf.Dialog","nf.Storage","nf.ErrorHandler","nf.Client","nf.CanvasUtils","lodash-core"],function(f,j,c,e,g,h,k,d,i){return(nf.Connection=b(f,j,c,e,g,h,k,d,i))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Connection=b(require("jquery"),require("d3"),require("nf.Common"),require("nf.Dialog"),require("nf.Storage"),require("nf.ErrorHandler"),require("nf.Client"),require("nf.CanvasUtils"),require("lodash-code")))}else{nf.Connection=b(a.$,a.d3,a.nf.Common,a.nf.Dialog,a.nf.Storage,a.nf.ErrorHandler,a.nf.Client,a.nf.CanvasUtils,a._)}}}(this,function(J,U,S,i,z,d,f,Y,af){var n;var s;var R;var D;var P={width:224};var g=(P.width/2)-15-2;var F=6;var y=(P.width/2)+10+1;var C=8;var j=true;var X=function(ah){var aj=ah.datum();var ag,ak;if(aj.bends.length>0){var ai=Math.min(Math.max(0,aj.labelIndex),aj.bends.length-1);ag=aj.bends[ai].x;ak=aj.bends[ai].y}else{ag=(aj.start.x+aj.end.x)/2;ak=(aj.start.y+aj.end.y)/2}ag-=(P.width/2);ak-=(ah.attr("height")/2);return{x:ag,y:ak}};var p;var E;var A;var r;var ac;var V;var t;var H;var k=function(ah,ag){return Math.pow(ah.x-ag.x,2)+Math.pow(ah.y-ag.y,2)};var u=function(ah,ag){return Math.sqrt(k(ah,ag))};var M=function(ak,aj,ah){var ag=k(aj,ah);if(ag===0){return Math.sqrt(k(ak,aj))}var ai=((ak.x-aj.x)*(ah.x-aj.x)+(ak.y-aj.y)*(ah.y-aj.y))/ag;if(ai<0){return Math.sqrt(k(ak,aj))}if(ai>1){return Math.sqrt(k(ak,ah))}return Math.sqrt(k(ak,{x:aj.x+ai*(ah.x-aj.x),y:aj.y+ai*(ah.y-aj.y)}))};var b=function(ak,am){if(am.bends.length===0){return 0}var ai;var ah;var ag=[am.start].concat(am.bends,[am.end]);for(var aj=0;aj<ag.length;aj++){if(aj+1<ag.length){var al=M(ak,ag[aj],ag[aj+1]);if(S.isUndefined(ai)||al<ai){ai=al;ah=aj}}}return ah};var L=function(ag){return ag.indexOf("INPUT_PORT")>=0};var B=function(ag){return ag.indexOf("OUTPUT_PORT")>=0};var Q=function(ag){return ag.groupId!==Y.getGroupId()&&(L(ag.type)||B(ag.type))};var o=function(ag){if(S.isDefinedAndNotNull(ag.flowFileExpiration)){var ah=ag.flowFileExpiration.match(/^(\d+).*/);if(ah!==null&&ah.length>0){if(parseInt(ah[0],10)>0){return true}}}return false};var ae=function(ag){return S.isDefinedAndNotNull(ag.loadBalanceStrategy)&&"DO_NOT_LOAD_BALANCE"!==ag.loadBalanceStrategy};var aa=function(ag){ag.sort(function(ai,ah){return ai.zIndex===ah.zIndex?0:ai.zIndex>ah.zIndex?1:-1})};var T=function(){return r.selectAll("g.connection").data(p.values(),function(ag){return ag.id})};var W=function(ai,ah){if(ai.empty()){return ai}var ag=ai.append("g").attrs({id:function(aj){return"id-"+aj.id},"class":"connection"}).classed("selected",ah);ag.append("path").attrs({"class":"connection-path","pointer-events":"none"});ag.append("path").attrs({"class":"connection-selection-path","pointer-events":"none"});ag.append("path").attrs({"class":"connection-path-selectable","pointer-events":"stroke"}).on("mousedown.selection",function(){n.select(U.select(this.parentNode));Y.setURLParameters()}).call(D.activate);return ag};var x=function(ah){var ag=false;if(S.isDefinedAndNotNull(ah.component.selectedRelationships)&&S.isDefinedAndNotNull(ah.component.availableRelationships)){J.each(ah.component.selectedRelationships,function(ai,aj){if(J.inArray(aj,ah.component.availableRelationships)===-1){ag=true;return false}})}return ag};var q=function(ah){var ag="normal";if(ah.permissions.canRead){if(O(ah)||m(ah)){ag="full"}else{if(x(ah)){ag="ghost"}}}else{ag="unauthorized"}return"url(#"+ag+")"};var c=function(ag){if(m(ag)||O(ag)){return"url(#connection-full-drop-shadow)"}else{return"url(#component-drop-shadow)"}};var m=function(ag){return ag.status.aggregateSnapshot.percentUseCount===100};var e=function(ah){var ag=ah.status.aggregateSnapshot.percentUseCount;if(S.isDefinedAndNotNull(ag)){return ag>=61&&ag<=85}return false};var l=function(ah){var ag=ah.status.aggregateSnapshot.percentUseCount;if(S.isDefinedAndNotNull(ag)){return ag>85}return false};var O=function(ag){return ag.status.aggregateSnapshot.percentUseBytes===100};var I=function(ah){var ag=ah.status.aggregateSnapshot.percentUseBytes;if(S.isDefinedAndNotNull(ag)){return ag>=61&&ag<=85}return false};var N=function(ah){var ag=ah.status.aggregateSnapshot.percentUseBytes;if(S.isDefinedAndNotNull(ag)){return ag>85}return false};var a=function(ag,ah){if(ag.empty()){return}var ai=true;var aj=true;var ak=false;if(S.isDefinedAndNotNull(ah)){ai=S.isDefinedAndNotNull(ah.updatePath)?ah.updatePath:ai;aj=S.isDefinedAndNotNull(ah.updateLabel)?ah.updateLabel:aj;ak=S.isDefinedAndNotNull(ah.transition)?ah.transition:ak}if(ai===true){ag.classed("grouped",function(am){var al=false;if(am.permissions.canRead){if(S.isDefinedAndNotNull(am.component.selectedRelationships)&&am.component.selectedRelationships.length>1){al=true}}return al}).classed("ghost",function(am){var al=false;if(am.permissions.canRead){if(x(am)){al=true}}return al});ag.select("path.connection-path").classed("unauthorized",function(al){return al.permissions.canRead===false});ag.select("path.connection-path-selectable").on("dblclick",function(aq){if(aq.permissions.canWrite&&aq.permissions.canRead){var al=U.mouse(this.parentNode);var ao=b({x:al[0],y:al[1]},aq);var an=aq.component.bends.slice();an.splice(ao,0,{x:al[0],y:al[1]});var am={id:aq.id,bends:an};var ap=aq.component.labelIndex;if(an.length===1){am.labelIndex=0}else{if(ao<=ap){am.labelIndex=ap+1}}v(aq,am);U.event.stopPropagation()}else{return null}})}ag.each(function(aQ){var aF=U.select(this);if(ai===true){var aP=Y.getConnectionSourceComponentId(aQ);var ar=U.select("#id-"+aP).datum();var at;var aA;if(aQ.bends.length>0){aA=aQ.bends[aQ.bends.length-1]}else{aA={x:ar.position.x+(ar.dimensions.width/2),y:ar.position.y+(ar.dimensions.height/2)}}if(S.isDefinedAndNotNull(aQ.end)&&aQ.end.dragging===true){at=aQ.end;var aR=U.select("g.hover.connectable-destination");if(!aR.empty()){var aJ=aR.datum();var al=Y.getPerimeterPoint(aA,{x:aJ.position.x,y:aJ.position.y,width:aJ.dimensions.width,height:aJ.dimensions.height});at.x=al.x;at.y=al.y}}else{var an=Y.getConnectionDestinationComponentId(aQ);var aT=U.select("#id-"+an).datum();at=Y.getPerimeterPoint(aA,{x:aT.position.x,y:aT.position.y,width:aT.dimensions.width,height:aT.dimensions.height})}var aB;if(aQ.bends.length>0){aB=aQ.bends[0]}else{aB=at}var aw=Y.getPerimeterPoint(aB,{x:ar.position.x,y:ar.position.y,width:ar.dimensions.width,height:ar.dimensions.height});aQ.start=aw;aQ.end=at;Y.transition(aF.select("path.connection-path"),ak).attrs({d:function(){var aU=[aQ.start].concat(aQ.bends,[aQ.end]);return H(aU)}});Y.transition(aF.select("path.connection-selection-path"),ak).attrs({d:function(){var aU=[aQ.start].concat(aQ.bends,[aQ.end]);return H(aU)}});Y.transition(aF.select("path.connection-path-selectable"),ak).attrs({d:function(){var aU=[aQ.start].concat(aQ.bends,[aQ.end]);return H(aU)}});var az=aF.selectAll("rect.startpoint");var ay=aF.selectAll("rect.endpoint");var aH=aF.selectAll("rect.midpoint");if(aQ.permissions.canWrite&&aQ.permissions.canRead){az=az.data([aQ.start]);var aM=az.enter().append("rect").attrs({"class":"startpoint linepoint","pointer-events":"all",width:8,height:8}).on("mousedown.selection",function(){n.select(U.select(this.parentNode));Y.setURLParameters()}).call(D.activate);Y.transition(az.merge(aM),ak).attr("transform",function(aU){return"translate("+(aU.x-4)+", "+(aU.y-4)+")"});az.exit().remove();var ay=ay.data([aQ.end]);var ax=ay.enter().append("rect").attrs({"class":"endpoint linepoint","pointer-events":"all",width:8,height:8}).on("mousedown.selection",function(){n.select(U.select(this.parentNode));Y.setURLParameters()}).call(V).call(D.activate);Y.transition(ay.merge(ax),ak).attr("transform",function(aU){return"translate("+(aU.x-4)+", "+(aU.y-4)+")"});ay.exit().remove();var aH=aH.data(aQ.bends);var aE=aH.enter().append("rect").attrs({"class":"midpoint linepoint","pointer-events":"all",width:8,height:8}).on("dblclick",function(aX){U.event.stopPropagation();var aU=U.select(this.parentNode);var a1=aU.datum();var a0=Y.getConnectionSourceComponentId(a1);var aZ=Y.getConnectionDestinationComponentId(a1);if(a0===aZ&&aQ.component.bends.length<=2){i.showOkDialog({headerText:"Connection",dialogContent:"Looping connections must have at least two bend points."});return}var aW=[];var aV=-1;J.each(a1.component.bends,function(a3,a2){if(aX.x!==a2.x&&aX.y!==a2.y){aW.push(a2)}else{aV=a3}});if(aV<0){return}var aU={id:a1.id,bends:aW};var aY=a1.component.labelIndex;if(aW.length<=1){aU.labelIndex=0}else{if(aV<=aY){aU.labelIndex=Math.max(0,aY-1)}}v(a1,aU)}).on("mousedown.selection",function(){n.select(U.select(this.parentNode));Y.setURLParameters()}).call(ac).call(D.activate);Y.transition(aH.merge(aE),ak).attr("transform",function(aU){return"translate("+(aU.x-4)+", "+(aU.y-4)+")"});aH.exit().remove()}else{az.remove();ay.remove();aH.remove()}}if(aj===true){var au=aF.select("g.connection-label-container");if(aF.classed("visible")){if(au.empty()){au=aF.insert("g","rect.startpoint").attrs({"class":"connection-label-container","pointer-events":"all"}).on("mousedown.selection",function(){n.select(U.select(this.parentNode));Y.setURLParameters()}).call(D.activate).call(R.activate);au.append("rect").attrs({"class":"body",width:P.width,x:0,y:0});au.append("rect").attrs({"class":"border",width:P.width,fill:"transparent",stroke:"transparent"})}var aG=0;var ap=19;var aO=[];var av=[];var aD=au.select("g.connection-from-container");var aS=au.select("g.connection-to-container");var aI=au.select("g.connection-name-container");if(aQ.permissions.canRead){if(Q(aQ.component.source)){if(aD.empty()){aD=au.append("g").attrs({"class":"connection-from-container"});aO.push(aD.append("rect").attrs({"class":"connection-label-background",width:P.width,height:ap}));av.push(aD.append("rect").attrs({"class":"connection-label-border",width:P.width,height:1}));aD.append("text").attrs({"class":"stats-label",x:5,y:14}).text("From");aD.append("text").attrs({"class":"stats-value connection-from",x:43,y:14,width:130});aD.append("text").attrs({"class":"connection-from-run-status",x:208,y:14})}else{aO.push(aD.select("rect.connection-label-background"));av.push(aD.select("rect.connection-label-border"))}aD.attr("transform",function(){var aU=(ap*aG++);return"translate(0, "+aU+")"});aD.select("text.connection-from").each(function(){var aU=U.select(this);aU.text(null).selectAll("title").remove();Y.ellipsis(aU,aQ.component.source.name)}).append("title").text(function(){return aQ.component.source.name});aD.select("text.connection-from-run-status").text(function(){if(aQ.component.source.exists===false){return"\uf071"}else{if(aQ.component.source.running===true){return"\uf04b"}else{return"\uf04d"}}}).classed("running",function(){if(aQ.component.source.exists===false){return false}else{return aQ.component.source.running}}).classed("stopped",function(){if(aQ.component.source.exists===false){return false}else{return !aQ.component.source.running}}).classed("is-missing-port",function(){return aQ.component.source.exists===false})}else{aD.remove()}if(Q(aQ.component.destination)){if(aS.empty()){aS=au.append("g").attrs({"class":"connection-to-container"});aO.push(aS.append("rect").attrs({"class":"connection-label-background",width:P.width,height:ap}));av.push(aS.append("rect").attrs({"class":"connection-label-border",width:P.width,height:1}));aS.append("text").attrs({"class":"stats-label",x:5,y:14}).text("To");aS.append("text").attrs({"class":"stats-value connection-to",x:25,y:14,width:145});aS.append("text").attrs({"class":"connection-to-run-status",x:208,y:14})}else{aO.push(aS.select("rect.connection-label-background"));av.push(aS.select("rect.connection-label-border"))}aS.attr("transform",function(){var aU=(ap*aG++);return"translate(0, "+aU+")"});aS.select("text.connection-to").each(function(aV){var aU=U.select(this);aU.text(null).selectAll("title").remove();Y.ellipsis(aU,aV.component.destination.name)}).append("title").text(function(aU){return aU.component.destination.name});aS.select("text.connection-to-run-status").text(function(){if(aQ.component.destination.exists===false){return"\uf071"}else{if(aQ.component.destination.running===true){return"\uf04b"}else{return"\uf04d"}}}).classed("running",function(){if(aQ.component.destination.exists===false){return false}else{return aQ.component.destination.running}}).classed("stopped",function(){if(aQ.component.destination.exists===false){return false}else{return !aQ.component.destination.running}}).classed("is-missing-port",function(){return aQ.component.destination.exists===false})}else{aS.remove()}var aq=Y.formatConnectionName(aQ.component);if(!S.isBlank(aq)){if(aI.empty()){aI=au.append("g").attrs({"class":"connection-name-container"});aO.push(aI.append("rect").attrs({"class":"connection-label-background",width:P.width,height:ap}));av.push(aI.append("rect").attrs({"class":"connection-label-border",width:P.width,height:1}));aI.append("text").attrs({"class":"stats-label",x:5,y:14}).text("Name");aI.append("text").attrs({"class":"stats-value connection-name",x:45,y:14,width:142})}else{aO.push(aI.select("rect.connection-label-background"));av.push(aI.select("rect.connection-label-border"))}aI.attr("transform",function(){var aU=(ap*aG++);return"translate(0, "+aU+")"});aI.select("text.connection-name").each(function(){var aU=U.select(this);aU.text(null).selectAll("title").remove();Y.ellipsis(aU,aq)}).append("title").text(function(){return aq})}else{aI.remove()}}else{aD.remove();aS.remove();aI.remove()}var aN=3;var am=au.select("g.queued-container");if(am.empty()){am=au.append("g").attrs({"class":"queued-container"});aO.push(am.append("rect").attrs({"class":"connection-label-background",width:P.width,height:ap+aN}));av.push(am.append("rect").attrs({"class":"connection-label-border",width:P.width,height:1}));am.append("text").attrs({"class":"stats-label",x:5,y:14}).text("Queued");var aK=am.append("text").attrs({"class":"stats-value queued",x:55,y:14});aK.append("tspan").attrs({"class":"count"});aK.append("tspan").attrs({"class":"size"});am.append("text").attrs({"class":"load-balance-icon",y:14}).text(function(){return"\uf042"}).append("title");am.append("text").attrs({"class":"expiration-icon",x:208,y:14}).text(function(){return"\uf017"}).append("title");var ao=ap+aN-4;var aL=am.append("g").attrs({transform:"translate("+F+", "+ao+")","class":"backpressure-object-container"});aL.append("rect").attrs({"class":"backpressure-tick object",width:1,height:3,x:0,y:0});aL.append("rect").attrs({"class":"backpressure-object",width:g,height:3,x:0,y:0});aL.append("rect").attrs({"class":"backpressure-tick object",width:1,height:3,x:g,y:0});aL.append("rect").attrs({"class":"backpressure-percent object",width:0,height:3,x:0,y:0});aL.append("rect").attrs({"class":"backpressure-tick object-prediction",width:1,height:3,x:g,y:0});var aC=am.append("g").attrs({transform:"translate("+y+", "+ao+")","class":"backpressure-data-size-container"});aC.append("rect").attrs({"class":"backpressure-tick data-size",width:1,height:3,x:0,y:0});aC.append("rect").attrs({"class":"backpressure-data-size",width:g,height:3,x:0,y:0}).append("title");aC.append("rect").attrs({"class":"backpressure-tick data-size",width:1,height:3,x:g,y:0});aC.append("rect").attrs({"class":"backpressure-percent data-size",width:0,height:3,x:0,y:0});aC.append("rect").attrs({"class":"backpressure-tick data-size-prediction",width:1,height:3,x:g,y:0})}else{aO.push(am.select("rect.connection-label-background"));av.push(am.select("rect.connection-label-border"))}am.attr("transform",function(){var aU=(ap*aG++);return"translate(0, "+aU+")"});au.select("rect.body").attr("height",function(){return(ap*aG)+aN}).classed("unauthorized",function(){return aQ.permissions.canRead===false});au.select("rect.border").attr("height",function(){return(ap*aG)+aN}).classed("unauthorized",function(){return aQ.permissions.canRead===false});J.each(aO,function(aV,aU){if(aV%2===0){aU.attr("fill","#f4f6f7")}else{aU.attr("fill","#ffffff")}});J.each(av,function(aV,aU){if(aV>0){aU.attr("fill","#c7d2d7")}else{aU.attr("fill","transparent")}});au.select("text.load-balance-icon").classed("hidden",function(){if(aQ.permissions.canRead){return !ae(aQ.component)}else{return true}}).classed("load-balance-icon-active fa-rotate-90",function(aU){return aU.permissions.canRead&&aU.component.loadBalanceStatus==="LOAD_BALANCE_ACTIVE"}).classed("load-balance-icon-184",function(){return aQ.permissions.canRead&&o(aQ.component)}).classed("load-balance-icon-200",function(){return aQ.permissions.canRead&&!o(aQ.component)}).attr("x",function(){return aQ.permissions.canRead&&o(aQ.component)?192:208}).select("title").text(function(){if(aQ.permissions.canRead){var aU=S.getComboOptionText(S.loadBalanceStrategyOptions,aQ.component.loadBalanceStrategy);if("PARTITION_BY_ATTRIBUTE"===aQ.component.loadBalanceStrategy){aU+=" ("+aQ.component.loadBalancePartitionAttribute+")"}var aW="no compression";switch(aQ.component.loadBalanceCompression){case"COMPRESS_ATTRIBUTES_ONLY":aW="'Attribute' compression";break;case"COMPRESS_ATTRIBUTES_AND_CONTENT":aW="'Attribute and content' compression";break}var aV="LOAD_BALANCE_ACTIVE"===aQ.component.loadBalanceStatus?" Actively balancing...":"";return"Load Balance is configured with '"+aU+"' strategy and "+aW+"."+aV}else{return""}});au.select("text.expiration-icon").classed("hidden",function(){if(aQ.permissions.canRead){return !o(aQ.component)}else{return true}}).select("title").text(function(){if(aQ.permissions.canRead){return"Expires FlowFiles older than "+aQ.component.flowFileExpiration}else{return""}});au.select("rect.backpressure-object").classed("not-configured",function(){return S.isUndefinedOrNull(aQ.status.aggregateSnapshot.percentUseCount)});au.selectAll("rect.backpressure-tick.object").classed("not-configured",function(){return S.isUndefinedOrNull(aQ.status.aggregateSnapshot.percentUseCount)});au.selectAll("rect.backpressure-tick.object-prediction").classed("not-configured",function(){return S.isUndefinedOrNull(aQ.status.aggregateSnapshot.percentUseCount)});au.select("rect.backpressure-data-size").classed("not-configured",function(){return S.isUndefinedOrNull(aQ.status.aggregateSnapshot.percentUseBytes)});au.selectAll("rect.backpressure-tick.data-size").classed("not-configured",function(){return S.isUndefinedOrNull(aQ.status.aggregateSnapshot.percentUseBytes)});au.selectAll("rect.backpressure-tick.data-size-prediction").classed("not-configured",function(){return S.isUndefinedOrNull(aQ.status.aggregateSnapshot.percentUseBytes)});if(aQ.permissions.canWrite){au.call(t)}aF.call(K)}else{if(!au.empty()){au.remove()}}}Y.transition(aF.select("g.connection-label-container"),ak).attr("transform",function(){var aV=U.select(this).select("rect.body");var aU=X(aV);return"translate("+aU.x+", "+aU.y+")"})})};var G=function(ai){var ag=af.get(ai,"status.aggregateSnapshot.percentUseCount",0);var ah=af.get(ai,"status.aggregateSnapshot.percentUseBytes",0);return Math.max(ag,ah)>=100};var w=function(am){var ao;var ai=af.get(am,"status.aggregateSnapshot.percentUseCount");if(af.isNumber(ai)){var ag=af.get(am,"component.backPressureObjectThreshold");var ap=af.get(am,"status.aggregateSnapshot.predictions");var ak=["Queue: "+af.clamp(ai,0,100)+"% full (based on "+ag+" object threshold)"];if(!af.isNil(ap)){var ah=af.get(ap,"predictedPercentCount",-1);var al=af.get(ap,"predictedMillisUntilCountBackpressure",-1);var an=af.get(ap,"predictionIntervalSeconds",60*5);if(af.isNumber(ah)&&ah>-1){ak.push("Predicted queue (next "+(an/60)+" mins): "+af.clamp(ah,0,100)+"%")}else{ak.push("Predicted queue (next "+(an/60)+" mins): NA")}if(af.isNumber(al)&&af.inRange(al,0,Number.MAX_SAFE_INTEGER)&&!G(am)){var aj=S.formatPredictedDuration(al);ak.push("Estimated time to back pressure: "+aj)}else{ak.push("Estimated time to back pressure: "+(G(am)?"now":"NA"))}}else{ak.push("Queue Prediction is not configured")}if(af.isEmpty(ak)){return""}else{if(af.size(ak)===1){return ak[0]}else{ao=S.formatUnorderedList(ak)}}}else{ao="Back Pressure Object Threshold is not configured"}return ao};var Z=function(ak){var an;var al=af.get(ak,"status.aggregateSnapshot.percentUseBytes");if(af.isNumber(al)){var ap=af.get(ak,"component.backPressureDataSizeThreshold");var ao=af.get(ak,"status.aggregateSnapshot.predictions");var ah=["Queue: "+af.clamp(al,0,100)+"% full (based on "+ap+" data size threshold)"];if(!af.isNil(ao)){var ai=af.get(ao,"predictedPercentBytes",-1);var aj=af.get(ao,"predictedMillisUntilBytesBackpressure",-1);var am=af.get(ao,"predictionIntervalSeconds",60*5);if(af.isNumber(ai)&&ai>-1){ah.push("Predicted queue (next "+(am/60)+" mins): "+af.clamp(ai,0,100)+"%")}else{ah.push("Predicted queue (next "+(am/60)+" mins): NA")}if(af.isNumber(aj)&&af.inRange(aj,0,Number.MAX_SAFE_INTEGER)&&!G(ak)){var ag=S.formatPredictedDuration(aj);ah.push("Estimated time to back pressure: "+ag)}else{ah.push("Estimated time to back pressure: "+(G(ak)?"now":"NA"))}}else{ah.push("Queue Prediction is not configured")}if(af.isEmpty(ah)){return""}else{if(af.size(ah)===1){return ah[0]}else{an=S.formatUnorderedList(ah)}}}else{an="Back Pressure Data Size Threshold is not configured"}return an};var K=function(ag){if(ag.empty()){return}var ah=J.Deferred(function(aj){ag.select("text.queued tspan.count").text(function(am){return S.substringBeforeFirst(am.status.aggregateSnapshot.queued," ")});var al=ag.select("rect.backpressure-percent.data-size");al.transition().duration(400).attrs({width:function(am){if(S.isDefinedAndNotNull(am.status.aggregateSnapshot.percentUseBytes)){return(g*am.status.aggregateSnapshot.percentUseBytes)/100}else{return 0}}}).on("end",function(){al.classed("warning",function(am){return I(am)}).classed("error",function(am){return N(am)});aj.resolve()});var ak=ag.select("rect.backpressure-tick.data-size-prediction");ak.transition().duration(400).attrs({x:function(an){var am=af.get(an,"status.aggregateSnapshot.predictions.predictedPercentBytes",0);return(g*af.clamp(am,0,100))/100},display:function(an){var am=af.get(an,"status.aggregateSnapshot.predictions.predictedPercentBytes",-1);if(am>=0){return"unset"}else{return"none"}}}).on("end",function(){ak.classed("prediction-down",function(an){var ao=af.get(an,"status.aggregateSnapshot.predictions.percentUseBytes",0);var am=af.get(an,"status.aggregateSnapshot.predictions.predictedPercentBytes",0);return am<ao})});ag.select("g.backpressure-data-size-container").each(function(an){var am=U.select("#back-pressure-size-tip-"+an.id);if(am.empty()){am=U.select("#connection-tooltips").append("div").attr("id",function(){return"back-pressure-size-tip-"+an.id}).attr("class","tooltip nifi-tooltip")}am.html(function(){return J("<div></div>").append(Z(an)).html()});Y.canvasTooltip(am,U.select(this))})}).promise();var ai=J.Deferred(function(aj){ag.select("text.queued tspan.size").text(function(am){return" "+S.substringAfterFirst(am.status.aggregateSnapshot.queued," ")});var al=ag.select("rect.backpressure-percent.object");al.transition().duration(400).attrs({width:function(am){if(S.isDefinedAndNotNull(am.status.aggregateSnapshot.percentUseCount)){return(g*am.status.aggregateSnapshot.percentUseCount)/100}else{return 0}}}).on("end",function(){al.classed("warning",function(am){return e(am)}).classed("error",function(am){return l(am)});aj.resolve()});var ak=ag.select("rect.backpressure-tick.object-prediction");ak.transition().duration(400).attrs({x:function(an){var am=af.get(an,"status.aggregateSnapshot.predictions.predictedPercentCount",0);return(g*af.clamp(am,0,100))/100},display:function(an){var am=af.get(an,"status.aggregateSnapshot.predictions.predictedPercentCount",-1);if(am>=0){return"unset"}else{return"none"}}}).on("end",function(){ak.classed("prediction-down",function(an){var ao=af.get(an,"status.aggregateSnapshot.percentUseCount",0);var am=af.get(an,"status.aggregateSnapshot.predictions.predictedPercentCount",0);return am<ao})});ag.select("g.backpressure-object-container").each(function(an){var am=U.select("#back-pressure-count-tip-"+an.id);if(am.empty()){am=U.select("#connection-tooltips").append("div").attr("id",function(){return"back-pressure-count-tip-"+an.id}).attr("class","tooltip nifi-tooltip")}am.html(function(){return J("<div></div>").append(w(an)).html()});Y.canvasTooltip(am,U.select(this))})}).promise();J.when(ah,ai).done(function(){ag.select("path.connection-path").classed("full",function(aj){return m(aj)||O(aj)}).attrs({"marker-end":q});ag.select("rect.border").classed("full",function(aj){return m(aj)||O(aj)});ag.select("rect.body").attrs({filter:c})})};var v=function(ai,ah){var ag={revision:f.getRevision(ai),disconnectedNodeAcknowledged:z.isDisconnectionAcknowledged(),component:ah};return J.ajax({type:"PUT",url:ai.uri,data:JSON.stringify(ag),dataType:"json",contentType:"application/json"}).done(function(aj){ad.set(aj)}).fail(d.handleConfigurationUpdateAjaxError)};var h=function(ag){ag.each(function(aj){var ai=Y.getConnectionSourceComponentId(aj);var ah=Y.getConnectionDestinationComponentId(aj);Y.reloadConnectionSourceAndDestination(ai,ah)});ag.call(ab).remove()};var ab=function(ag){ag.each(function(ah){J("#back-pressure-size-tip-"+ah.id).remove();J("#back-pressure-count-tip-"+ah.id).remove()})};var ad={config:{selfLoopXOffset:(P.width/2)+5,selfLoopYOffset:25},init:function(ag,ah,aj,ai){n=ag;D=ah;R=aj;s=ai;p=U.map();E=U.map();A=U.map();r=U.select("#canvas").append("g").attrs({"pointer-events":"stroke","class":"connections"});H=U.line().x(function(ak){return ak.x}).y(function(ak){return ak.y}).curve(U.curveLinear);ac=U.drag().on("start",function(){U.event.sourceEvent.stopPropagation()}).on("drag",function(ak){j=!U.event.sourceEvent.shiftKey;ak.x=j?(Math.round(U.event.x/C)*C):U.event.x;ak.y=j?(Math.round(U.event.y/C)*C):U.event.y;U.select(this.parentNode).call(a,{updatePath:true,updateLabel:false})}).on("end",function(){var ak=U.select(this.parentNode);var ao=ak.datum();var am=ak.selectAll("rect.midpoint").data();if(am.length===ao.component.bends.length){var an=false;for(var al=0;al<am.length&&!an;al++){if(am[al].x!==ao.component.bends[al].x||am[al].y!==ao.component.bends[al].y){an=true}}if(an){v(ao,{id:ao.id,bends:am}).fail(function(){ao.bends=J.map(ao.component.bends,function(ap){return{x:ap.x,y:ap.y}});ak.call(a,{updatePath:true,updateLabel:false})})}}U.event.sourceEvent.stopPropagation()});V=U.drag().on("start",function(ak){ak.dragging=true;U.event.sourceEvent.stopPropagation()}).on("drag",function(ak){ak.x=U.event.x-8;ak.y=U.event.y-8;U.select("g.hover").classed("connectable-destination",function(){return Y.isValidConnectionDestination(U.select(this))});U.select(this.parentNode).call(a,{updatePath:true,updateLabel:false})}).on("end",function(at){at.dragging=false;var ak=U.select(this.parentNode);var av=ak.datum();var al=Y.getConnectionDestinationComponentId(av);var au=U.select("g.connectable-destination");if(au.empty()){ak.call(a,{updatePath:true,updateLabel:false})}else{if(Y.isProcessGroup(au)||Y.isRemoteProcessGroup(au)){s.showConfiguration(ak,au).done(function(){Y.reloadConnectionSourceAndDestination(null,al)}).fail(function(){ak.call(a,{updatePath:true,updateLabel:false})})}else{var ao=au.datum();var aq=Y.getConnectableTypeForDestination(au);var ap={revision:f.getRevision(av),disconnectedNodeAcknowledged:z.isDisconnectionAcknowledged(),component:{id:av.id,destination:{id:ao.id,groupId:Y.getGroupId(),type:aq}}};if(av.bends.length<2&&av.sourceId===ao.id){var am={x:ao.position.x+(ao.dimensions.width),y:ao.position.y+(ao.dimensions.height/2)};var ar=ad.config.selfLoopXOffset;var an=ad.config.selfLoopYOffset;ap.component.bends=[];ap.component.bends.push({x:(am.x+ar),y:(am.y-an)});ap.component.bends.push({x:(am.x+ar),y:(am.y+an)})}J.ajax({type:"PUT",url:av.uri,data:JSON.stringify(ap),dataType:"json",contentType:"application/json"}).done(function(ax){var aw=ax.component;ad.set(ax);Y.reloadConnectionSourceAndDestination(null,al);var az=Y.getConnectionSourceComponentId(ax);var ay=Y.getConnectionSourceComponentId(ax);Y.reloadConnectionSourceAndDestination(az,ay)}).fail(function(ay,aw,ax){if(ay.status===400||ay.status===401||ay.status===403||ay.status===404||ay.status===409){i.showOkDialog({headerText:"Connection",dialogContent:S.escapeHtml(ay.responseText)});ak.call(a,{updatePath:true,updateLabel:false})}else{d.handleAjaxError(ay,aw,ax)}})}}U.event.sourceEvent.stopPropagation()});t=U.drag().on("start",function(ak){U.event.sourceEvent.stopPropagation()}).on("drag",function(ap){if(ap.bends.length>1){var am=U.select("rect.label-drag");if(am.empty()){var ao=U.select(this).select("rect.body");var an=X(ao);var ak=P.width;var au=ao.attr("height");am=U.select("#canvas").append("rect").attr("x",an.x).attr("y",an.y).attr("class","label-drag").attr("width",ak).attr("height",au).attr("stroke-width",function(){return 1/Y.getCanvasScale()}).attr("stroke-dasharray",function(){return 4/Y.getCanvasScale()}).datum({x:an.x,y:an.y,width:ak,height:au})}else{am.attr("x",function(av){av.x+=U.event.dx;return av.x}).attr("y",function(av){av.y+=U.event.dy;return av.y})}var aq=am.datum();var at={x:aq.x+(aq.width/2),y:aq.y+(aq.height/2)};var al=-1;var ar;J.each(ap.bends,function(ax,aw){var av={x:aw.x,y:aw.y};var ay=u(at,av);if(al===-1||ay<ar){al=ax;ar=ay}});ap.labelIndex=al;U.select(this.parentNode).call(a,{updatePath:true,updateLabel:false})}}).on("end",function(am){if(am.bends.length>1){var al=U.select("rect.label-drag");if(!al.empty()){al.remove()}if(am.labelIndex!==am.component.labelIndex){var ak=U.select(this.parentNode);v(am,{id:am.id,labelIndex:am.labelIndex}).fail(function(){am.labelIndex=am.component.labelIndex;ak.call(a,{updatePath:true,updateLabel:false})})}}U.event.sourceEvent.stopPropagation()})},add:function(ah,aj){var am=false;if(S.isDefinedAndNotNull(aj)){am=S.isDefinedAndNotNull(aj.selectAll)?aj.selectAll:am}var ai=new Date().getTime();var an=function(ao){A.set(ao.id,ai);p.set(ao.id,J.extend({type:"Connection"},ao))};if(J.isArray(ah)){J.each(ah,function(ao,ap){an(ap)})}else{if(S.isDefinedAndNotNull(ah)){an(ah)}}var ak=T();var al=W(ak.enter(),am);var ag=ak.merge(al);ag.call(a,{updatePath:true,updateLabel:false}).call(aa)},isDisconnected:function(ai){if(ai.empty()){return false}var ah=U.map();var aj=U.map();var ag=true;ai.filter(function(ak){return ak.type==="Connection"}).each(function(ak){ah.set(ak.id,ak)});ai.filter(function(ak){return ak.type!=="Connection"}).each(function(ak){aj.set(ak.id,ak.component);J.each(ad.getComponentConnections(ak.id),function(am,al){if(!ah.has(al.id)){ag=false;return false}})});if(ag){ah.each(function(ak,al){if(ag){ag=aj.has(Y.getConnectionSourceComponentId(ak))&&aj.has(Y.getConnectionDestinationComponentId(ak))}})}return ag},set:function(al,ao){var ag=false;var ak=false;var ah=false;if(S.isDefinedAndNotNull(ao)){ag=S.isDefinedAndNotNull(ao.selectAll)?ao.selectAll:ag;ak=S.isDefinedAndNotNull(ao.transition)?ao.transition:ak;ah=S.isDefinedAndNotNull(ao.overrideRevisionCheck)?ao.overrideRevisionCheck:ah}var am=function(ap){var aq=p.get(ap.id);if((f.isNewerRevision(aq,ap)&&!E.has(ap.id))||ah===true){p.set(ap.id,J.extend({type:"Connection"},ap))}};if(J.isArray(al)){J.each(p.keys(),function(aq,ar){var at=p.get(ar);var ap=J.grep(al,function(au){return au.id===at.id});if(ap.length===0&&!A.has(ar)){p.remove(ar)}});J.each(al,function(ap,aq){am(aq)})}else{if(S.isDefinedAndNotNull(al)){am(al)}}var an=T();var aj=W(an.enter(),ag);var ai=an.merge(aj);ai.call(a,{updatePath:true,updateLabel:true,transition:ak}).call(aa);an.exit().call(h)},refresh:function(ag){if(S.isDefinedAndNotNull(ag)){U.select("#id-"+ag).call(a,{updatePath:true,updateLabel:true})}else{U.selectAll("g.connection").call(a,{updatePath:true,updateLabel:true})}},pan:function(){U.selectAll("g.connection.entering, g.connection.leaving").call(a,{updatePath:false,updateLabel:true})},remove:function(ah){var ag=new Date().getTime();if(J.isArray(ah)){J.each(ah,function(ai,aj){E.set(aj,ag);p.remove(aj)})}else{E.set(ah,ag);p.remove(ah)}T().exit().call(h)},removeAll:function(){ad.remove(p.keys())},reload:function(ah){if(p.has(ah)){var ag=p.get(ah);return J.ajax({type:"GET",url:ag.uri,dataType:"json"}).done(function(ai){ad.set(ai)})}},reloadStatus:function(ag){if(p.has(ag)){return J.ajax({type:"GET",url:"../nifi-api/flow/connections/"+encodeURIComponent(ag)+"/status",dataType:"json"}).done(function(ah){var ai=p.get(ag);ai.status=ah.connectionStatus;p.set(ag,ai);T().call(K)})}},getComponentConnections:function(ah){var ag=[];p.each(function(aj,ai){if(Y.getConnectionSourceComponentId(aj)===ah||Y.getConnectionDestinationComponentId(aj)===ah){ag.push(aj)}});return ag},get:function(ag){if(S.isUndefined(ag)){return p.values()}else{return p.get(ag)}},expireCaches:function(ah){var ag=function(ai){ai.each(function(aj,ak){if(ah>aj){ai.remove(ak)}})};ag(A);ag(E)}};return ad}));