(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","Slick","nf.Common","nf.Dialog","nf.ErrorHandler"],function(d,g,e,c,f){return(nf.TemplatesTable=b(d,g,e,c,f))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.TemplatesTable=b(require("jquery"),require("Slick"),require("nf.Common"),require("nf.Dialog"),require("nf.ErrorHandler")))}else{nf.TemplatesTable=b(a.$,a.Slick,a.nf.Common,a.nf.Dialog,a.nf.ErrorHandler)}}}(this,function(i,f,g,h,m){var a=false;var c={urls:{templates:"../nifi-api/flow/templates",downloadToken:"../nifi-api/access/download-token"}};var j=function(p,r){var q=function(u,s){if(u.permissions.canRead&&s.permissions.canRead){if(p.columnId==="timestamp"){var x=g.parseDateTime(u.template[p.columnId]);var w=g.parseDateTime(s.template[p.columnId]);return x.getTime()-w.getTime()}else{var t=g.isDefinedAndNotNull(u.template[p.columnId])?u.template[p.columnId]:"";var v=g.isDefinedAndNotNull(s.template[p.columnId])?s.template[p.columnId]:"";return t===v?0:t>v?1:-1}}else{if(!u.permissions.canRead&&!s.permissions.canRead){return 0}if(u.permissions.canRead){return 1}else{return -1}}};r.sort(q,p.sortAsc)};var l=function(p){h.showYesNoDialog({headerText:"Delete Template",dialogContent:"Delete template '"+g.escapeHtml(p.template.name)+"'?",yesHandler:function(){o(p)}})};var e=function(p){if(top!==window){if(g.isDefinedAndNotNull(parent.nf)&&g.isDefinedAndNotNull(parent.nf.PolicyManagement)&&g.isDefinedAndNotNull(parent.nf.Shell)){parent.nf.PolicyManagement.showTemplatePolicy(p);parent.$("#shell-close-button").click()}}};var o=function(p){i.ajax({type:"DELETE",url:p.template.uri+"?"+i.param({disconnectedNodeAcknowledged:a}),dataType:"json"}).done(function(){var q=i("#templates-table").data("gridInstance");var r=q.getData();r.deleteItem(p.id);i("#total-templates").text(r.getItems().length)}).fail(m.handleAjaxError)};var n=function(){return i("#templates-filter").val()};var k=function(){var p=i("#templates-table").data("gridInstance");if(g.isDefinedAndNotNull(p)){var q=p.getData();q.setFilterArgs({searchString:n(),property:i("#templates-filter-type").combo("getSelectedOption").value});q.refresh()}};var b=function(q,p){if(p.searchString===""){return true}try{var s=new RegExp(p.searchString,"i")}catch(r){return false}return q.template[p.property].search(s)>=0};var d=function(p){g.getAccessToken(c.urls.downloadToken).done(function(q){var r={};if(!g.isBlank(q)){r.access_token=q}if(i.isEmptyObject(r)){window.open(p.template.uri+"/download")}else{window.open(p.template.uri+"/download?"+i.param(r))}}).fail(function(){h.showOkDialog({headerText:"Download Template",dialogContent:"Unable to generate access token for downloading content."})})};return{init:function(x){a=x;i("#templates-filter").keyup(function(){k()});i("#templates-filter-type").combo({options:[{text:"by name",value:"name"},{text:"by description",value:"description"}],select:function(z){k()}});var w=function(D,A,C,B,z){if(!z.permissions.canRead){return""}return g.escapeHtml(z.template.timestamp)};var s=function(D,A,C,B,z){if(!z.permissions.canRead){return'<span class="blank">'+g.escapeHtml(z.id)+"</span>"}return g.escapeHtml(z.template.name)};var q=function(D,A,C,B,z){if(!z.permissions.canRead){return""}return g.formatValue(z.template.description)};var v=function(D,A,C,B,z){if(!z.permissions.canRead){return""}return g.escapeHtml(z.template.groupId)};var r=function(E,A,D,C,z){var B="";if(z.permissions.canRead===true){B+='<div title="Download" class="pointer export-template icon icon-template-save"></div>'}if(z.permissions.canWrite===true){B+='<div title="Remove Template" class="pointer prompt-to-delete-template fa fa-trash"></div>'}if(top!==window&&g.canAccessTenants()){if(g.isDefinedAndNotNull(parent.nf)&&g.isDefinedAndNotNull(parent.nf.CanvasUtils)&&parent.nf.CanvasUtils.isManagedAuthorizer()){B+='<div title="Access Policies" class="pointer edit-access-policies fa fa-key"></div>'}}return B};var y=[{id:"timestamp",name:"Date/Time",sortable:true,defaultSortAsc:false,resizable:false,formatter:w,width:225,maxWidth:225},{id:"name",name:"Name",sortable:true,resizable:true,formatter:s},{id:"description",name:"Description",sortable:true,resizable:true,formatter:q},{id:"groupId",name:"Process Group Id",sortable:true,resizable:true,formatter:v},{id:"actions",name:"&nbsp;",sortable:false,resizable:false,formatter:r,width:100,maxWidth:100}];var t={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:false,enableColumnReorder:false,autoEdit:false,rowHeight:24};var p=new f.Data.DataView({inlineFilters:false});p.setItems([]);p.setFilterArgs({searchString:n(),property:i("#templates-filter-type").combo("getSelectedOption").value});p.setFilter(b);j({columnId:"timestamp",sortAsc:false},p);var u=new f.Grid("#templates-table",p,y,t);u.setSelectionModel(new f.RowSelectionModel());u.registerPlugin(new f.AutoTooltips());u.setSortColumn("timestamp",false);u.onSort.subscribe(function(A,z){j({columnId:z.sortCol.id,sortAsc:z.sortAsc},p)});u.onClick.subscribe(function(C,z){var B=i(C.target);var A=p.getItem(z.row);if(u.getColumns()[z.cell].id==="actions"){if(B.hasClass("export-template")){d(A)}else{if(B.hasClass("prompt-to-delete-template")){l(A)}else{if(B.hasClass("edit-access-policies")){e(A)}}}}});p.onRowCountChanged.subscribe(function(A,z){u.updateRowCount();u.render();i("#displayed-templates").text(z.current)});p.onRowsChanged.subscribe(function(A,z){u.invalidateRows(z.rows);u.render()});i("#templates-table").data("gridInstance",u);i("#displayed-templates").text("0")},resetTableSize:function(){var p=i("#templates-table").data("gridInstance");if(g.isDefinedAndNotNull(p)){p.resizeCanvas()}},loadTemplatesTable:function(){return i.ajax({type:"GET",url:c.urls.templates,dataType:"json"}).done(function(p){if(g.isDefinedAndNotNull(p.templates)){var q=i("#templates-table").data("gridInstance");var r=q.getData();r.setItems(p.templates);r.reSort();q.invalidate();i("#templates-last-refreshed").text(p.generated);i("#total-templates").text(p.templates.length)}else{i("#total-templates").text("0")}}).fail(m.handleAjaxError)}}}));