(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","Slick","nf.Common","nf.ErrorHandler","nf.Dialog"],function(d,g,e,f,c){return(nf.CountersTable=b(d,g,e,f,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.CountersTable=b(require("jquery"),require("Slick"),require("nf.Common"),require("nf.ErrorHandler"),require("nf.Dialog")))}else{nf.CountersTable=b(a.$,a.Slick,a.nf.Common,a.nf.ErrorHandler,a.nf.Dialog)}}}(this,function(g,d,e,j,f){var b={urls:{counters:"../nifi-api/counters"}};var h=function(l,n){var m=function(q,o){if(l.columnId==="value"){var t=e.parseCount(q[l.columnId]);var s=e.parseCount(o[l.columnId]);return t-s}else{var p=e.isDefinedAndNotNull(q[l.columnId])?q[l.columnId]:"";var r=e.isDefinedAndNotNull(o[l.columnId])?o[l.columnId]:"";return p===r?0:p>r?1:-1}};n.sort(m,l.sortAsc)};var k=function(){return g("#counters-filter").val()};var i=function(){var l=g("#counters-table").data("gridInstance");if(e.isDefinedAndNotNull(l)){var m=l.getData();m.setFilterArgs({searchString:k(),property:g("#counters-filter-type").combo("getSelectedOption").value});m.refresh()}};var a=function(m,l){if(l.searchString===""){return true}try{var o=new RegExp(l.searchString,"i")}catch(n){return false}return m[l.property].search(o)>=0};var c=function(l){f.showYesNoDialog({headerText:"Reset Counter",dialogContent:"Reset counter '"+e.escapeHtml(l.name)+"' to default value?",yesHandler:function(){g.ajax({type:"PUT",url:b.urls.counters+"/"+encodeURIComponent(l.id),dataType:"json"}).done(function(o){var m=o.counter;var n=g("#counters-table").data("gridInstance");var p=n.getData();p.updateItem(m.id,m)}).fail(j.handleAjaxError)}})};return{init:function(){g("#counters-filter").keyup(function(){i()});g("#counters-filter-type").combo({options:[{text:"by name",value:"name"},{text:"by context",value:"context"}],select:function(q){i()}});var n=[{id:"context",name:"Context",field:"context",sortable:true,resizable:true,formatter:e.genericValueFormatter},{id:"name",name:"Name",field:"name",sortable:true,resizable:true,formatter:e.genericValueFormatter},{id:"value",name:"Value",field:"value",sortable:true,resizable:true,defaultSortAsc:false,formatter:e.genericValueFormatter}];if(e.canModifyCounters()){var p=function(u,r,t,s,q){return'<div title="Reset Counter" class="pointer reset-counter fa fa-undo"></div>'};n.push({id:"actions",name:"&nbsp;",sortable:false,resizable:false,formatter:p,width:100,maxWidth:100})}var m={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:false,enableColumnReorder:false,autoEdit:false,rowHeight:24};var o=new d.Data.DataView({inlineFilters:false});o.setItems([]);o.setFilterArgs({searchString:k(),property:g("#counters-filter-type").combo("getSelectedOption").value});o.setFilter(a);h({columnId:"context",sortAsc:true},o);var l=new d.Grid("#counters-table",o,n,m);l.setSelectionModel(new d.RowSelectionModel());l.registerPlugin(new d.AutoTooltips());l.setSortColumn("context",true);l.onSort.subscribe(function(r,q){h({columnId:q.sortCol.field,sortAsc:q.sortAsc},o)});l.onClick.subscribe(function(t,q){var s=g(t.target);var r=o.getItem(q.row);if(l.getColumns()[q.cell].id==="actions"){if(s.hasClass("reset-counter")){c(r)}}});o.onRowCountChanged.subscribe(function(r,q){l.updateRowCount();l.render();g("#displayed-counters").text(q.current)});o.onRowsChanged.subscribe(function(r,q){l.invalidateRows(q.rows);l.render()});g("#counters-table").data("gridInstance",l);g("#displayed-counters").text("0")},resetTableSize:function(){var l=g("#counters-table").data("gridInstance");if(e.isDefinedAndNotNull(l)){l.resizeCanvas()}},loadCountersTable:function(){return g.ajax({type:"GET",url:b.urls.counters,dataType:"json"}).done(function(n){var l=n.counters;var p=l.aggregateSnapshot;if(e.isDefinedAndNotNull(p.counters)){var m=g("#counters-table").data("gridInstance");var o=m.getData();o.setItems(p.counters);o.reSort();m.invalidate();g("#counters-last-refreshed").text(p.generated);g("#total-counters").text(p.counters.length)}else{g("#total-counters").text("0")}}).fail(j.handleAjaxError)}}}));